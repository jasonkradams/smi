{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Spokane Mountaineers Documentation","text":"<p>Welcome to the Spokane Mountaineers documentation portal. This site is a growing collection of how-to guides, internal processes, and technical documentation to support club operations, technology tools, and volunteer contributors.</p>"},{"location":"#what-youll-find-here","title":"What You'll Find Here","text":"<ul> <li>In-depth technical articles and solution case studies</li> <li>Detailed implementation documentation for major features</li> <li>Step-by-step guides for common workflows</li> <li>Reference documentation for club systems</li> <li>Walkthroughs for maintaining Salesforce and our public-facing site</li> <li>Technical solutions we've implemented (like session keep-alive)</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<p>Use the sidebar to explore topics by category. If you're not sure where to begin, here are a few helpful starting points:</p> <ul> <li>Technical Articles</li> <li>Latest Update: Migrating to Email-Based Login</li> <li>Implementation Details</li> <li>How To Guides</li> <li>Automations</li> <li>Proposals</li> <li>About</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>This site is maintained by volunteers. If you'd like to help document a process or fix something out of date, please reach out to the tech team webdev@spokanemountaineers.org.</p>"},{"location":"about/","title":"About This Documentation","text":"<p>Welcome to the official documentation site for the Spokane Mountaineers \u2014 a nonprofit community of adventurers, educators, and volunteers dedicated to promoting safe and inclusive outdoor recreation since 1915.</p> <p>This site is maintained by club members to provide:</p> <ul> <li>\ud83d\udcd8 How-to guides for managing club activities and technology</li> <li>\ud83d\udee0 Administrative tools and resources for leaders and volunteers</li> <li>\ud83d\udca1 Best practices for website management, event registration, and communications</li> </ul>"},{"location":"about/#who-we-are","title":"\ud83c\udfd4 Who We Are","text":"<p>The Spokane Mountaineers is an all-volunteer organization committed to the responsible enjoyment of the outdoors. We offer year-round activities in:</p> <ul> <li>Mountaineering</li> <li>Rock climbing</li> <li>Backcountry skiing</li> <li>Hiking and backpacking</li> <li>Mountain biking</li> <li>Conservation and stewardship</li> </ul> <p>Our members range from first-time hikers to seasoned climbers, all sharing a passion for learning and the natural world.</p>"},{"location":"about/#how-this-site-works","title":"\ud83d\udcda How This Site Works","text":"<p>This site is built with MkDocs and the Material for MkDocs theme. It lives on GitHub and is open to contributions from any club member.</p> <p>Want to contribute? Start here:</p> <ul> <li>\ud83d\udcbb Visit the GitHub repository</li> <li>\u270d\ufe0f Submit an issue or request a guide</li> </ul>"},{"location":"about/#thanks","title":"\ud83d\ude4f Thanks","text":"<p>Special thanks to all our volunteers, instructors, and behind-the-scenes helpers who make the Spokane Mountaineers thrive \u2014 on the trails and online.</p> <p>\u201cThe mountains are calling and I must go.\u201d \u2014 John Muir</p>"},{"location":"articles/","title":"Technical Articles &amp; Solutions","text":"<p>This section contains in-depth technical articles and solutions we've implemented for the Spokane Mountaineers. Unlike step-by-step guides, these articles provide detailed explanations of complex problems, architectural decisions, and innovative solutions.</p>"},{"location":"articles/#recent-articles","title":"Recent Articles","text":"<ul> <li>Migrating to Email-Based Login \u2013 How we built custom login and password reset pages that automatically append <code>.smi</code> to member email addresses, allowing members to login using just their email while maintaining Salesforce's global username uniqueness requirement.</li> <li>Fixing Missing Approval Email Notifications \u2013 How we diagnosed and fixed a Salesforce platform behavior change that stopped approval emails from being sent to activity group chairs.</li> <li>Restricting Member Access to Account Records in Experience Cloud \u2013 How we resolved a privacy concern by removing Account object read access for member-facing profiles, protecting sensitive financial and household data.</li> <li>Enabling Google Login for Spokane Mountaineers Members \u2013 How we implemented Google OAuth authentication to simplify member login while preserving our Donorbox registration process.</li> <li>Event Participant Follow Handler: Tests, Deployment, and Lessons Learned \u2013 End-to-end recap of the latest handler improvements, unit testing strategy, and deployment verification steps.</li> <li>Protecting Member Privacy in Event Participant Lists \u2013 An overview of our privacy solution for Event Participants, written for a general technical audience.</li> <li>Event Participant Privacy Redirect Solution (Technical) \u2013 Complete technical implementation guide with deployment instructions, code examples, and troubleshooting.</li> </ul>"},{"location":"articles/#article-categories","title":"Article Categories","text":""},{"location":"articles/#salesforce-solutions","title":"Salesforce Solutions","text":"<p>Technical implementations and custom solutions built on the Salesforce platform.</p>"},{"location":"articles/#experience-cloud-enhancements","title":"Experience Cloud Enhancements","text":"<p>User experience improvements and custom functionality for our community portal.</p>"},{"location":"articles/#integration-patterns","title":"Integration Patterns","text":"<p>How we connect different systems and services to create seamless workflows.</p>"},{"location":"articles/#contributing","title":"Contributing","text":"<p>Have you solved an interesting technical problem or implemented a clever solution? Consider documenting it here to help other volunteers and showcase our technical capabilities.</p> <p>Contact the tech team at webdev@spokanemountaineers.org to contribute an article.</p>"},{"location":"articles/activity-group-event-notifications/","title":"Keeping Members Informed: Activity Group Event Notifications","text":"<p>Published: November 26, 2025 | Category: Community Solutions</p>"},{"location":"articles/activity-group-event-notifications/#the-problem-we-solved","title":"The Problem We Solved","text":"<p>Members of the Spokane Mountaineers were missing out on events they would have loved to attend. When event leaders posted new hikes, climbs, or other activities, members had no way to know unless they happened to check the website. This led to:</p> <ul> <li>Missed opportunities - Active members missing events they would have attended</li> <li>Lower engagement - Event leaders feeling like their posts went unseen</li> <li>Manual work - Admins and chairs having to manually promote events through email, Slack, or word of mouth</li> <li>Diminished value - The website wasn't serving as the central engagement tool it could be</li> </ul> <p>There was no way for members to automatically be notified when new events were posted for their favorite activity groups (like \"Hiking\" or \"Climbing\").</p>"},{"location":"articles/activity-group-event-notifications/#our-solution-activity-group-chatter-notifications","title":"Our Solution: Activity Group Chatter Notifications","text":"<p>We built an automated batch notification system that posts new event announcements directly to activity group Chatter groups. Now:</p> <ul> <li>Automatic batch notifications are posted to Chatter daily at 5am Pacific</li> <li>Batch processing collects all approved events that haven't been posted yet and groups them by activity group</li> <li>Rich text formatting makes posts visually appealing and easy to read</li> <li>Multiple events per post - When leaders approve 10-20 events at once, they're all included in a single comprehensive post</li> <li>Direct links to event registration pages for easy access</li> <li>Leverages existing subscriptions - Members who subscribe to Chatter groups automatically see notifications</li> <li>No additional setup - Works with existing Chatter group structure</li> </ul>"},{"location":"articles/activity-group-event-notifications/#how-it-works","title":"How It Works","text":""},{"location":"articles/activity-group-event-notifications/#the-batch-notification-service","title":"The Batch Notification Service","text":"<p>The system runs as a scheduled batch job:</p> <ol> <li>Daily Schedule - Runs every day at 5:00 AM Pacific Time</li> <li>Event Collection - Queries all <code>Event_Registration__c</code> records that are approved but haven't been posted yet (<code>Chatter_Posted__c != true</code>)</li> <li>Grouping - Events are automatically grouped by <code>Activity_Group__c</code></li> <li>Batch Posting - One comprehensive Chatter post is created per activity group containing all events for that group</li> <li>Members Notified - All members subscribed to those Chatter groups see the notifications in their feed</li> </ol>"},{"location":"articles/activity-group-event-notifications/#rich-text-formatting","title":"Rich Text Formatting","text":"<p>The notifications use Salesforce's Connect API to create beautifully formatted Chatter posts with:</p> <ul> <li>Bold headings - \"New {Activity Group} Event!\" (singular) or \"New {Activity Group} Events Added!\" (plural)</li> <li>Event count - \"We've added X new {Activity Group} events to the club calendar:\"</li> <li>Structured event details - Each event shown with:<ul> <li>Bold event name</li> <li>Leader, Start date/time, Location</li> <li>Direct link to event registration page</li> </ul> </li> <li>Simplified date format - Compact \"M/d/yy at h:mma\" format (e.g., \"1/15/26 at 7:00AM\")</li> <li>Professional formatting - Clean, readable layout that matches Chatter's native styling</li> </ul>"},{"location":"articles/activity-group-event-notifications/#smart-group-matching","title":"Smart Group Matching","text":"<p>The system automatically matches events to Chatter groups:</p> <ul> <li>Name-based matching - The <code>Activity_Group__c</code> field on the event must match the <code>Name</code> of a Public Chatter group</li> <li>Automatic lookup - The system finds the correct group without manual configuration</li> <li>Error handling - If a group isn't found, the flow logs an error but doesn't break the event approval process</li> </ul>"},{"location":"articles/activity-group-event-notifications/#what-members-see","title":"What Members See","text":""},{"location":"articles/activity-group-event-notifications/#before-our-solution","title":"Before Our Solution","text":"<ul> <li>No way to automatically know about new events</li> <li>Had to manually check the website for new events</li> <li>Missed events they would have attended</li> <li>No centralized notification system</li> </ul>"},{"location":"articles/activity-group-event-notifications/#after-our-solution","title":"After Our Solution","text":"<ul> <li>See new event notifications automatically in their subscribed Chatter groups</li> <li>Get event details directly in their Chatter feed</li> <li>Click through to view full event registration</li> <li>Can comment, like, and share event announcements</li> <li>Leverage existing Chatter subscription system</li> </ul>"},{"location":"articles/activity-group-event-notifications/#the-technical-approach","title":"The Technical Approach","text":""},{"location":"articles/activity-group-event-notifications/#what-we-built","title":"What We Built","text":"<ol> <li>Apex Batchable Class - <code>EventChatterBatchPoster</code> that implements <code>Database.Batchable&lt;SObject&gt;</code> and <code>Schedulable</code> for daily batch processing</li> <li>Apex Helper Class - <code>EventChatterPostHelper</code> with methods for posting single and batch events to Chatter groups</li> <li>Rich Text Builder - Methods to construct properly formatted Chatter posts using Connect API, including batch formatting with multiple events</li> <li>Scheduled Job - Runs daily at 5:00 AM Pacific Time to process all approved events that haven't been posted yet</li> <li>Comprehensive Tests - Full test coverage for both batch and helper classes ensuring reliability</li> </ol>"},{"location":"articles/activity-group-event-notifications/#why-this-approach-works","title":"Why This Approach Works","text":"<ul> <li>Non-disruptive - Works with existing <code>Event_Registration__c</code> and Chatter group structure</li> <li>Scalable - Handles bulk event approvals efficiently</li> <li>Maintainable - Uses standard Salesforce tools (Flows, Apex, Connect API)</li> <li>Extensible - Easy to add more formatting or features in the future</li> <li>User-friendly - Leverages Chatter's native notification system that members already use</li> </ul>"},{"location":"articles/activity-group-event-notifications/#key-features","title":"Key Features","text":""},{"location":"articles/activity-group-event-notifications/#rich-text-message-formatting","title":"Rich Text Message Formatting","text":"<p>The <code>EventChatterPostHelper</code> class builds rich text messages with:</p> <ul> <li>Bold title: \"New {Activity Group} Event!\"</li> <li>Introduction paragraph: Explains that a new event has been added</li> <li>Event details: Name, start date/time, and location</li> <li>View Event link: Direct link to the event registration page</li> </ul>"},{"location":"articles/activity-group-event-notifications/#automatic-group-discovery","title":"Automatic Group Discovery","text":"<p>The system automatically finds the correct Chatter group:</p> <pre><code>// Finds the Chatter group by matching Activity_Group__c to group Name\nList&lt;CollaborationGroup&gt; groups = [\n    SELECT Id, Name\n    FROM CollaborationGroup\n    WHERE Name = :activityGroupName\n    AND CollaborationType = 'Public'\n    LIMIT 1\n];\n</code></pre>"},{"location":"articles/activity-group-event-notifications/#error-handling","title":"Error Handling","text":"<p>The implementation is designed to be resilient:</p> <ul> <li>Missing groups - Logs error but doesn't break event approval</li> <li>Missing events - Handles cases where event record isn't found</li> <li>Null fields - Provides default values for missing event data</li> <li>Test context - Skips actual posting during test execution</li> </ul>"},{"location":"articles/activity-group-event-notifications/#invocable-method","title":"Invocable Method","text":"<p>The helper class provides an invocable method that can be called from Flows:</p> <pre><code>@InvocableMethod(label='Post Event to Chatter Group')\npublic static void postEventToChatterGroup(\n    List&lt;PostToChatterInput&gt; inputs\n)\n</code></pre> <p>This makes it easy to integrate with any Flow that needs to post event notifications.</p>"},{"location":"articles/activity-group-event-notifications/#results-and-impact","title":"Results and Impact","text":""},{"location":"articles/activity-group-event-notifications/#member-engagement","title":"Member Engagement","text":"<p>\u2705 Members automatically see new events in their subscribed Chatter groups \u2705 Event leaders get visibility for their approved events \u2705 Website becomes more integrated with Chatter for notifications \u2705 Reduced manual promotion work for admins \u2705 Leverages existing Chatter subscription system</p>"},{"location":"articles/activity-group-event-notifications/#technical-benefits","title":"Technical Benefits","text":"<p>\u2705 Scalable architecture that handles growth \u2705 Comprehensive test coverage (100% passing) \u2705 Well-documented for future maintenance \u2705 Extensible design for future features \u2705 Uses standard Salesforce APIs (Connect API)</p>"},{"location":"articles/activity-group-event-notifications/#for-administrators","title":"For Administrators","text":""},{"location":"articles/activity-group-event-notifications/#how-it-works_1","title":"How It Works","text":"<p>The batch job runs automatically:</p> <ol> <li>Scheduled Execution - Runs daily at 5:00 AM Pacific Time via Salesforce's scheduled job system</li> <li>Event Query - Queries all <code>Event_Registration__c</code> records where:<ul> <li><code>Status__c = 'Approved'</code></li> <li><code>Activity_Group__c != null</code></li> <li><code>Chatter_Posted__c != true</code> (includes <code>false</code>, <code>null</code>, or any non-true value)</li> </ul> </li> <li>Grouping - Events are automatically grouped by <code>Activity_Group__c</code></li> <li>Batch Posting - For each activity group:<ul> <li>Finds the matching Public Chatter group</li> <li>Builds a rich text message with all events for that group</li> <li>Posts a single comprehensive message to the Chatter group</li> </ul> </li> <li>Tracking - After posting, sets <code>Chatter_Posted__c = true</code> to prevent duplicate processing</li> </ol>"},{"location":"articles/activity-group-event-notifications/#chatter-group-requirements","title":"Chatter Group Requirements","text":"<p>For notifications to work, you need:</p> <ul> <li>Public Chatter groups with names matching activity group values</li> <li>Group names must exactly match <code>Activity_Group__c</code> values (e.g., \"Hiking\", \"Climbing\")</li> <li>Groups must exist before events are approved</li> </ul>"},{"location":"articles/activity-group-event-notifications/#monitoring","title":"Monitoring","text":"<p>Check Flow Execution:</p> <ol> <li>Go to Setup \u2192 Flows</li> <li>Find Notify Subscribers New Event</li> <li>Review Interview Logs to see execution history</li> </ol> <p>Check Chatter Posts:</p> <ul> <li>Navigate to the activity group Chatter group</li> <li>Look for posts titled \"New {Activity Group} Event!\"</li> <li>Posts appear immediately after event approval</li> </ul> <p>Query Event Registrations:</p> <pre><code>-- See recently approved events\nSELECT Id, Name, Activity_Group__c, Status__c, Start__c\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nORDER BY LastModifiedDate DESC\nLIMIT 10\n</code></pre>"},{"location":"articles/activity-group-event-notifications/#troubleshooting","title":"Troubleshooting","text":"<p>No Chatter posts appearing:</p> <ul> <li>Verify <code>Event_Registration__c</code> records have <code>Status__c = 'Approved'</code> and <code>Chatter_Posted__c != true</code></li> <li>Check that <code>Activity_Group__c</code> field is populated</li> <li>Verify a Public Chatter group exists with a name matching the <code>Activity_Group__c</code> value</li> <li>Check that the scheduled batch job is running (Setup \u2192 Apex Jobs)</li> <li>Review batch job execution logs for errors</li> <li>Check debug logs for EventChatterBatchPoster and EventChatterPostHelper errors</li> </ul> <p>Chatter group not found:</p> <ul> <li>Verify the Chatter group name exactly matches the <code>Activity_Group__c</code> value (case-sensitive)</li> <li>Ensure the group is Public (not Private or Unlisted)</li> <li>Check that the group exists and is active</li> </ul> <p>Batch job not running:</p> <ul> <li>Verify the scheduled job exists (Setup \u2192 Scheduled Jobs)</li> <li>Check that the job is scheduled for 5:00 AM Pacific Time</li> <li>Verify the job hasn't been aborted or failed</li> <li>Check AsyncApexJob records for execution history</li> <li>Manually trigger the batch job to test: <code>Database.executeBatch(new EventChatterBatchPoster(), 200);</code></li> </ul> <p>Rich text formatting issues:</p> <ul> <li>The Connect API handles formatting automatically</li> <li>Verify event fields (Name, <code>Start__c</code>, <code>Location__c</code>) are populated for best results</li> <li>Check debug logs if formatting appears incorrect</li> </ul>"},{"location":"articles/activity-group-event-notifications/#technical-implementation-details","title":"Technical Implementation Details","text":""},{"location":"articles/activity-group-event-notifications/#eventchatterbatchposter-class","title":"EventChatterBatchPoster Class","text":"<p>The batch class provides:</p> <p>Schedulable Interface:</p> <ul> <li><code>execute(SchedulableContext)</code> - Schedules the batch job to run daily at 5am Pacific</li> </ul> <p>Batchable Interface:</p> <ul> <li><code>start(Database.BatchableContext)</code> - Queries all approved events where <code>Chatter_Posted__c != true</code></li> <li><code>execute(Database.BatchableContext, List&lt;Event_Registration__c&gt;)</code> - Groups events by activity group and posts</li> <li><code>finish(Database.BatchableContext)</code> - Logs completion status</li> </ul> <p>Key Features:</p> <ul> <li>Processes events in batches of 200 records</li> <li>Groups events by Activity_Group__c before posting</li> <li>Posts one comprehensive message per activity group</li> <li>Handles errors gracefully (continues processing other groups if one fails)</li> </ul> <p>See: EventChatterBatchPoster.cls</p>"},{"location":"articles/activity-group-event-notifications/#eventchatterposthelper-class","title":"EventChatterPostHelper Class","text":"<p>The helper class provides:</p> <p>Batch Methods:</p> <ul> <li><code>postBatchToChatterGroup(String, List&lt;Event_Registration__c&gt;)</code> - Posts batch of events to a single group</li> <li><code>buildBatchRichTextMessageBody(List&lt;Event_Registration__c&gt;, String)</code> - Builds formatted message with multiple events</li> </ul> <p>Single Event Methods:</p> <ul> <li><code>postEventToChatterGroup(List&lt;PostToChatterInput&gt;)</code> - Invocable method for single event posting (legacy)</li> </ul> <p>Helper Methods:</p> <ul> <li><code>buildRichTextMessageBody(Event_Registration__c)</code> - Constructs formatted message for single event</li> <li><code>addParagraphText(...)</code> - Helper for adding text paragraphs</li> <li><code>addParagraphWithBoldText(...)</code> - Helper for adding bold text paragraphs</li> <li><code>addSpacerParagraph(...)</code> - Helper for adding blank lines between sections</li> <li><code>formatDateTime(DateTime)</code> - Formats dates as \"M/d/yy at h:mma\"</li> </ul> <p>Key Features:</p> <ul> <li>Uses Connect API for rich text formatting</li> <li>Handles null fields gracefully with defaults</li> <li>Supports both single and batch posting formats</li> <li>Comprehensive error handling and logging</li> </ul> <p>See: EventChatterPostHelper.cls</p>"},{"location":"articles/activity-group-event-notifications/#batch-job-structure","title":"Batch Job Structure","text":"<p>The <code>EventChatterBatchPoster</code> batch job is efficient and scalable:</p> <ol> <li>Schedule: Runs daily at 5:00 AM Pacific Time</li> <li>Query: Finds all events approved in last 24 hours</li> <li>Grouping: Automatically groups events by Activity_Group__c</li> <li>Posting: Creates one comprehensive post per activity group</li> <li>Error Handling: Continues processing even if one group fails</li> </ol> <p>This batch approach handles high-volume event approvals efficiently and reduces Chatter noise by consolidating multiple events into single posts.</p>"},{"location":"articles/activity-group-event-notifications/#future-enhancements","title":"Future Enhancements","text":"<p>We're planning several improvements:</p> <ol> <li>Reset Posted Flag - Allow admins to reset <code>Chatter_Posted__c</code> to reprocess events if needed</li> <li>Multiple Schedule Times - Run multiple times per day if needed</li> <li>Email Notifications - Add email notifications in addition to Chatter posts (Phase 2)</li> <li>Custom Templates - Allow customization of message format per activity group</li> <li>Image Support - Include event images in Chatter posts</li> <li>Multi-group Support - Post to multiple groups if an event spans multiple activity types</li> <li>Analytics - Track engagement metrics (views, clicks, comments)</li> <li>Service Account Integration - Use dedicated service account (<code>sm-client@prolocity.com</code>) for consistent posting identity</li> </ol>"},{"location":"articles/activity-group-event-notifications/#key-takeaways","title":"Key Takeaways","text":"<p>This solution demonstrates how automation can significantly improve member engagement while reducing manual work. By building on Salesforce's existing Chatter infrastructure, we created a solution that:</p> <ul> <li>Solves a real problem - Members automatically see new events they're interested in</li> <li>Scales automatically - Handles growth without additional configuration</li> <li>Maintains simplicity - Clean, focused implementation that's easy to understand</li> <li>Leverages existing tools - Uses Chatter groups members already subscribe to</li> <li>Professional presentation - Rich text formatting makes notifications stand out</li> </ul> <p>The approach balances simplicity with functionality, providing automatic notifications that keep members informed while integrating seamlessly with their existing Chatter workflow.</p> <p>For Technical Details: See the automation documentation for complete flow structure, code examples, and troubleshooting information.</p>"},{"location":"articles/enable-google-login/","title":"Enabling Google Login for Spokane Mountaineers Members","text":"<p>Published: December 2025 | Category: Experience Cloud Enhancements</p>"},{"location":"articles/enable-google-login/#the-problem-we-solved","title":"The Problem We Solved","text":"<p>Our members were asking for a simpler way to log in to the Spokane Mountaineers website. Many of them already use Google accounts for other services, and having to remember yet another password was becoming a barrier to accessing our community portal.</p> <p>We wanted to enable \"Sign in with Google\" functionality while ensuring that:</p> <ul> <li>Only existing members could use it (no bypassing our Donorbox registration process)</li> <li>The login would reliably match members to their existing accounts</li> <li>Members would get clear guidance if something went wrong</li> </ul>"},{"location":"articles/enable-google-login/#our-solution-google-oauth-with-smart-account-matching","title":"Our Solution: Google OAuth with Smart Account Matching","text":"<p>We implemented Google OAuth authentication that allows members to sign in using their Google account, but only if they already have a membership account created through our Donorbox registration process.</p>"},{"location":"articles/enable-google-login/#how-it-works","title":"How It Works","text":"<p>When a member clicks \"Sign in with Google\" on our login page:</p> <ol> <li>They authenticate with Google - Google verifies their identity</li> <li>We match their account - Our system looks up their existing membership account using their email address</li> <li>They're logged in - If a match is found, they're automatically signed in to their account</li> </ol>"},{"location":"articles/enable-google-login/#why-we-use-username-matching","title":"Why We Use Username Matching","text":"<p>We match member accounts by username pattern rather than email address. This approach provides several advantages:</p> <ul> <li>Usernames can't be changed - Once set, they remain constant</li> <li>Email addresses can change - Members might update their email in Salesforce but still use their old Google account</li> <li>More predictable - We always know the format: <code>email@example.com.smi</code></li> </ul> <p>This ensures that even if a member updates their email address in Salesforce, they can still log in with their Google account as long as their username follows the expected pattern.</p>"},{"location":"articles/enable-google-login/#what-members-experience","title":"What Members Experience","text":""},{"location":"articles/enable-google-login/#for-existing-members","title":"For Existing Members","text":"<p>If you already have a membership account:</p> <ol> <li>Click \"Sign in with Google\" on the login page</li> <li>Choose your Google account</li> <li>You're automatically logged in!</li> </ol> <p>The system recognizes your account and signs you in seamlessly.</p>"},{"location":"articles/enable-google-login/#for-new-members","title":"For New Members","text":"<p>If you don't have a membership account yet:</p> <ol> <li>Click \"Sign in with Google\" on the login page</li> <li>Choose your Google account</li> <li>You'll see a helpful message directing you to:<ul> <li>Sign up through Donorbox if you're a new member</li> <li>Contact webdev@spokanemountaineers.org if you already have an account but are having trouble</li> </ul> </li> </ol> <p>This ensures that new memberships still go through our proper registration and payment process via Donorbox.</p>"},{"location":"articles/enable-google-login/#if-something-goes-wrong","title":"If Something Goes Wrong","text":"<p>If you have an account but Google login isn't working:</p> <ol> <li>Use your regular login - Your standard username/password login still works</li> <li>Contact support - Email webdev@spokanemountaineers.org and we'll help you link your Google account</li> </ol>"},{"location":"articles/enable-google-login/#benefits-for-members","title":"Benefits for Members","text":"<ul> <li>One less password to remember - Use your existing Google account</li> <li>Faster login - No need to type username and password</li> <li>Secure - Google handles authentication securely</li> <li>Convenient - Works on any device where you're signed into Google</li> </ul>"},{"location":"articles/enable-google-login/#technical-details","title":"Technical Details","text":"<p>For technical implementation details, see our Google Login Automation documentation.</p>"},{"location":"articles/enable-google-login/#future-improvements","title":"Future Improvements","text":"<p>We're always looking to improve the member experience. Potential future enhancements include:</p> <ul> <li>Support for additional authentication providers</li> <li>Automatic account linking for existing members</li> <li>Enhanced error messages for edge cases</li> </ul>"},{"location":"articles/enable-google-login/#questions-or-issues","title":"Questions or Issues?","text":"<p>If you have questions about Google login or encounter any issues, please contact our tech team at webdev@spokanemountaineers.org.</p>"},{"location":"articles/event-participant-follow-handler-update/","title":"Event Participant Follow Handler: Tests, Deployment, and Lessons Learned","text":"<p>Over the last round of development we tightened up the <code>EventParticipantFollowHandler</code> logic, produced reliable Apex tests, and successfully deployed the trigger + handler bundle into the webdev5@spokanemountaineers.org sandbox. This post documents the journey end-to-end so future contributors can replicate the workflow (and avoid the potholes).</p>"},{"location":"articles/event-participant-follow-handler-update/#why-we-touched-this-area","title":"Why We Touched This Area","text":"<ul> <li>Ensure new <code>Event_Participant__c</code> records automatically follow the corresponding <code>Event_Registration__c</code> record via <code>EntitySubscription</code>, matching what Members see in Experience Cloud.</li> <li>Deliver reliable unit tests that prove happy path, negative scenarios, and bulk de-duplication.</li> <li>Provide a deployable package that clears Salesforce test coverage requirements (&gt;75% for both trigger and handler).</li> </ul>"},{"location":"articles/event-participant-follow-handler-update/#highlights","title":"Highlights","text":"<ul> <li>Test Data Isolation \u2013 Leveraged <code>@TestVisible</code> maps to inject registration/contact data, eliminating automation collisions with existing approval flows.</li> <li>Reusable Fixtures \u2013 Added a helper to fetch a live <code>Event_Registration__c</code> id and to create unique contacts + users on demand.</li> <li>Negative Coverage \u2013 Validated missing registration context and contacts without a related user to guarantee early exits remain defensive.</li> <li>Bulk Confidence \u2013 Simulated a 10-record insert twice, verifying de-duplication within the handler and against existing <code>EntitySubscription</code> rows (still scoped to the registration record).</li> <li>Community Ready \u2013 When the handler runs inside Experience Cloud we now stamp the site\u2019s <code>NetworkId</code> on each <code>EntitySubscription</code>, which satisfies Salesforce\u2019s sharing rules for community followers.</li> <li>Verified Deployment \u2013 <code>sf project deploy start ... --tests EventParticipantFollowHandlerTest</code> completes cleanly (Deploy ID <code>0AfUm0000019wgvKAA</code>, elapsed ~32s).</li> </ul>"},{"location":"articles/event-participant-follow-handler-update/#anatomy-of-the-new-tests","title":"Anatomy of the New Tests","text":"Scenario What We Assert Notes Happy Path <code>EntitySubscription</code> count += 1 on the registration Confirms attendees follow the page Members actually see. Missing User No subscription created Coverage for contacts without <code>User_Lookup__c</code>. Registration Missing No subscription created Simulates a missing registration record in test overrides. Bulk Insert Only one subscription exists Confirms composite key dedupe and pre-existing record check. <p>All tests rely on helpers such as <code>createContactWithUser(nextSuffix())</code> and <code>fetchAnyRegistrationId()</code> to guarantee unique context per method.</p>"},{"location":"articles/event-participant-follow-handler-update/#command-reference","title":"Command Reference","text":"<pre><code>sf project deploy start \\\n  --source-dir force-app/main/default/classes/EventParticipantFollowHandler.cls \\\n  --source-dir force-app/main/default/classes/EventParticipantFollowHandlerTest.cls \\\n  --source-dir force-app/main/default/triggers/EventParticipantTrigger.trigger \\\n  --target-org webdev5@spokanemountaineers.org \\\n  --test-level RunSpecifiedTests \\\n  --tests EventParticipantFollowHandlerTest\n</code></pre>"},{"location":"articles/event-participant-follow-handler-update/#whats-next","title":"What\u2019s Next","text":"<ul> <li>Mirror the test helpers (<code>testRegById</code>, contact fixtures) in adjacent trigger suites to unify pattern usage.</li> <li>Promote the deployment to higher environments once downstream automation owners sign off.</li> <li>Consider surfacing the registration feed in Experience Cloud so members immediately see the updates they auto-follow.</li> </ul> <p>Have questions or want to replicate the setup? Ping the Salesforce dev channel and reference this article\u2014everything you need is here.</p>"},{"location":"articles/event-participant-privacy-solution/","title":"Protecting Member Privacy in Event Participant Lists","text":"<p>Published: November 5, 2025 | Category: Community Solutions</p>"},{"location":"articles/event-participant-privacy-solution/#the-problem-we-solved","title":"The Problem We Solved","text":"<p>When members of the Spokane Mountaineers browse upcoming events in our community website, they can see who else is planning to attend. This is great for networking and coordination - but we discovered a privacy issue.</p> <p>When someone clicked on a participant's name, they were taken directly to that person's full Contact record in Salesforce. This exposed information that should remain private: phone numbers, addresses, and other personal details that aren't meant for public viewing.</p>"},{"location":"articles/event-participant-privacy-solution/#why-this-happened","title":"Why This Happened","text":"<p>Salesforce's Event system is designed for business use, where seeing full Contact details might be appropriate. But in a community website where members interact with each other, we needed a different approach - one that respects privacy while still allowing members to connect.</p>"},{"location":"articles/event-participant-privacy-solution/#our-solution-smart-profile-links","title":"Our Solution: Smart Profile Links","text":"<p>Instead of showing full Contact records, we built a system that intelligently routes members to appropriate profile pages:</p> <ul> <li>If a member has a community profile \u2192 Clicking their name takes you to their public User profile (which respects privacy settings)</li> <li>If no community profile exists \u2192 The name appears as plain text (not clickable)</li> </ul> <p>This way, members can still see who's attending events, but they only access information that's meant to be public.</p>"},{"location":"articles/event-participant-privacy-solution/#how-it-works","title":"How It Works","text":""},{"location":"articles/event-participant-privacy-solution/#the-bridge-between-contacts-and-users","title":"The Bridge Between Contacts and Users","text":"<p>At the heart of our solution is a simple connection: we link each Contact record to its corresponding User account (if one exists). This \"bridge\" allows us to know when someone has a community profile and should be clickable.</p>"},{"location":"articles/event-participant-privacy-solution/#automatic-synchronization","title":"Automatic Synchronization","text":"<p>We didn't want to manually maintain thousands of these connections. So we built automatic processes that:</p> <ol> <li>Keep new connections in sync - When a new User account is created, it automatically links to the matching Contact</li> <li>Backfill existing data - We ran a one-time process that matched 1,732 out of 1,747 existing Contacts to their User accounts (99.14% success rate)</li> <li>Handle updates - If a User's email changes, the connection updates automatically</li> </ol>"},{"location":"articles/event-participant-privacy-solution/#smart-matching","title":"Smart Matching","text":"<p>The system matches Contacts to Users using a prioritized approach:</p> <ol> <li>Email match (most reliable) - If the Contact email matches the User email exactly</li> <li>Federation ID match - For users who log in through external systems (like Google Workspace)</li> <li>Username pattern match - For users with specific username formats</li> </ol> <p>This ensures we find the right match even when email addresses aren't exactly the same.</p>"},{"location":"articles/event-participant-privacy-solution/#what-members-see","title":"What Members See","text":""},{"location":"articles/event-participant-privacy-solution/#before-our-solution","title":"Before Our Solution","text":"<ul> <li>Clicking a participant name \u2192 Full Contact record with private information</li> <li>No privacy controls</li> <li>Potential for information exposure</li> </ul>"},{"location":"articles/event-participant-privacy-solution/#after-our-solution","title":"After Our Solution","text":"<ul> <li>Clicking a participant name \u2192 Public User profile (if available)</li> <li>Privacy settings respected</li> <li>Plain text display when no profile exists</li> <li>Seamless experience - members don't notice the difference</li> </ul>"},{"location":"articles/event-participant-privacy-solution/#the-technical-approach","title":"The Technical Approach","text":""},{"location":"articles/event-participant-privacy-solution/#what-we-built","title":"What We Built","text":"<ol> <li>Custom Field - Added a lookup field on Contact records that points to the related User account</li> <li>Automation - Created Flows that automatically maintain these connections</li> <li>Custom Component - Built a replacement for the standard participant list that handles the smart routing</li> <li>Batch Processing - Developed efficient processes to sync thousands of records at once</li> </ol>"},{"location":"articles/event-participant-privacy-solution/#why-this-approach-works","title":"Why This Approach Works","text":"<ul> <li>Non-disruptive - Works with Salesforce's existing Event system</li> <li>Scalable - Handles our growing membership automatically</li> <li>Maintainable - Uses standard Salesforce tools and patterns</li> <li>Flexible - Can be extended or modified as needs change</li> </ul>"},{"location":"articles/event-participant-privacy-solution/#results-and-impact","title":"Results and Impact","text":""},{"location":"articles/event-participant-privacy-solution/#privacy-protection","title":"Privacy Protection","text":"<p>\u2705 Members' private information is no longer exposed through Event participant lists \u2705 Only public profile information is accessible \u2705 Privacy settings are respected automatically</p>"},{"location":"articles/event-participant-privacy-solution/#user-experience","title":"User Experience","text":"<p>\u2705 Seamless navigation - members don't notice the change \u2705 Consistent appearance - looks like standard Salesforce lists \u2705 Works for both linked and unlinked participants</p>"},{"location":"articles/event-participant-privacy-solution/#data-quality","title":"Data Quality","text":"<p>\u2705 99.14% of Contacts successfully linked to Users \u2705 Automatic maintenance keeps connections current \u2705 Handles edge cases gracefully</p>"},{"location":"articles/event-participant-privacy-solution/#for-administrators","title":"For Administrators","text":""},{"location":"articles/event-participant-privacy-solution/#monitoring-sync-status","title":"Monitoring Sync Status","text":"<p>You can check how many Contacts are linked to Users:</p> <pre><code>// Run in Developer Console or Anonymous Apex\nInteger totalContacts = [SELECT COUNT() FROM Contact WHERE Email != NULL];\nInteger syncedContacts = [SELECT COUNT() FROM Contact WHERE Email != NULL AND User_Lookup__c != NULL];\nInteger unsyncedContacts = totalContacts - syncedContacts;\n\nSystem.debug('Total contacts with email: ' + totalContacts);\nSystem.debug('Contacts synced to Users: ' + syncedContacts);\nSystem.debug('Contacts needing sync: ' + unsyncedContacts);\nSystem.debug('Sync completion rate: ' + (totalContacts &gt; 0 ? ((syncedContacts * 100.0 / totalContacts)).setScale(2) + '%' : '0%'));\n</code></pre>"},{"location":"articles/event-participant-privacy-solution/#manual-sync-when-needed","title":"Manual Sync (When Needed)","text":"<p>If you need to sync specific Contacts manually, you can use Anonymous Apex in the Developer Console:</p> <p>Sync a Single Contact:</p> <pre><code>// Replace with the actual Contact ID\nString contactId = '0031N00001K1hLJQAZ';\nBoolean success = EventParticipantRedirectHelper.syncContactToUser(contactId);\nSystem.debug('Sync result: ' + success);\n</code></pre> <p>Sync Multiple Contacts:</p> <pre><code>// Replace with actual Contact IDs\nList&lt;String&gt; contactIds = new List&lt;String&gt;{\n    '0031N00001K1hLJQAZ',\n    '003Um00000jXt3pIAC',\n    '0032G00002sd32kQAA'\n};\n\nList&lt;EventParticipantRedirectHelper.SyncResult&gt; results =\n    EventParticipantRedirectHelper.bulkSyncContactsToUsers(contactIds);\n\nfor (EventParticipantRedirectHelper.SyncResult result : results) {\n    System.debug('Contact ' + result.contactId + ': ' + (result.success ? 'Synced' : 'Failed'));\n}\n</code></pre> <p>Note: The Flow (<code>Sync_User_to_Contact</code>) exists but is not currently configured as a button or action on Contact records. For manual sync, use the Apex methods above.</p>"},{"location":"articles/event-participant-privacy-solution/#troubleshooting","title":"Troubleshooting","text":"<p>Participant names aren't clickable:</p> <ul> <li>The Contact may not have a linked User account</li> <li>This is normal - not all Contacts have corresponding User accounts</li> <li>The name will display as plain text</li> </ul> <p>Links go to wrong profiles:</p> <ul> <li>Check that the Contact's email matches the User's email</li> <li>Verify the User account is active and has a Community license</li> <li>Review the sync status for that Contact</li> </ul> <p>Sync isn't working:</p> <ul> <li>Verify the automation Flows are active</li> <li>Check that Contacts have email addresses</li> <li>Ensure User records exist with matching information</li> </ul>"},{"location":"articles/event-participant-privacy-solution/#future-enhancements","title":"Future Enhancements","text":"<p>We're considering several improvements:</p> <ol> <li>Better matching - Enhanced algorithms to find more matches</li> <li>Audit trail - Track when and how Contacts are linked to Users</li> <li>Admin dashboard - Visual interface for monitoring sync status</li> <li>Real-time updates - Even faster synchronization across systems</li> </ol>"},{"location":"articles/event-participant-privacy-solution/#key-takeaways","title":"Key Takeaways","text":"<p>This solution demonstrates how thoughtful design can solve privacy challenges while maintaining a great user experience. By working with Salesforce's existing systems rather than against them, we created a solution that:</p> <ul> <li>Protects member privacy</li> <li>Maintains system integrity</li> <li>Scales with our organization</li> <li>Requires minimal ongoing maintenance</li> </ul> <p>The approach balances technical sophistication with practical simplicity, providing robust privacy protection that our members can trust.</p> <p>For Technical Details: See the companion article \"Solving Event Participant Privacy in Experience Cloud\" for complete implementation details, code examples, and deployment instructions.</p>"},{"location":"articles/event-participant-redirect/","title":"Solving Event Participant Privacy in Experience Cloud","text":"<p>Published: November 5, 2025 | Category: Salesforce Solutions</p>"},{"location":"articles/event-participant-redirect/#the-privacy-puzzle-we-faced","title":"The Privacy Puzzle We Faced","text":"<p>Picture this: A community member is browsing our upcoming Events in Experience Cloud, curious about who else is attending. They click on an Event Participant's name, expecting to see a public profile. Instead, they land on a full Contact record - complete with phone numbers, addresses, and other information that should remain private.</p> <p>This wasn't just a theoretical concern. As the Spokane Mountaineers grew, we realized our Event Participant links were creating an unintended privacy loophole. The core issue was architectural: Salesforce's Event data model requires Event Participants to relate to Contact records, not User records. But Contact visibility isn't governed by User privacy settings, creating a disconnect between what we wanted (privacy-respecting profile views) and what we had (unrestricted Contact access).</p>"},{"location":"articles/event-participant-redirect/#our-approach-bridge-dont-replace","title":"Our Approach: Bridge, Don't Replace","text":"<p>Instead of fighting Salesforce's data model, we decided to work with it. The solution? Build a smart bridge between Contacts and Users, then use that bridge to make intelligent routing decisions.</p> <p>Here's how we tackled it step by step:</p>"},{"location":"articles/event-participant-redirect/#1-creating-the-connection-bridge","title":"1. Creating the Connection Bridge","text":"<p>First, we extended the Contact object with a custom lookup field:</p> <pre><code>&lt;!-- Contact.User_Lookup__c --&gt;\n&lt;CustomField xmlns=\"http://soap.sforce.com/2006/04/metadata\"&gt;\n    &lt;fullName&gt;User_Lookup__c&lt;/fullName&gt;\n    &lt;label&gt;Related User&lt;/label&gt;\n    &lt;referenceTo&gt;User&lt;/referenceTo&gt;\n    &lt;type&gt;Lookup&lt;/type&gt;\n&lt;/CustomField&gt;\n</code></pre> <p>This simple field creates a 1:1 relationship where possible, linking Contacts to their corresponding User records. It's the foundation of our entire solution.</p>"},{"location":"articles/event-participant-redirect/#2-automating-the-synchronization","title":"2. Automating the Synchronization","text":"<p>Manual data entry wasn't an option - we needed automation. We implemented a three-layered sync strategy:</p> <p>Real-time Sync: A record-triggered Flow that automatically updates the Contact lookup when Users are created or modified. This catches new users and any changes to existing ones.</p> <p>Batch Backfill: For our existing data, we created a batch Apex class that processes contacts in batches of 200, matching Contacts to Users based on a prioritized approach:</p> <ol> <li>Email Match (most reliable): <code>Contact.Email = User.Email</code></li> <li>FederationIdentifier Match: <code>Contact.Email</code> (transformed) = <code>User.FederationIdentifier</code><ul> <li>Transformation: Replace <code>@</code> with <code>_</code> and append <code>@spokanemountaineers.org</code></li> <li>Example: <code>jason@example.com</code> \u2192 <code>jason_example.com@spokanemountaineers.org</code></li> </ul> </li> <li>Username Match: <code>Contact.Email + '.smi' = User.Username</code><ul> <li>Example: <code>jason@example.com</code> \u2192 <code>jason@example.com.smi</code></li> </ul> </li> </ol> <p>This prioritized approach ensures we match the most reliable identifier first, avoiding duplicate email matches while handling various User naming conventions.</p> <p>Manual Sync: Apex methods available for administrators to manually trigger syncs when needed (via Anonymous Apex or custom automation).</p>"},{"location":"articles/event-participant-redirect/#3-the-smart-related-list-component","title":"3. The Smart Related List Component","text":"<p>Since Event Participants in our org use the custom <code>Event_Participant__c</code> object (which links to <code>Event_Registration__c</code>), we created a custom Lightning Web Component that replaces the standard related list:</p> <ul> <li>Custom Related List: <code>eventParticipantRelatedList</code> component that queries <code>Event_Participant__c</code> records</li> <li>Smart Click Handling: Participants with linked Users redirect to User profiles, others show plain text</li> <li>Rich Display: Shows participant Contact name and response information</li> <li>Graceful Degradation: Handles missing User relationships elegantly</li> <li>Visual Consistency: Styled to match Salesforce standard related list appearance</li> </ul> <p>The component checks each participant's <code>Contact.User_Lookup__c</code> field and creates conditional links:</p> <ul> <li>If a related User exists \u2192 Create a clickable link to their profile page (<code>/s/profile/{UserId}</code>)</li> <li>If no User exists \u2192 Show plain text (no link, just the name)</li> </ul>"},{"location":"articles/event-participant-redirect/#4-enhanced-user-experience","title":"4. Enhanced User Experience","text":"<p>We built a Lightning Web Component that handles the redirect gracefully:</p> <ul> <li>Shows a loading state while checking for User profile availability</li> <li>Displays participant names with proper styling matching Salesforce standards</li> <li>Respects Experience Cloud visibility rules automatically</li> <li>Provides smooth navigation without jarring page reloads</li> <li>Matches the visual appearance of standard Salesforce related lists</li> </ul>"},{"location":"articles/event-participant-redirect/#technical-deep-dive-what-we-built","title":"Technical Deep Dive: What We Built","text":""},{"location":"articles/event-participant-redirect/#custom-fields","title":"Custom Fields","text":"<ul> <li>Contact.User_Lookup__c - The bridge field linking Contacts to Users (Lookup relationship)</li> </ul>"},{"location":"articles/event-participant-redirect/#lightning-web-components","title":"Lightning Web Components","text":"<ul> <li>eventParticipantRelatedList - Custom related list that replaces standard Event Participants list with smart redirect functionality<ul> <li>Queries <code>Event_Participant__c</code> records for a given <code>Event_Registration__c</code></li> <li>Displays Contact names with conditional links to User profiles</li> <li>Styled to match Salesforce standard related list appearance</li> </ul> </li> </ul>"},{"location":"articles/event-participant-redirect/#flows","title":"Flows","text":"<ul> <li>Sync_User_to_Contact - Manual sync operations for administrators</li> <li>User_to_Contact_Sync_Trigger - Automatic real-time sync when Users change (Before Save trigger)</li> </ul>"},{"location":"articles/event-participant-redirect/#apex-classes","title":"Apex Classes","text":"<ul> <li>EventParticipantRedirectHelper - Core business logic and utility methods<ul> <li><code>getEventParticipants(String eventId)</code> - Retrieves participants for an Event or Event_Registration__c</li> <li><code>bulkSyncContactsToUsers(List&lt;String&gt; contactIds)</code> - Efficient bulk sync method (2 SOQL queries total)</li> <li><code>syncContactToUser(String contactId)</code> - Single contact sync method</li> </ul> </li> </ul>"},{"location":"articles/event-participant-redirect/#deployment-strategy-minimal-disruption","title":"Deployment Strategy: Minimal Disruption","text":"<p>We rolled this out carefully to avoid breaking anything:</p> <ol> <li>Deploy metadata - All custom fields, classes, and components</li> <li>Run batch sync - Backfill existing Contact-User relationships (achieved 99.14% sync rate)</li> <li>Update layouts - Replace standard related list with our custom component</li> <li>Test thoroughly - Verify both linked and unlinked scenarios work perfectly</li> </ol>"},{"location":"articles/event-participant-redirect/#the-results-privacy-preserved-experience-enhanced","title":"The Results: Privacy Preserved, Experience Enhanced","text":"<p>Privacy Protection: Community users now see User profile pages that respect privacy settings instead of unrestricted Contact records.</p> <p>Seamless Experience: The redirect is completely transparent - users click a name and get the appropriate view based on data availability.</p> <p>Data Integrity: We maintained Salesforce's standard Event data model while adding the necessary intelligence.</p> <p>Scalability: The batch processing and automated sync ensure this works as our organization continues to grow. Our initial sync processed 1,732 out of 1,747 contacts (99.14% success rate).</p> <p>Performance: The bulk sync method uses only 2-3 SOQL queries regardless of contact count, making it highly efficient for large-scale operations.</p>"},{"location":"articles/event-participant-redirect/#lessons-from-the-trenches","title":"Lessons from the Trenches","text":"<p>Think Beyond the Obvious: Initially, we considered overriding the standard related list entirely. But a custom LWC approach was cleaner, more maintainable, and less disruptive.</p> <p>Multiple Sync Strategies: Real-time sync is great for new data, but batch processing is essential for existing records. You need both.</p> <p>Prioritized Matching: Using a prioritized matching approach (Email \u2192 FederationIdentifier \u2192 Username) ensures we match the most reliable identifier first while handling various User naming conventions.</p> <p>Graceful Degradation: Not every Contact will have a corresponding User. The solution handles this elegantly with plain text display rather than broken links.</p> <p>Test Edge Cases: We discovered scenarios where Users exist but aren't community-enabled, requiring additional validation in our logic.</p>"},{"location":"articles/event-participant-redirect/#whats-next","title":"What's Next?","text":"<p>We're already thinking about enhancements:</p> <ol> <li>Platform Events for real-time sync across multiple systems</li> <li>Enhanced Matching algorithms for Contact-User relationships</li> <li>Audit Trail to track sync history and changes over time</li> <li>Admin Dashboard for monitoring sync status and statistics</li> </ol>"},{"location":"articles/event-participant-redirect/#the-takeaway","title":"The Takeaway","text":"<p>This solution shows how thoughtful Salesforce architecture can solve complex privacy and user experience challenges. By extending the standard data model rather than replacing it, we achieved our goals while maintaining system integrity and future compatibility.</p> <p>The approach balances technical elegance with practical considerations, providing a robust solution that scales with our organization's needs while keeping our members' privacy intact.</p> <p>Technical Implementation: All code and metadata for this solution is available in the SMI repository under <code>force-app/main/default/</code>. See below for deployment instructions.</p>"},{"location":"articles/event-participant-redirect/#implementation-guide-deploying-the-solution","title":"Implementation Guide: Deploying the Solution","text":"<p>Here's everything you need to deploy this privacy-enhancing solution to your own org:</p>"},{"location":"articles/event-participant-redirect/#custom-fields-we-created","title":"Custom Fields We Created","text":""},{"location":"articles/event-participant-redirect/#contactuser_lookup__c","title":"Contact.User_Lookup__c","text":"<ul> <li>Type: Lookup (User)</li> <li>Purpose: The bridge field linking Contacts to Users</li> <li>Location: <code>/objects/Contact/fields/User_Lookup__c.field-meta.xml</code></li> </ul>"},{"location":"articles/event-participant-redirect/#flows-for-automation","title":"Flows for Automation","text":""},{"location":"articles/event-participant-redirect/#sync_user_to_contact","title":"Sync_User_to_Contact","text":"<ul> <li>Type: Autolaunched Flow</li> <li>Purpose: Utility Flow for syncing a Contact to its matching User record</li> <li>Input: <code>recordId</code> (Contact ID)</li> <li>Note: This Flow exists but is not currently configured as a button or action on Contact records. For manual sync, use the Apex methods <code>syncContactToUser()</code> or <code>bulkSyncContactsToUsers()</code> via Anonymous Apex.</li> <li>Location: <code>/flows/Sync_User_to_Contact.flow-meta.xml</code></li> </ul>"},{"location":"articles/event-participant-redirect/#user_to_contact_sync_trigger","title":"User_to_Contact_Sync_Trigger","text":"<ul> <li>Type: Record-Triggered Flow (User, Before Save)</li> <li>Purpose: Automatically syncs User to Contact when Users are created/updated</li> <li>Location: <code>/flows/User_to_Contact_Sync_Trigger.flow-meta.xml</code></li> </ul>"},{"location":"articles/event-participant-redirect/#apex-classes-for-core-logic","title":"Apex Classes for Core Logic","text":""},{"location":"articles/event-participant-redirect/#eventparticipantredirecthelper","title":"EventParticipantRedirectHelper","text":"<ul> <li>Purpose: Provides methods for redirect logic and batch sync operations</li> <li>Key Methods:<ul> <li><code>getEventParticipants(String eventId)</code> - Returns list of participants for an Event or Event_Registration__c</li> <li><code>bulkSyncContactsToUsers(List&lt;String&gt; contactIds)</code> - Recommended: Efficient bulk sync method (2-3 SOQL queries total)</li> <li><code>syncContactToUser(String contactId)</code> - Single contact sync method (legacy, use bulk method for multiple contacts)</li> </ul> </li> <li>Performance: The <code>bulkSyncContactsToUsers</code> method reduces SOQL queries from ~3 per contact to just 2-3 total queries regardless of contact count</li> <li>Location: <code>/classes/EventParticipantRedirectHelper.cls</code></li> </ul>"},{"location":"articles/event-participant-redirect/#lightning-web-component","title":"Lightning Web Component","text":""},{"location":"articles/event-participant-redirect/#eventparticipantrelatedlist","title":"eventParticipantRelatedList","text":"<ul> <li>Purpose: Custom related list component for Event Participants in Experience Cloud</li> <li>Features:<ul> <li>Queries <code>Event_Participant__c</code> records for <code>Event_Registration__c</code></li> <li>Displays Contact names with conditional links to User profiles</li> <li>Styled to match Salesforce standard related list appearance</li> <li>Handles loading states and errors gracefully</li> </ul> </li> <li>Location: <code>/lwc/eventParticipantRelatedList/</code></li> </ul>"},{"location":"articles/event-participant-redirect/#step-by-step-deployment","title":"Step-by-Step Deployment","text":""},{"location":"articles/event-participant-redirect/#1-deploy-custom-fields","title":"1. Deploy Custom Fields","text":"<pre><code># Deploy Contact custom field\nsf project deploy start \\\n    --source-dir force-app/main/default/objects/Contact/fields/User_Lookup__c.field-meta.xml \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#2-deploy-apex-classes","title":"2. Deploy Apex Classes","text":"<pre><code># Deploy Apex classes with tests\nsf project deploy start \\\n    --source-dir force-app/main/default/classes/EventParticipantRedirectHelper.cls \\\n    --source-dir force-app/main/default/classes/EventParticipantRedirectHelperTest.cls \\\n    --test-level RunSpecifiedTests \\\n    --tests EventParticipantRedirectHelperTest \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#3-deploy-flows","title":"3. Deploy Flows","text":"<pre><code>sf project deploy start \\\n    --source-dir force-app/main/default/flows/Sync_User_to_Contact.flow-meta.xml \\\n    --source-dir force-app/main/default/flows/User_to_Contact_Sync_Trigger.flow-meta.xml \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#4-deploy-lightning-web-components","title":"4. Deploy Lightning Web Components","text":"<pre><code>sf project deploy start \\\n    --source-dir force-app/main/default/lwc/eventParticipantRelatedList \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#5-alternative-deploy-all-components-at-once","title":"5. Alternative: Deploy All Components at Once","text":"<pre><code># Deploy all Event Participant Redirect components at once\nsf project deploy start \\\n    --source-dir force-app/main/default/classes \\\n    --source-dir force-app/main/default/flows \\\n    --source-dir force-app/main/default/lwc \\\n    --source-dir force-app/main/default/objects \\\n    --test-level RunSpecifiedTests \\\n    --tests EventParticipantRedirectHelperTest \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#post-deployment-setup","title":"Post-Deployment Setup","text":""},{"location":"articles/event-participant-redirect/#1-run-the-backfill-batch","title":"1. Run the Backfill Batch","text":"<p>Execute this in Developer Console or Anonymous Apex to sync existing data:</p> <pre><code>// Sync existing Contacts using bulk method\nList&lt;Contact&gt; contactsToSync = [\n    SELECT Id, Email, User_Lookup__c\n    FROM Contact\n    WHERE Email != NULL\n    AND User_Lookup__c = NULL\n    LIMIT 200\n];\n\nList&lt;String&gt; contactIds = new List&lt;String&gt;();\nfor (Contact c : contactsToSync) {\n    contactIds.add(c.Id);\n}\n\nList&lt;EventParticipantRedirectHelper.SyncResult&gt; results =\n    EventParticipantRedirectHelper.bulkSyncContactsToUsers(contactIds);\n\nInteger successCount = 0;\nfor (EventParticipantRedirectHelper.SyncResult result : results) {\n    if (result.success) successCount++;\n}\n\nSystem.debug('Synced ' + successCount + ' out of ' + results.size() + ' contacts');\n</code></pre> <p>Expected Results: In our org, we achieved a 99.14% sync rate (1,732 out of 1,747 contacts successfully synced).</p>"},{"location":"articles/event-participant-redirect/#2-update-event-page-layout","title":"2. Update Event Page Layout","text":"<ol> <li>Navigate to Experience Cloud Builder</li> <li>Edit the Event Registration page layout</li> <li>Remove the standard Event Participants related list (if present)</li> <li>Add the custom <code>eventParticipantRelatedList</code> component</li> <li>Configure the component to show on Event Registration records</li> <li>Save and publish the layout</li> </ol>"},{"location":"articles/event-participant-redirect/#3-test-everything","title":"3. Test Everything","text":"<ol> <li>Create a test Event Registration with multiple participants</li> <li>Verify some participants have linked User accounts</li> <li>Test clicking participant names in Experience Cloud</li> <li>Confirm redirects work correctly for both linked and unlinked participants</li> <li>Verify the component styling matches standard Salesforce related lists</li> </ol>"},{"location":"articles/event-participant-redirect/#bulk-sync-operations","title":"Bulk Sync Operations","text":""},{"location":"articles/event-participant-redirect/#efficient-bulk-sync-method","title":"Efficient Bulk Sync Method","text":"<p>We've implemented a high-performance bulk sync method that dramatically reduces SOQL query usage:</p> <p>Performance Comparison:</p> <ul> <li>Legacy Method: ~3 SOQL queries per contact</li> <li>New Bulk Method: Only 2-3 SOQL queries total regardless of contact count</li> <li>Efficiency Gain: 1,000 contacts = 3,000 queries \u2192 3 queries (99.9% reduction!)</li> </ul>"},{"location":"articles/event-participant-redirect/#bulk-sync-examples","title":"Bulk Sync Examples","text":""},{"location":"articles/event-participant-redirect/#1-sync-specific-contacts-by-id","title":"1. Sync Specific Contacts by ID","text":"<pre><code>// Sync specific contacts by ID (most efficient)\nList&lt;String&gt; contactIds = new List&lt;String&gt;{\n    '0031N00001K1hLJQAZ',  // Contact 1\n    '003Um00000jXt3pIAC',  // Contact 2\n    '0032G00002sd32kQAA'   // Contact 3\n};\n\nList&lt;EventParticipantRedirectHelper.SyncResult&gt; results =\n    EventParticipantRedirectHelper.bulkSyncContactsToUsers(contactIds);\n\n// Check results\nfor (EventParticipantRedirectHelper.SyncResult result : results) {\n    System.debug('Contact ' + result.contactId + ' sync result: ' + result.success);\n}\n</code></pre>"},{"location":"articles/event-participant-redirect/#2-sync-contacts-in-batches","title":"2. Sync Contacts in Batches","text":"<pre><code>// Sync contacts in batches of 50 (optimal for governor limits)\nList&lt;Contact&gt; contactsToSync = [\n    SELECT Id, Name, Email, User_Lookup__c\n    FROM Contact\n    WHERE Email != NULL\n    AND User_Lookup__c = NULL\n    ORDER BY CreatedDate\n    LIMIT 400\n];\n\nInteger totalContacts = contactsToSync.size();\nSystem.debug('Found ' + totalContacts + ' contacts to sync');\n\nInteger successCount = 0;\nInteger failureCount = 0;\nInteger batchSize = 50;\nList&lt;String&gt; currentBatch = new List&lt;String&gt;();\n\nfor (Integer i = 0; i &lt; contactsToSync.size(); i++) {\n    Contact contact = contactsToSync[i];\n    currentBatch.add(contact.Id);\n\n    if (currentBatch.size() &gt;= batchSize || i == contactsToSync.size() - 1) {\n        System.debug('Processing batch of ' + currentBatch.size() + ' contacts');\n\n        List&lt;EventParticipantRedirectHelper.SyncResult&gt; batchResults =\n            EventParticipantRedirectHelper.bulkSyncContactsToUsers(currentBatch);\n\n        for (EventParticipantRedirectHelper.SyncResult result : batchResults) {\n            if (result.success) {\n                successCount++;\n            } else {\n                failureCount++;\n            }\n        }\n\n        currentBatch.clear();\n    }\n}\n\nSystem.debug('Sync completed: ' + successCount + ' successful, ' + failureCount + ' failed');\nSystem.debug('SOQL queries used: ' + Limits.getQueries() + '/' + Limits.getLimitQueries());\n</code></pre>"},{"location":"articles/event-participant-redirect/#3-sync-all-event-participants-for-a-specific-event","title":"3. Sync All Event Participants for a Specific Event","text":"<pre><code>// Sync all participants for a specific Event_Registration__c\nString eventRegistrationId = 'a122G000008VdzJQAS'; // Replace with your Event_Registration__c ID\n\n// Get all Event_Participant__c records for this Event_Registration__c\nList&lt;Event_Participant__c&gt; participants = [\n    SELECT Contact__c\n    FROM Event_Participant__c\n    WHERE Event_Registration__c = :eventRegistrationId\n    AND Contact__c != null\n];\n\n// Extract Contact IDs\nList&lt;String&gt; contactIds = new List&lt;String&gt;();\nfor (Event_Participant__c participant : participants) {\n    contactIds.add(participant.Contact__c);\n}\n\nif (!contactIds.isEmpty()) {\n    System.debug('Syncing ' + contactIds.size() + ' Event participants...');\n\n    List&lt;EventParticipantRedirectHelper.SyncResult&gt; results =\n        EventParticipantRedirectHelper.bulkSyncContactsToUsers(contactIds);\n\n    Integer successCount = 0;\n    for (EventParticipantRedirectHelper.SyncResult result : results) {\n        if (result.success) successCount++;\n    }\n\n    System.debug('Event participant sync completed: ' + successCount + '/' + results.size() + ' successful');\n}\n</code></pre>"},{"location":"articles/event-participant-redirect/#performance-monitoring","title":"Performance Monitoring","text":"<p>The bulk sync method includes built-in performance monitoring:</p> <pre><code>// Monitor SOQL usage during bulk sync\nSystem.debug('SOQL queries used: ' + Limits.getQueries());\nSystem.debug('SOQL queries remaining: ' + (Limits.getLimitQueries() - Limits.getQueries()));\n</code></pre> <p>Expected Results:</p> <ul> <li>Small batches (50 contacts): ~3 SOQL queries total</li> <li>Large batches (1,000+ contacts): ~3 SOQL queries total</li> <li>Query limit usage: &lt;5% regardless of contact count</li> </ul>"},{"location":"articles/event-participant-redirect/#matching-logic-details","title":"Matching Logic Details","text":""},{"location":"articles/event-participant-redirect/#prioritized-matching-strategy","title":"Prioritized Matching Strategy","text":"<p>The sync process uses a three-tier matching approach:</p> <ol> <li> <p>Email Match (Highest Priority)</p> <ul> <li><code>Contact.Email = User.Email</code></li> <li>Most reliable match, used first</li> </ul> </li> <li> <p>FederationIdentifier Match (Second Priority)</p> <ul> <li>Transformation: <code>Contact.Email.replace('@', '_') + '@spokanemountaineers.org'</code></li> <li>Example: <code>jason@example.com</code> \u2192 <code>jason_example.com@spokanemountaineers.org</code></li> <li>Matches against <code>User.FederationIdentifier</code></li> </ul> </li> <li> <p>Username Match (Third Priority)</p> <ul> <li>Pattern: <code>Contact.Email + '.smi'</code></li> <li>Example: <code>jason@example.com</code> \u2192 <code>jason@example.com.smi</code></li> <li>Matches against <code>User.Username</code></li> </ul> </li> </ol> <p>This prioritized approach ensures:</p> <ul> <li>Most reliable matches are found first</li> <li>Handles various User naming conventions</li> <li>Avoids duplicate matches when multiple Users share the same email</li> </ul>"},{"location":"articles/event-participant-redirect/#security-privacy-considerations","title":"Security &amp; Privacy Considerations","text":"<ul> <li>\u2705 Respects User privacy settings by redirecting to User profile pages</li> <li>\u2705 Shows plain text (no link) when no related User exists</li> <li>\u2705 Community users only see User profiles that respect Experience Cloud visibility rules</li> <li>\u2705 Internal users retain standard Contact access for business operations</li> <li>\u2705 No sensitive Contact data exposed to community users</li> </ul>"},{"location":"articles/event-participant-redirect/#troubleshooting-common-issues","title":"Troubleshooting Common Issues","text":""},{"location":"articles/event-participant-redirect/#bulk-sync-performance-issues","title":"Bulk Sync Performance Issues?","text":"<p>High SOQL Query Usage:</p> <ul> <li>Ensure you're using <code>bulkSyncContactsToUsers()</code> instead of individual <code>syncContactToUser()</code> calls</li> <li>Check that you're processing contacts in batches of 50 or fewer</li> <li>Monitor query usage: <code>System.debug('Queries used: ' + Limits.getQueries());</code></li> </ul> <p>Memory Limit Errors:</p> <ul> <li>Reduce batch size from 50 to 25 if processing contacts with large data</li> <li>Use QueryLocator for very large datasets (&gt;10,000 contacts)</li> <li>Clear collections between batches: <code>currentBatch.clear();</code></li> </ul> <p>Slow Performance:</p> <ul> <li>The bulk sync method should complete 1,000 contacts in &lt;30 seconds</li> <li>If slower, check for custom triggers on Contact objects</li> <li>Verify User lookup indexes are in place</li> </ul>"},{"location":"articles/event-participant-redirect/#redirects-not-working","title":"Redirects Not Working?","text":"<ul> <li>Verify <code>Contact.User_Lookup__c</code> field is populated</li> <li>Check that User records are active and have Community licenses</li> <li>Ensure Experience Cloud profile URL format matches <code>/s/profile/{UserId}</code></li> <li>Verify the <code>eventParticipantRelatedList</code> component is properly added to the page layout</li> </ul>"},{"location":"articles/event-participant-redirect/#batch-sync-not-finding-matches","title":"Batch Sync Not Finding Matches?","text":"<ul> <li>Verify User email addresses match Contact emails exactly (for Email match)</li> <li>Check for FederationIdentifier matches if email sync fails</li> <li>Review the transformation logic: <code>email.replace('@', '_') + '@spokanemountaineers.org'</code></li> <li>Check for Username pattern matches: <code>email + '.smi'</code></li> <li>Review batch job completion email for statistics</li> </ul>"},{"location":"articles/event-participant-redirect/#flow-trigger-not-firing","title":"Flow Trigger Not Firing?","text":"<ul> <li>Verify <code>User_to_Contact_Sync_Trigger</code> Flow is active</li> <li>Check that User records have email addresses</li> <li>Ensure Contact records exist with matching emails</li> <li>Review Flow debug logs for any errors</li> </ul>"},{"location":"articles/event-participant-redirect/#component-not-displaying","title":"Component Not Displaying?","text":"<ul> <li>Verify <code>eventParticipantRelatedList</code> component is added to the page layout</li> <li>Check that the component has access to the Event_Registration__c record</li> <li>Review browser console for JavaScript errors</li> <li>Ensure the <code>Event_Registration__c</code> has <code>Event_Participant__c</code> records</li> </ul>"},{"location":"articles/event-participant-redirect/#monitoring-maintenance","title":"Monitoring &amp; Maintenance","text":"<ul> <li>Monitor batch job completion emails for sync statistics</li> <li>Check Flow debug logs for any sync errors</li> <li>Review Experience Cloud access logs for redirect patterns</li> <li>Periodically verify Contact-User relationships are staying in sync</li> <li>Monitor SOQL query usage during bulk sync operations</li> </ul>"},{"location":"articles/event-participant-redirect/#future-enhancement-ideas","title":"Future Enhancement Ideas","text":"<ol> <li>Real-time sync: Consider Platform Events for immediate Contact-User sync across systems</li> <li>Multiple User matching: Add logic for handling multiple matching Users intelligently</li> <li>Custom matching rules: Extend sync logic to include additional matching criteria beyond email</li> <li>Audit trail: Add custom object to track Contact-User sync history and changes</li> <li>Admin dashboard: Create a Lightning component for monitoring sync status and statistics</li> </ol>"},{"location":"articles/event-participant-redirect/#backout-plan-rolling-back-the-solution","title":"Backout Plan: Rolling Back the Solution","text":"<p>This section provides a comprehensive rollback plan in case the Event Participant Redirect solution needs to be reverted.</p>"},{"location":"articles/event-participant-redirect/#when-to-consider-rollback","title":"When to Consider Rollback","text":"<ul> <li>Performance Issues: Significant slowdown in Event page loads or related list performance</li> <li>Sync Problems: Large-scale data corruption or incorrect Contact-User relationships</li> <li>User Experience: Negative feedback from community users or navigation issues</li> <li>Security Concerns: Unexpected privacy breaches or access control problems</li> <li>Business Requirements: Change in privacy policies or Event management approach</li> </ul>"},{"location":"articles/event-participant-redirect/#step-by-step-rollback-process","title":"Step-by-Step Rollback Process","text":""},{"location":"articles/event-participant-redirect/#phase-1-disable-new-functionality","title":"Phase 1: Disable New Functionality","text":"<p>1. Deactivate Flows</p> <ul> <li>Navigate to Setup \u2192 Flows</li> <li>Find <code>User_to_Contact_Sync_Trigger</code> and <code>Sync_User_to_Contact</code></li> <li>Click \"Deactivate\" for each Flow</li> </ul> <p>2. Remove Lightning Component</p> <ul> <li>Edit Event Registration page layouts in Experience Cloud Builder</li> <li>Remove the <code>eventParticipantRelatedList</code> component</li> <li>Replace with standard related list if needed</li> <li>Save and publish the layout</li> </ul>"},{"location":"articles/event-participant-redirect/#phase-2-revert-data-model-changes-optional","title":"Phase 2: Revert Data Model Changes (Optional)","text":"<p>3. Clear Contact User Lookups (Optional)</p> <pre><code>// Execute in Anonymous Apex to clear all User lookups\nList&lt;Contact&gt; contactsToUpdate = [\n    SELECT Id, User_Lookup__c\n    FROM Contact\n    WHERE User_Lookup__c != null\n    LIMIT 50000\n];\n\nfor (Contact contact : contactsToUpdate) {\n    contact.User_Lookup__c = null;\n}\n\nupdate contactsToUpdate;\nSystem.debug('Cleared User lookup from ' + contactsToUpdate.size() + ' Contacts');\n</code></pre>"},{"location":"articles/event-participant-redirect/#phase-3-remove-custom-components-optional-destructive","title":"Phase 3: Remove Custom Components (Optional - Destructive)","text":"<p>4. Delete Custom Fields</p> <pre><code># WARNING: This is destructive!\nsf project delete source \\\n    --source-dir force-app/main/default/objects/Contact/fields/User_Lookup__c.field-meta.xml \\\n    --target-org your-org-alias\n</code></pre> <p>5. Delete Apex Classes</p> <pre><code>sf project delete source \\\n    --source-dir force-app/main/default/classes/EventParticipantRedirectHelper.cls \\\n    --source-dir force-app/main/default/classes/EventParticipantRedirectHelperTest.cls \\\n    --target-org your-org-alias\n</code></pre> <p>6. Delete Flows</p> <pre><code>sf project delete source \\\n    --source-dir force-app/main/default/flows/Sync_User_to_Contact.flow-meta.xml \\\n    --source-dir force-app/main/default/flows/User_to_Contact_Sync_Trigger.flow-meta.xml \\\n    --target-org your-org-alias\n</code></pre> <p>7. Delete Lightning Component</p> <pre><code>sf project delete source \\\n    --source-dir force-app/main/default/lwc/eventParticipantRelatedList \\\n    --target-org your-org-alias\n</code></pre>"},{"location":"articles/event-participant-redirect/#rollback-validation","title":"Rollback Validation","text":"<p>Functionality Testing</p> <ul> <li> Event pages load normally</li> <li> Event Participants related list shows standard Contact names</li> <li> Clicking participant names opens Contact records (original behavior)</li> <li> No broken links or error messages</li> <li> Performance returns to baseline levels</li> </ul> <p>Data Integrity Checks</p> <ul> <li> Contact records are unchanged</li> <li> Event relationships remain intact</li> <li> No orphaned lookup relationships</li> <li> User data is preserved</li> </ul> <p>Remember: Test rollback procedures in a sandbox environment before executing in production. Always have a recent backup available before making destructive changes.</p>"},{"location":"articles/experience-cloud-account-access-restriction/","title":"Restricting Member Access to Account Records in Experience Cloud","text":"<p>Published: January 2026 | Category: Experience Cloud Enhancements</p>"},{"location":"articles/experience-cloud-account-access-restriction/#the-problem-we-discovered","title":"The Problem We Discovered","text":"<p>We recently identified a privacy concern on our member website. Members could use the global search feature to view Account records belonging to other members. For example, searching for \"Adams\" would return results like \"Adams Household,\" exposing sensitive internal data such as:</p> <ul> <li>Member Type</li> <li>Donation Amounts</li> <li>Other administrative information</li> </ul> <p>This information should only be visible to system administrators, not regular members browsing the site.</p>"},{"location":"articles/experience-cloud-account-access-restriction/#our-solution-profile-level-access-control","title":"Our Solution: Profile-Level Access Control","text":"<p>We resolved this issue by removing Read access to the Account object for all member-facing Experience Cloud profiles. This ensures that Account records are no longer visible or searchable for members on the website, while internal staff access remains unchanged.</p>"},{"location":"articles/experience-cloud-account-access-restriction/#affected-profiles","title":"Affected Profiles","text":"<p>The following Experience Cloud profiles were updated to remove Account object read access:</p> <ul> <li>SM Community Plus Chair</li> <li>SM Community Plus Login</li> <li>SM Community Plus Member</li> </ul>"},{"location":"articles/experience-cloud-account-access-restriction/#what-members-experience","title":"What Members Experience","text":""},{"location":"articles/experience-cloud-account-access-restriction/#before-the-fix","title":"Before the Fix","text":"<ul> <li>Global search could return Account records for other members</li> <li>Members could view household information and donation data</li> <li>Internal administrative data was inadvertently exposed</li> </ul>"},{"location":"articles/experience-cloud-account-access-restriction/#after-the-fix","title":"After the Fix","text":"<ul> <li>Account records no longer appear in search results</li> <li>Members can still access their own profile and contact information</li> <li>Only system administrators can view Account records</li> <li>Member functionality remains otherwise unchanged</li> </ul>"},{"location":"articles/experience-cloud-account-access-restriction/#technical-implementation","title":"Technical Implementation","text":"<p>For each affected profile, we followed these steps:</p> <ol> <li>Navigate to Setup \u2192 Profiles</li> <li>Select the profile name (e.g., \"SM Community Plus Member\")</li> <li>Go to Object Settings \u2192 Account</li> <li>Click Edit</li> <li>Uncheck the \"Read\" permission</li> <li>Click Save</li> </ol> <p>This simple configuration change immediately prevents members from viewing any Account records through the Experience Cloud interface.</p>"},{"location":"articles/experience-cloud-account-access-restriction/#why-this-matters","title":"Why This Matters","text":""},{"location":"articles/experience-cloud-account-access-restriction/#privacy-protection","title":"Privacy Protection","text":"<p>Member financial information and household details are sensitive data that should be protected. This fix ensures that:</p> <ul> <li>Donation amounts remain private</li> <li>Household structures are not exposed</li> <li>Member types and classifications are internal-only information</li> </ul>"},{"location":"articles/experience-cloud-account-access-restriction/#security-best-practices","title":"Security Best Practices","text":"<p>Following the principle of least privilege, members should only have access to the data they need to use the site effectively. Account-level information is administrative in nature and not necessary for the member experience.</p>"},{"location":"articles/experience-cloud-account-access-restriction/#compliance","title":"Compliance","text":"<p>Protecting member financial data aligns with data privacy best practices and helps maintain member trust in our systems.</p>"},{"location":"articles/experience-cloud-account-access-restriction/#benefits","title":"Benefits","text":"<ul> <li>Enhanced Privacy - Member financial data is no longer exposed through search</li> <li>Improved Security - Reduced access surface area for sensitive information</li> <li>No Impact on Functionality - Members retain all necessary access for normal site usage</li> <li>Future-Proof - This configuration will apply to any new Experience Cloud profiles created using these templates</li> </ul>"},{"location":"articles/experience-cloud-account-access-restriction/#verification","title":"Verification","text":"<p>To verify this fix is working correctly:</p> <ol> <li>Log in as a member user (using one of the affected profiles)</li> <li>Use the global search to search for a common member name</li> <li>Confirm that no Account records appear in the results</li> <li>Verify that Contact records and other relevant objects still appear as expected</li> </ol>"},{"location":"articles/experience-cloud-account-access-restriction/#questions-or-concerns","title":"Questions or Concerns?","text":"<p>If you notice any issues with member access or have questions about this security enhancement, please contact our tech team at webdev@spokanemountaineers.org.</p>"},{"location":"articles/fixing-approval-email-notifications/","title":"Fixing Missing Approval Email Notifications","text":"<p>Published: January 2026 | Category: Salesforce Solutions</p>"},{"location":"articles/fixing-approval-email-notifications/#the-problem-we-solved","title":"The Problem We Solved","text":"<p>Our activity group chairs recently stopped receiving email notifications when new events were submitted for approval. The Chalet Chair reported that she was no longer getting emails when members submitted new Chalet events that needed her approval.</p> <p>This was a critical issue because:</p> <ul> <li>Approvers had no way to know events were waiting for review</li> <li>Events could sit in limbo indefinitely</li> <li>Members creating events had no visibility into why their events weren't being approved</li> </ul>"},{"location":"articles/fixing-approval-email-notifications/#investigation-and-root-cause","title":"Investigation and Root Cause","text":"<p>Working with our Agentforce AI assistant, we conducted a thorough investigation:</p> <ol> <li>Verified user settings - The user's email preferences were correctly configured</li> <li>Checked group memberships - The user was properly added to the Chalet Committee and Chalet Approval Queue</li> <li>Reviewed approval processes - The Chalet_Approvals process was active and routing correctly</li> <li>Analyzed platform data - No <code>ProcessInstanceWorkitem</code> or <code>EmailMessage</code> records were being created for recent approvals</li> </ol>"},{"location":"articles/fixing-approval-email-notifications/#the-surprising-discovery","title":"The Surprising Discovery","text":"<p>The approval queues had never had email addresses configured, yet emails were being sent before. This meant the issue wasn't a configuration change on our end\u2014something had changed in Salesforce's default behavior.</p>"},{"location":"articles/fixing-approval-email-notifications/#root-cause","title":"Root Cause","text":"<p>Salesforce's platform behavior changed regarding automatic approval notifications. When an approval step assigns work to a queue:</p> <ul> <li>Previously: Salesforce would automatically send notification emails to queue members</li> <li>Now: Emails are only sent when explicit Email Alert actions are configured</li> </ul> <p>This is consistent with Salesforce's direction toward explicit automation configuration and the new Flow Approval Orchestration feature introduced in Spring '25.</p>"},{"location":"articles/fixing-approval-email-notifications/#our-solution","title":"Our Solution","text":"<p>We added explicit Email Alert actions to all 9 Event Registration approval processes. This guarantees that notification emails are sent regardless of platform behavior changes.</p>"},{"location":"articles/fixing-approval-email-notifications/#what-we-built","title":"What We Built","text":"<ol> <li> <p>9 Email Alerts - One for each activity group committee:</p> <ul> <li>Chalet, Climbing, Clubwide, Conservation, Hiking</li> <li>Mountain Biking, Paddling, Road Biking, Skiing</li> </ul> </li> <li> <p>Updated Email Template - Enhanced the approval request email with event details:</p> <ul> <li>Event name</li> <li>Start date/time and location</li> <li>Event leader name</li> <li>Direct link to approve/reject</li> </ul> </li> <li> <p>Updated Approval Processes - Added the email alert to the initial submission actions</p> </li> </ol>"},{"location":"articles/fixing-approval-email-notifications/#sample-email","title":"Sample Email","text":"<p>When a new event is submitted, approvers now receive:</p> <pre><code>Subject: A New Chalet Event Has Been Requested For Spokane Mountaineers\n\nHi,\n\nA member has requested your approval for the following event:\n\nWinter Cabin Weekend\n2026-02-15 at Chalet\nLed by: Event Leader Name\n\nPlease click this link to approve or reject this event:\nhttps://www.spokanemountaineers.org/p/process/ProcessInstanceWorkitemWizardStageManager?id=...\n\nThank you,\nSpokane Mountaineers\n</code></pre>"},{"location":"articles/fixing-approval-email-notifications/#benefits","title":"Benefits","text":"<ul> <li>Immediate fix - Approvers started receiving emails right away</li> <li>Explicit configuration - Not dependent on platform defaults</li> <li>Future-proof - Will continue working regardless of Salesforce updates</li> <li>Better email content - Approvers can see event details at a glance</li> </ul>"},{"location":"articles/fixing-approval-email-notifications/#lessons-learned","title":"Lessons Learned","text":"<ol> <li>Don't rely on default behaviors - Platform defaults can change without warning</li> <li>Explicit is better than implicit - Configure automations explicitly rather than relying on built-in behaviors</li> <li>AI-assisted debugging - Using Agentforce to query platform data helped identify the root cause quickly</li> <li>Document your automations - Having clear documentation helps troubleshoot issues faster</li> </ol>"},{"location":"articles/fixing-approval-email-notifications/#future-plans","title":"Future Plans","text":"<p>We're evaluating migrating to Salesforce's new Flow Approval Orchestration feature (introduced Spring '25, enhanced Winter '26) which provides:</p> <ul> <li>Modern, declarative approval management</li> <li>Better debugging and error handling</li> <li>Built-in recall functionality</li> <li>More flexibility for complex approval scenarios</li> </ul>"},{"location":"articles/fixing-approval-email-notifications/#technical-details","title":"Technical Details","text":"<p>For the complete technical implementation, see our Event Approval Email Alerts automation documentation.</p>"},{"location":"articles/fixing-approval-email-notifications/#questions","title":"Questions?","text":"<p>If you have questions about this solution or encounter any issues with approval notifications, contact the tech team at webdev@spokanemountaineers.org.</p>"},{"location":"articles/simplifying-custom-login-experience/","title":"Migrating to Email-Based Login: Supporting <code>.smi</code> Username Suffix Transparently","text":""},{"location":"articles/simplifying-custom-login-experience/#the-challenge","title":"The Challenge","text":"<p>When our Salesforce Experience Cloud site was created, we faced a significant constraint: Salesforce requires usernames to be globally unique across all Salesforce organizations worldwide. According to Salesforce documentation, this remains a current platform requirement.</p>"},{"location":"articles/simplifying-custom-login-experience/#our-original-solution","title":"Our Original Solution","text":"<p>To ensure our members had unique usernames in this global namespace, we made a pragmatic decision: append <code>.smi</code> to every member's email address. For example, a member with email <code>jane.smith@gmail.com</code> would receive the username <code>jane.smith@gmail.com.smi</code>.</p> <p>While this approach guaranteed global uniqueness, it created member confusion. Members didn't understand why they needed to add <code>.smi</code> to their email when logging in, leading to failed login attempts and support requests.</p>"},{"location":"articles/simplifying-custom-login-experience/#the-updated-solution","title":"The Updated Solution","text":"<p>Rather than trying to migrate away from <code>.smi</code> usernames (which isn't viable), we're taking a different approach: make the <code>.smi</code> suffix transparent to members.</p>"},{"location":"articles/simplifying-custom-login-experience/#the-new-user-experience","title":"The New User Experience","text":"<p>Members can now log in using either format:</p> <ul> <li>Just their email: <code>jane.smith@gmail.com</code></li> <li>Email with .smi suffix: <code>jane.smith@gmail.com.smi</code></li> </ul> <p>Behind the scenes, our custom authentication pages detect whether the user included <code>.smi</code> and automatically append it if needed before authenticating with Salesforce.</p>"},{"location":"articles/simplifying-custom-login-experience/#why-we-need-custom-pages","title":"Why We Need Custom Pages","text":"<p>Salesforce's default Experience Cloud login page doesn't allow custom scripting or input transformation. We couldn't intercept the username field to add the <code>.smi</code> suffix automatically. This limitation meant we needed to build our own authentication pages.</p>"},{"location":"articles/simplifying-custom-login-experience/#our-solution-custom-login-and-forgot-password-pages","title":"Our Solution: Custom Login and Forgot Password Pages","text":"<p>We implemented custom Visualforce pages for both login and password reset that automatically append the <code>.smi</code> suffix if members don't include it:</p>"},{"location":"articles/simplifying-custom-login-experience/#custom-login-page","title":"Custom Login Page","text":"<p>The <code>CommunitiesLogin</code> Visualforce page with <code>CommunitiesLoginController</code> intercepts the login form submission and normalizes the username:</p> <pre><code>// Add .smi suffix if not present for authentication\nif (!username.endsWithIgnoreCase('.smi')) {\n  username = username + '.smi';\n}\n</code></pre> <p>This means whether a member enters <code>jane.smith@gmail.com</code> or <code>jane.smith@gmail.com.smi</code>, they'll successfully authenticate with the correct Salesforce username.</p>"},{"location":"articles/simplifying-custom-login-experience/#custom-forgot-password-page","title":"Custom Forgot Password Page","text":"<p>Similarly, the <code>CommunitiesForgotPassword</code> page handles password reset requests with the same normalization logic. Members can request a password reset using either format, and the system will find their account.</p>"},{"location":"articles/simplifying-custom-login-experience/#benefits-of-this-approach","title":"Benefits of This Approach","text":"<ol> <li>Transparent to Members: Members can use their email address without thinking about <code>.smi</code></li> <li>No Database Migration: Usernames remain as-is in Salesforce (with <code>.smi</code> suffix)</li> <li>Backward Compatible: Members who still type <code>.smi</code> out of habit aren't affected</li> <li>No Training Required: Members naturally try their email address first</li> <li>Consistent Experience: Both login and password reset work the same way</li> </ol>"},{"location":"articles/simplifying-custom-login-experience/#implementation-details","title":"Implementation Details","text":"<p>The custom pages provide additional benefits beyond username normalization:</p> <ul> <li>Modern, responsive design matching our brand</li> <li>Loading states during authentication</li> <li>Password visibility toggle for better usability</li> <li>Google OAuth integration</li> <li>Alpine.js for smooth interactivity</li> <li>Custom labels for easy URL management</li> </ul> <p>Both pages include comprehensive test coverage (<code>CommunitiesLoginControllerTest</code> and <code>CommunitiesForgotPasswordControllerTest</code>) to ensure reliability.</p>"},{"location":"articles/simplifying-custom-login-experience/#technical-implementation","title":"Technical Implementation","text":"<p>The solution follows Salesforce best practices:</p> <ul> <li>Visualforce pages with <code>without sharing</code> controllers for unauthenticated access</li> <li>Username normalization using <code>endsWithIgnoreCase()</code> to detect suffix</li> <li>Automatic <code>.smi</code> appending when not present</li> <li>Proper error handling with user-friendly messages</li> <li>Test classes achieving 100% code coverage</li> <li>Responsive design using modern CSS and Alpine.js</li> </ul>"},{"location":"articles/simplifying-custom-login-experience/#what-this-solves","title":"What This Solves","text":""},{"location":"articles/simplifying-custom-login-experience/#before","title":"Before","text":"<ul> <li>Members confused about needing to add <code>.smi</code></li> <li>Support requests for \"forgot how to log in\"</li> <li>Members trying <code>email@domain.com</code> and failing</li> <li>Inconsistent user experience</li> </ul>"},{"location":"articles/simplifying-custom-login-experience/#after","title":"After","text":"<ul> <li>Members enter their email address naturally</li> <li>System handles <code>.smi</code> suffix automatically</li> <li>Both formats work seamlessly</li> <li>Improved user experience without database changes</li> </ul>"},{"location":"articles/simplifying-custom-login-experience/#lessons-learned","title":"Lessons Learned","text":"<p>This project highlights an important principle: always verify platform constraints before planning migrations.</p> <p>Our initial research suggested Salesforce had removed the global username uniqueness requirement. However, deeper investigation revealed this constraint still exists. Rather than abandoning the project, we pivoted to a solution that improves the user experience without requiring changes to the underlying data.</p> <p>Sometimes the best solution isn't to change the data model\u2014it's to make the existing model more user-friendly.</p>"},{"location":"articles/simplifying-custom-login-experience/#next-steps","title":"Next Steps","text":""},{"location":"articles/simplifying-custom-login-experience/#phase-1-complete","title":"Phase 1 (Complete)","text":"<ul> <li>Custom login and forgot password pages with <code>.smi</code> appending logic</li> <li>Guest user profile configuration for page access</li> <li>Custom labels for maintenance-free URL updates</li> <li>Full test coverage</li> </ul>"},{"location":"articles/simplifying-custom-login-experience/#phase-2-planned","title":"Phase 2 (Planned)","text":"<ul> <li>Deploy custom pages to production</li> <li>Monitor member login patterns</li> <li>Update new member creation process to ensure clarity that <code>.smi</code> is auto-appended</li> <li>Update member documentation to reflect that they can use just their email</li> </ul>"},{"location":"articles/simplifying-custom-login-experience/#phase-3-future","title":"Phase 3 (Future)","text":"<ul> <li>Consider whether to update member-facing documentation to explain the <code>.smi</code> convention</li> <li>Monitor for any edge cases or issues</li> <li>Potentially add helpful tooltips explaining the username format</li> </ul> <p>Related Documentation:</p> <ul> <li>Configure Custom Login Page Guide</li> <li>Custom Login Implementation Details</li> </ul>"},{"location":"automation/","title":"Automation","text":"<p>This section documents internal automations and scheduled jobs used to manage membership, system syncs, and administrative workflows for Spokane Mountaineers.</p> <p>Each automation is designed to reduce manual work, ensure consistency, and support the club\u2019s online infrastructure.</p>"},{"location":"automation/#included-jobs","title":"Included Jobs","text":"<ul> <li>Event Approval Email Alerts   Email alerts that notify activity group committee chairs when new events are submitted for approval. Covers all 9 activity groups with explicit email alert configuration.</li> <li>Google Login Automation   Technical implementation of Google OAuth authentication for Experience Cloud, including user matching strategy, account creation prevention, and error handling.</li> <li>Scheduled: Add Members To Conservation Group   Ensures all active site users are part of the Conservation Group and logs changes for audit.</li> <li>Notify Leader on RSVP   Automatically sends email notifications to event leaders when someone RSVPs \"Attending\" to their event.</li> <li>Automated License Sorting   Automatically optimizes Salesforce Community license usage by assigning Premium licenses to users with &gt;5 logins (up to 475 max), and Login licenses to others. Tracks full fiscal year login history via custom object and runs daily to maintain optimal license distribution.</li> </ul> <p>More scheduled flows and automation tools will be added to this section as they are developed.</p>"},{"location":"automation/event-approval-email-alerts/","title":"Event Approval Email Alerts","text":"<p>This documentation covers the email alert automation for Event Registration approval processes, ensuring committee chairs receive notifications when new events are submitted for approval.</p>"},{"location":"automation/event-approval-email-alerts/#access","title":"Access","text":"<ul> <li>Workflow Alerts: Setup \u2192 Workflow Rules \u2192 Email Alerts</li> <li>Approval Processes: Setup \u2192 Approval Processes</li> <li>GitHub: Event_Registration__c.workflow-meta.xml</li> </ul>"},{"location":"automation/event-approval-email-alerts/#purpose","title":"Purpose","text":"<p>These email alerts notify activity group committee members when a new event is submitted for approval. Each activity group has its own:</p> <ul> <li>Approval Queue - Holds pending approval requests</li> <li>Committee Group - Public group containing committee members who should receive notifications</li> <li>Email Alert - Sends the notification email to the committee group</li> </ul>"},{"location":"automation/event-approval-email-alerts/#components","title":"Components","text":""},{"location":"automation/event-approval-email-alerts/#email-alerts-workflow-alerts","title":"Email Alerts (Workflow Alerts)","text":"Alert Name Recipient Group Description <code>Email_Chalet_Committee</code> <code>Chalet_Committee</code> Chalet Committee Event Approval <code>Email_Climbing_Committee</code> <code>Climbing_Committee</code> Climbing Committee Event Approval <code>Email_Clubwide_Committee</code> <code>Clubwide_Approvers</code> Clubwide Committee Event Approval <code>Email_Conservation_Committee</code> <code>Conservation_Committee</code> Conservation Committee Event Approval <code>Email_Hiking_Committee</code> <code>Hiking_Committee</code> Hiking Committee Event Approval <code>Email_Mountain_Biking_Committee</code> <code>Mountain_Biking_Committee</code> Mountain Biking Committee Event Approval <code>Email_Paddling_Committee</code> <code>Paddling_Committee</code> Paddling Committee Event Approval <code>Email_Road_Biking_Committee</code> <code>Road_Biking_Committee</code> Road Biking Committee Event Approval <code>Email_Skiing_Committee</code> <code>Skiing_Committee</code> Skiing Committee Event Approval"},{"location":"automation/event-approval-email-alerts/#email-configuration","title":"Email Configuration","text":"<p>All alerts share the same configuration:</p> <ul> <li>Sender: <code>admin@spokanemountaineers.org</code> (Org-Wide Email Address)</li> <li>Template: <code>unfiled$public/Event_Approval_Request_Alert</code></li> </ul>"},{"location":"automation/event-approval-email-alerts/#email-template","title":"Email Template","text":"<p>Developer Name: <code>Event_Approval_Request_Alert</code></p> <p>Subject:</p> <pre><code>A New {!Event_Registration__c.Activity_Group__c} Event Has Been Requested For Spokane Mountaineers\n</code></pre> <p>Body:</p> <pre><code>Hi,\n\n{!Event_Registration__c.CreatedBy} has requested your approval for the following event:\n\n{!Event_Registration__c.Name}\n{!Event_Registration__c.Start__c} at {!Event_Registration__c.Location__c}\nLed by: {!Event_Registration__c.Leader__c}\n\nPlease click this link to approve or reject this event:\n{!Event_Registration__c.Link}\n\nThank you,\nSpokane Mountaineers\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#approval-process-configuration","title":"Approval Process Configuration","text":"<p>Each approval process includes two key elements:</p>"},{"location":"automation/event-approval-email-alerts/#1-email-template-reference","title":"1. Email Template Reference","text":"<p>Added after the <code>&lt;approvalStep&gt;</code> section:</p> <pre><code>&lt;emailTemplate&gt;unfiled$public/Event_Approval_Request_Alert&lt;/emailTemplate&gt;\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#2-email-alert-in-initial-submission-actions","title":"2. Email Alert in Initial Submission Actions","text":"<p>Added to <code>&lt;initialSubmissionActions&gt;</code>:</p> <pre><code>&lt;initialSubmissionActions&gt;\n    &lt;action&gt;\n        &lt;name&gt;Email_{ActivityGroup}_Committee&lt;/name&gt;\n        &lt;type&gt;Alert&lt;/type&gt;\n    &lt;/action&gt;\n    &lt;action&gt;\n        &lt;name&gt;Submitted_Status&lt;/name&gt;\n        &lt;type&gt;FieldUpdate&lt;/type&gt;\n    &lt;/action&gt;\n&lt;/initialSubmissionActions&gt;\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#approval-process-list","title":"Approval Process List","text":"Approval Process Queue Entry Criteria <code>Chalet_Approvals</code> <code>Chalet_Approval_Queue</code> Activity_Group = \"Chalet\" <code>Climbing_Approvals</code> <code>Climbing_Approval_Queue</code> Activity_Group = \"Climbing\" <code>Clubwide_Approvals</code> <code>Clubwide_Approval_Queue</code> Activity_Group = \"Clubwide\" <code>Conservation_Approvals</code> <code>Conservation_Approval_Queue</code> Activity_Group = \"Conservation\" <code>Hiking_Approvals</code> <code>Hiking_Approval_Queue</code> Activity_Group = \"Hiking\" <code>Mountain_Biking_Approvals</code> <code>Mountain_Biking_Approval_Queue</code> Activity_Group = \"Mountain Biking\" <code>Paddling_Approvals</code> <code>Paddling_Approval_Queue</code> Activity_Group = \"Paddling\" <code>Road_Biking_Approvals</code> <code>Road_Biking_Approval_Queue</code> Activity_Group = \"Road Biking\" <code>Skiing_Approvals</code> <code>Skiing_Approval_Queue</code> Activity_Group = \"Skiing\""},{"location":"automation/event-approval-email-alerts/#data-model","title":"Data Model","text":""},{"location":"automation/event-approval-email-alerts/#objects-used","title":"Objects Used","text":"Object Purpose Key Fields <code>Event_Registration__c</code> Event record submitted for approval <code>Name</code>, <code>Activity_Group__c</code>, <code>Status__c</code>, <code>Leader__c</code>, <code>Start__c</code>, <code>Location__c</code> <code>Group</code> Public groups for committee members <code>DeveloperName</code>, <code>Name</code>, <code>Type</code> <code>User</code> Committee member user records <code>Id</code>, <code>Email</code>, <code>Name</code>"},{"location":"automation/event-approval-email-alerts/#relationships","title":"Relationships","text":"<ul> <li><code>Event_Registration__c.Leader__c</code> \u2192 <code>User</code> (Lookup)</li> <li><code>Event_Registration__c.Activity_Group__c</code> \u2192 Determines which approval process runs</li> <li>Committee Groups contain Users who receive email alerts</li> </ul>"},{"location":"automation/event-approval-email-alerts/#flow-how-approval-works","title":"Flow: How Approval Works","text":"<pre><code>flowchart TD\n    A[Event Created with Status = Requested] --&gt; B{Activity Group?}\n    B --&gt;|Chalet| C[Chalet_Approvals]\n    B --&gt;|Climbing| D[Climbing_Approvals]\n    B --&gt;|Other...| E[Corresponding Approval Process]\n\n    C --&gt; F[Initial Submission Actions]\n    D --&gt; F\n    E --&gt; F\n\n    F --&gt; G[Email Alert Sent to Committee]\n    F --&gt; H[Status Updated to Submitted]\n\n    G --&gt; I[Committee Members Receive Email]\n    I --&gt; J[Click Link to Approve/Reject]\n\n    J --&gt;|Approve| K[Status = Approved, RecordType Updated]\n    J --&gt;|Reject| L[Status = Rejected]</code></pre>"},{"location":"automation/event-approval-email-alerts/#monitoring-troubleshooting","title":"Monitoring &amp; Troubleshooting","text":""},{"location":"automation/event-approval-email-alerts/#verify-email-delivery","title":"Verify Email Delivery","text":"<p>Query to check if emails are being sent:</p> <pre><code>SELECT Id, ToAddress, Subject, CreatedDate, Status\nFROM EmailMessage\nWHERE CreatedDate = TODAY\nAND Subject LIKE '%Event%Requested%'\nORDER BY CreatedDate DESC\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#check-approval-process-execution","title":"Check Approval Process Execution","text":"<p>Query to verify approval process is running:</p> <pre><code>SELECT Id, TargetObjectId, Status, CreatedDate,\n       (SELECT Id, ActorId, OriginalActorId, StepStatus FROM StepsAndWorkitems)\nFROM ProcessInstance\nWHERE TargetObject.Type = 'Event_Registration__c'\nAND CreatedDate = TODAY\nORDER BY CreatedDate DESC\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#common-issues","title":"Common Issues","text":"Issue Possible Cause Solution No email received User not in committee group Add user to the appropriate <code>{Activity}_Committee</code> group No email received Wrong Activity Group on event Verify <code>Activity_Group__c</code> matches expected value Email to wrong people Wrong group configured Verify email alert recipients match committee group Approval not triggering Status not \"Requested\" Verify <code>Status__c = 'Requested'</code> when event created Email not sending Invalid sender address Verify Org-Wide Email <code>admin@spokanemountaineers.org</code> is active"},{"location":"automation/event-approval-email-alerts/#verify-group-membership","title":"Verify Group Membership","text":"<p>Query to check who is in a committee group:</p> <pre><code>SELECT GroupId, Group.Name, UserOrGroupId, UserOrGroup.Name\nFROM GroupMember\nWHERE Group.DeveloperName = 'Chalet_Committee'\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#adding-a-new-activity-group","title":"Adding a New Activity Group","text":"<p>To add email alerts for a new activity group:</p>"},{"location":"automation/event-approval-email-alerts/#1-create-the-public-group","title":"1. Create the Public Group","text":"<ol> <li>Setup \u2192 Users \u2192 Public Groups</li> <li>Create group: <code>{ActivityGroup}_Committee</code></li> <li>Add committee members</li> </ol>"},{"location":"automation/event-approval-email-alerts/#2-create-the-email-alert","title":"2. Create the Email Alert","text":"<p>Add to <code>Event_Registration__c.workflow-meta.xml</code>:</p> <pre><code>&lt;alerts&gt;\n    &lt;fullName&gt;Email_{ActivityGroup}_Committee&lt;/fullName&gt;\n    &lt;description&gt;{ActivityGroup} Committee Event Approval&lt;/description&gt;\n    &lt;protected&gt;false&lt;/protected&gt;\n    &lt;recipients&gt;\n        &lt;recipient&gt;{ActivityGroup}_Committee&lt;/recipient&gt;\n        &lt;type&gt;group&lt;/type&gt;\n    &lt;/recipients&gt;\n    &lt;senderAddress&gt;admin@spokanemountaineers.org&lt;/senderAddress&gt;\n    &lt;senderType&gt;OrgWideEmailAddress&lt;/senderType&gt;\n    &lt;template&gt;unfiled$public/Event_Approval_Request_Alert&lt;/template&gt;\n&lt;/alerts&gt;\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#3-update-the-approval-process","title":"3. Update the Approval Process","text":"<p>Add to the approval process XML:</p> <ol> <li>Email template reference after <code>&lt;/approvalStep&gt;</code>:</li> </ol> <pre><code>&lt;emailTemplate&gt;unfiled$public/Event_Approval_Request_Alert&lt;/emailTemplate&gt;\n</code></pre> <ol> <li>Email alert in <code>&lt;initialSubmissionActions&gt;</code>:</li> </ol> <pre><code>&lt;action&gt;\n    &lt;name&gt;Email_{ActivityGroup}_Committee&lt;/name&gt;\n    &lt;type&gt;Alert&lt;/type&gt;\n&lt;/action&gt;\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#4-deploy","title":"4. Deploy","text":"<pre><code>sf project deploy start --source-dir force-app/main/default/workflows/Event_Registration__c.workflow-meta.xml \\\n  --source-dir force-app/main/default/approvalProcesses \\\n  --target-org production\n</code></pre>"},{"location":"automation/event-approval-email-alerts/#technical-details","title":"Technical Details","text":"<ul> <li>API Version: 64.0</li> <li>Metadata Types: <code>Workflow</code>, <code>WorkflowAlert</code>, <code>ApprovalProcess</code></li> <li>Email Template Type: Classic Email Template (Text)</li> <li>Template Folder: <code>unfiled$public</code></li> </ul>"},{"location":"automation/event-approval-email-alerts/#related-documentation","title":"Related Documentation","text":"<ul> <li>Fixing Approval Email Notifications (Article): Overview of the problem and solution</li> <li>Notify Leader on RSVP: Related email notification automation</li> </ul>"},{"location":"automation/event-approval-email-alerts/#future-enhancements","title":"Future Enhancements","text":"Feature Notes Flow Approval Orchestration Migrate to modern approval system (Spring '25+) for better debugging HTML Email Template Format approval emails with HTML for better presentation Approval Reminder Send reminder if approval pending &gt; 3 days Mobile Deep Links Add mobile-friendly approval links"},{"location":"automation/event-approval-email-alerts/#support","title":"Support","text":"<p>For issues or questions about approval email alerts, contact the tech team at webdev@spokanemountaineers.org.</p>"},{"location":"automation/event-chatter-batch-deployment/","title":"Event Chatter Batch Posting - Deployment Steps","text":""},{"location":"automation/event-chatter-batch-deployment/#prerequisites","title":"Prerequisites","text":"<ul> <li>Admin access to Salesforce org</li> <li>Access to Object Manager and Apex Classes</li> <li>Ability to create custom fields</li> </ul>"},{"location":"automation/event-chatter-batch-deployment/#deployment-checklist","title":"Deployment Checklist","text":""},{"location":"automation/event-chatter-batch-deployment/#1-create-required-field","title":"1. Create Required Field","text":"<p>Field: <code>Chatter_Posted__c</code> on <code>Event_Registration__c</code> object</p> <p>Steps:</p> <ol> <li>Go to Setup \u2192 Object Manager \u2192 Event Registration</li> <li>Click Fields &amp; Relationships</li> <li>Click New</li> <li>Select Checkbox as the field type</li> <li>Configure:<ul> <li>Field Label: <code>Chatter Posted</code></li> <li>Field Name: <code>Chatter_Posted__c</code> (auto-populated)</li> <li>Default Value: Unchecked</li> <li>Description: \"Indicates if this event has been posted to Chatter. Set to true after batch job posts the event.\"</li> </ul> </li> <li>Click Next \u2192 Next \u2192 Save</li> <li>(Optional) Add field to page layouts if you want visibility</li> </ol> <p>Time: ~5 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#2-deploy-apex-classes","title":"2. Deploy Apex Classes","text":"<p>Files to Deploy:</p> <ul> <li><code>force-app/main/default/classes/EventChatterBatchPoster.cls</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPoster.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPosterTest.cls</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPosterTest.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelper.cls</code> (updated with batch methods)</li> <li><code>force-app/main/default/classes/EventChatterPostHelper.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelperTest.cls</code> (updated with batch tests)</li> <li><code>force-app/main/default/classes/EventChatterPostHelperTest.cls-meta.xml</code></li> </ul> <p>Steps:</p> <ol> <li>Deploy via Salesforce CLI:     <pre><code>sf project deploy start --source-dir force-app/main/default/classes\n</code></pre></li> <li>Or deploy via VS Code Salesforce Extension</li> <li>Or deploy via Change Sets in Setup \u2192 Deployment \u2192 Outbound Change Sets</li> </ol> <p>Verify:</p> <ul> <li>All classes compile successfully</li> <li>Test classes pass (75%+ coverage required)</li> </ul> <p>Time: ~5-10 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#3-mark-all-existing-events-as-posted-pre-rollout","title":"3. Mark All Existing Events as Posted (Pre-Rollout)","text":"<p>Purpose: Prevent the batch job from posting about events that were approved before this feature was implemented.</p> <p>IMPORTANT: This must be run BEFORE scheduling the batch job for the first time.</p> <p>Steps:</p> <ol> <li>Open Developer Console (Setup \u2192 Developer Console)</li> <li>Go to Debug \u2192 Open Execute Anonymous Window</li> <li>Copy and paste the contents of <code>scripts/apex/mark_all_events_as_posted.apex</code></li> <li>Check Open Log and click Execute</li> <li>Review the debug logs to confirm all events were updated</li> <li>Verify the update:     <pre><code>sf data query --query \"SELECT COUNT() FROM Event_Registration__c WHERE Chatter_Posted__c = true\" --target-org smi\n</code></pre>     This should return the total count of all Event_Registration__c records</li> </ol> <p>What This Does:</p> <ul> <li>Sets <code>Chatter_Posted__c = true</code> on ALL existing Event_Registration__c records</li> <li>Ensures the batch job only processes NEW events approved after rollout</li> <li>Prevents duplicate or unwanted posts about historical events</li> </ul> <p>Time: ~2-3 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#4-schedule-the-batch-job","title":"4. Schedule the Batch Job","text":"<p>Option A: Using Apex Script (Recommended)</p> <ol> <li>Open Developer Console or VS Code Execute Anonymous</li> <li>Run the script: <code>scripts/apex/schedule_event_chatter_batch.apex</code></li> <li>Verify job was scheduled:<ul> <li>Go to Setup \u2192 Scheduled Jobs</li> <li>Look for \"Event Chatter Batch Posting - Daily 5am\"</li> <li>Verify next fire time is 5:00 AM Pacific</li> </ul> </li> </ol> <p>Option B: Manual Scheduling</p> <ol> <li>Go to Setup \u2192 Apex Classes</li> <li>Find <code>EventChatterBatchPoster</code></li> <li>Click Schedule Apex</li> <li>Configure:<ul> <li>Job Name: <code>Event Chatter Batch Posting - Daily 5am</code></li> <li>Frequency: Daily</li> <li>Start Time: 5:00 AM</li> <li>Time Zone: Pacific Time</li> </ul> </li> <li>Click Save</li> </ol> <p>Verify:</p> <ul> <li>Job appears in Setup \u2192 Scheduled Jobs</li> <li>Next fire time is correct (5:00 AM Pacific)</li> </ul> <p>Time: ~2 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#5-configure-service-account","title":"5. Configure Service Account","text":"<p>Note: This org uses <code>sm-client@prolocity.com</code> as the service account for Chatter posting. Ensure this user:</p> <ul> <li>Has permissions to read/edit <code>Event_Registration__c</code> records</li> <li>Is a member of all activity group Chatter groups</li> <li>Is added to any new Chatter groups automatically via the <code>Add_Chatter_Service_To_New_Groups</code> flow</li> </ul> <p>Verify Service Account Setup:</p> <ol> <li> <p>Verify service account exists and is active:</p> <pre><code>sf data query --target-org smi \\\n    --query \"SELECT Id, Username, IsActive FROM User WHERE Username = 'sm-client@prolocity.com'\"\n</code></pre> </li> <li> <p>Add service account to all existing Chatter groups:</p> <ul> <li>Open Developer Console (Setup \u2192 Developer Console)</li> <li>Go to Debug \u2192 Open Execute Anonymous Window</li> <li>Copy and paste the contents of <code>scripts/apex/add_sm_client_to_all_chatter_groups.apex</code></li> <li>Check Open Log and click Execute</li> <li>Review the debug logs to confirm the service account was added to all groups</li> </ul> </li> <li> <p>Deploy Flow for automatic addition to new groups:     <pre><code>sf project deploy start --target-org smi --source-dir force-app/main/default/flows/Add_Chatter_Service_To_New_Groups.flow-meta.xml\n</code></pre></p> <ul> <li>Verify the Flow is Active in Setup \u2192 Flows</li> <li>The Flow will automatically add the service account to any new Chatter groups created in the future</li> </ul> </li> </ol> <p>Time: ~5-10 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#6-verify-deployment","title":"6. Verify Deployment","text":"<p>Test the Batch Job:</p> <ol> <li> <p>Create a test event:</p> <ul> <li>Create <code>Event_Registration__c</code> record</li> <li>Set <code>Status__c = 'Approved'</code></li> <li>Set <code>Activity_Group__c = 'Hiking'</code> (or any valid activity group)</li> <li>Verify <code>Chatter_Posted__c</code> is unchecked</li> </ul> </li> <li> <p>Run batch job manually:</p> <pre><code>Database.executeBatch(new EventChatterBatchPoster(), 200);\n</code></pre> </li> <li> <p>Verify results:</p> <ul> <li>Check Setup \u2192 Apex Jobs for job status</li> <li>Check Chatter group for new post</li> <li>Verify <code>Chatter_Posted__c = true</code> on the event</li> </ul> </li> <li> <p>Test duplicate prevention:</p> <ul> <li>Modify the event (change Location, etc.)</li> <li>Run batch job again</li> <li>Verify event is NOT reprocessed (no duplicate post)</li> </ul> </li> </ol> <p>Time: ~5 minutes</p>"},{"location":"automation/event-chatter-batch-deployment/#post-deployment","title":"Post-Deployment","text":""},{"location":"automation/event-chatter-batch-deployment/#monitor-initial-runs","title":"Monitor Initial Runs","text":"<ul> <li>Check Setup \u2192 Scheduled Jobs after first few runs</li> <li>Review Setup \u2192 Apex Jobs for any errors</li> <li>Verify posts appear in Chatter groups</li> <li>Check debug logs if issues occur</li> </ul>"},{"location":"automation/event-chatter-batch-deployment/#deactivate-old-flow-if-still-active","title":"Deactivate Old Flow (If Still Active)","text":"<p>If the old <code>Notify_Subscribers_New_Event</code> flow is still active:</p> <ol> <li>Go to Setup \u2192 Flows</li> <li>Find <code>Notify Subscribers New Event</code></li> <li>Click Deactivate (or it should already be marked Obsolete)</li> </ol>"},{"location":"automation/event-chatter-batch-deployment/#rollback-plan","title":"Rollback Plan","text":"<p>If issues occur:</p> <ol> <li> <p>Stop the scheduled job:</p> <ul> <li>Go to Setup \u2192 Scheduled Jobs</li> <li>Find \"Event Chatter Batch Posting - Daily 5am\"</li> <li>Click Abort</li> </ul> </li> <li> <p>Revert code (if needed):</p> <ul> <li>Deploy previous version of classes</li> <li>Or comment out batch job scheduling</li> </ul> </li> <li> <p>Re-enable old flow (if needed):</p> <ul> <li>Reactivate <code>Notify_Subscribers_New_Event</code> flow</li> </ul> </li> </ol>"},{"location":"automation/event-chatter-batch-deployment/#total-deployment-time","title":"Total Deployment Time","text":"<ul> <li>Minimum: ~15-20 minutes (field + code + schedule)</li> <li>With Service Account: ~25-35 minutes</li> <li>With Testing: ~30-40 minutes</li> </ul>"},{"location":"automation/event-chatter-batch-deployment/#quick-reference","title":"Quick Reference","text":"<p>Required Field: <code>Chatter_Posted__c</code> (Checkbox) on <code>Event_Registration__c</code></p> <p>Apex Classes:</p> <ul> <li><code>EventChatterBatchPoster</code> (batch class)</li> <li><code>EventChatterPostHelper</code> (helper with batch methods)</li> </ul> <p>Schedule: Daily at 5:00 AM Pacific (<code>0 0 5 * * ?</code>)</p> <p>Query Logic: <code>Status__c = 'Approved' AND Activity_Group__c != null AND Chatter_Posted__c != true</code></p>"},{"location":"automation/event-chatter-batch-production-deployment/","title":"Event Chatter Batch Posting - Production Deployment Plan","text":""},{"location":"automation/event-chatter-batch-production-deployment/#overview","title":"Overview","text":"<p>This document provides a step-by-step plan for deploying the Event Chatter Batch Posting feature to the production Salesforce org (<code>smi</code>).</p> <p>Feature Summary: Automated batch job that posts approved events to their respective activity group Chatter groups every 60 minutes (hourly).</p>"},{"location":"automation/event-chatter-batch-production-deployment/#pre-deployment-checklist","title":"Pre-Deployment Checklist","text":""},{"location":"automation/event-chatter-batch-production-deployment/#1-verify-prerequisites","title":"1. Verify Prerequisites","text":"<ul> <li> Admin access to production org (<code>smi</code>)</li> <li> Salesforce CLI configured with production org authentication</li> <li> All code changes committed to git</li> <li> All tests passing in staging</li> <li> Feature tested and verified in staging sandbox</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#2-review-changes-to-deploy","title":"2. Review Changes to Deploy","text":"<p>New Apex Classes:</p> <ul> <li><code>EventChatterBatchPoster.cls</code> - Batch class for processing events</li> <li><code>EventChatterBatchPosterTest.cls</code> - Test class (75%+ coverage)</li> <li><code>EventChatterBatchScheduler.cls</code> - Utility for scheduling (optional)</li> </ul> <p>Modified Apex Classes:</p> <ul> <li><code>EventChatterPostHelper.cls</code> - Updated with batch posting methods</li> <li><code>EventChatterPostHelperTest.cls</code> - Updated test class</li> </ul> <p>New Flow:</p> <ul> <li><code>Add_Chatter_Service_To_New_Groups.flow-meta.xml</code> - Auto-adds service account to new Chatter groups</li> </ul> <p>New Custom Field:</p> <ul> <li><code>Event_Registration__c.Chatter_Posted__c</code> - Checkbox to track posted events</li> </ul> <p>Scripts (for post-deployment setup):</p> <ul> <li><code>scripts/apex/mark_all_events_as_posted.apex</code> - Mark existing events as posted</li> <li><code>scripts/apex/schedule_event_chatter_batch.apex</code> - Schedule the batch job</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#3-verify-production-org-state","title":"3. Verify Production Org State","text":"<p>Before deploying, verify:</p> <ul> <li> No existing scheduled jobs with name \"Event Chatter Batch Posting - Hourly\"</li> <li> <code>Event_Registration__c</code> object exists</li> <li> Activity group Chatter groups exist (Hiking, Climbing, etc.)</li> <li> Service account <code>sm-client@prolocity.com</code> exists and is active</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#deployment-steps","title":"Deployment Steps","text":""},{"location":"automation/event-chatter-batch-production-deployment/#step-1-deploy-custom-field","title":"Step 1: Deploy Custom Field","text":"<p>File: <code>force-app/main/default/objects/Event_Registration__c/fields/Chatter_Posted__c.field-meta.xml</code></p> <pre><code>sf project deploy start \\\n    --target-org smi \\\n    --source-dir force-app/main/default/objects/Event_Registration__c/fields/Chatter_Posted__c.field-meta.xml\n</code></pre> <p>Verify:</p> <ul> <li>Field appears in Object Manager \u2192 Event Registration \u2192 Fields &amp; Relationships</li> <li>Field label: \"Chatter Posted\"</li> <li>Field type: Checkbox</li> <li>Default value: Unchecked</li> </ul> <p>Time: ~2 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#step-2-deploy-apex-classes","title":"Step 2: Deploy Apex Classes","text":"<p>Files:</p> <ul> <li><code>force-app/main/default/classes/EventChatterBatchPoster.cls</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPoster.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPosterTest.cls</code></li> <li><code>force-app/main/default/classes/EventChatterBatchPosterTest.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelper.cls</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelper.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelperTest.cls</code></li> <li><code>force-app/main/default/classes/EventChatterPostHelperTest.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/EventChatterBatchScheduler.cls</code> (optional)</li> <li><code>force-app/main/default/classes/EventChatterBatchScheduler.cls-meta.xml</code> (optional)</li> </ul> <p>Deploy with Tests:</p> <pre><code>sf project deploy start \\\n    --target-org smi \\\n    --source-dir force-app/main/default/classes \\\n    --test-level RunSpecifiedTests \\\n    --tests EventChatterBatchPosterTest \\\n    --tests EventChatterPostHelperTest\n</code></pre> <p>Alternative: Deploy All Classes at Once:</p> <pre><code>sf project deploy start \\\n    --target-org smi \\\n    --source-dir force-app/main/default/classes/EventChatterBatchPoster.cls \\\n    --source-dir force-app/main/default/classes/EventChatterBatchPoster.cls-meta.xml \\\n    --source-dir force-app/main/default/classes/EventChatterBatchPosterTest.cls \\\n    --source-dir force-app/main/default/classes/EventChatterBatchPosterTest.cls-meta.xml \\\n    --source-dir force-app/main/default/classes/EventChatterPostHelper.cls \\\n    --source-dir force-app/main/default/classes/EventChatterPostHelper.cls-meta.xml \\\n    --source-dir force-app/main/default/classes/EventChatterPostHelperTest.cls \\\n    --source-dir force-app/main/default/classes/EventChatterPostHelperTest.cls-meta.xml \\\n    --test-level RunSpecifiedTests \\\n    --tests EventChatterBatchPosterTest \\\n    --tests EventChatterPostHelperTest\n</code></pre> <p>Verify:</p> <ul> <li>All classes compile successfully</li> <li>All tests pass (75%+ coverage)</li> <li>No deployment errors</li> </ul> <p>Time: ~5-10 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#step-3-deploy-flow","title":"Step 3: Deploy Flow","text":"<p>File: <code>force-app/main/default/flows/Add_Chatter_Service_To_New_Groups.flow-meta.xml</code></p> <pre><code>sf project deploy start \\\n    --target-org smi \\\n    --source-dir force-app/main/default/flows/Add_Chatter_Service_To_New_Groups.flow-meta.xml \\\n    --target-org smi\n</code></pre> <p>Verify:</p> <ul> <li>Flow appears in Setup \u2192 Flows</li> <li>Flow is Active</li> <li>Flow triggers on <code>CollaborationGroup</code> creation</li> </ul> <p>Time: ~2 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#step-4-mark-all-existing-events-as-posted-critical","title":"Step 4: Mark All Existing Events as Posted (CRITICAL)","text":"<p>Purpose: Prevent the batch job from posting about events that were approved before this feature was implemented.</p> <p>IMPORTANT: This MUST be run BEFORE scheduling the batch job for the first time.</p> <p>Script: <code>scripts/apex/mark_all_events_as_posted.apex</code></p> <p>Option A: Using Salesforce CLI:</p> <pre><code>sf apex run --target-org smi -f scripts/apex/mark_all_events_as_posted.apex\n</code></pre> <p>Option B: Using Developer Console:</p> <ol> <li>Go to Setup \u2192 Developer Console</li> <li>Debug \u2192 Open Execute Anonymous Window</li> <li>Copy and paste contents of <code>scripts/apex/mark_all_events_as_posted.apex</code></li> <li>Check Open Log and click Execute</li> <li>Review debug logs to confirm all events were updated</li> </ol> <p>Verify:</p> <pre><code>sf data query --target-org smi \\\n    --query \"SELECT COUNT() FROM Event_Registration__c WHERE Chatter_Posted__c = true\"\n</code></pre> <p>This should return the total count of all <code>Event_Registration__c</code> records.</p> <p>What This Does:</p> <ul> <li>Sets <code>Chatter_Posted__c = true</code> on ALL existing <code>Event_Registration__c</code> records</li> <li>Ensures the batch job only processes NEW events approved after rollout</li> <li>Prevents duplicate or unwanted posts about historical events</li> </ul> <p>Time: ~2-3 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#step-5-schedule-the-batch-job","title":"Step 5: Schedule the Batch Job","text":"<p>Script: <code>scripts/apex/schedule_event_chatter_batch.apex</code></p> <p>Option A: Using Salesforce CLI:</p> <pre><code>sf apex run --target-org smi -f scripts/apex/schedule_event_chatter_batch.apex\n</code></pre> <p>Option B: Using Developer Console:</p> <ol> <li>Go to Setup \u2192 Developer Console</li> <li>Debug \u2192 Open Execute Anonymous Window</li> <li>Copy and paste contents of <code>scripts/apex/schedule_event_chatter_batch.apex</code></li> <li>Check Open Log and click Execute</li> <li>Review debug logs for job ID and next fire time</li> </ol> <p>Option C: Manual Scheduling:</p> <ol> <li>Go to Setup \u2192 Apex Classes</li> <li>Find <code>EventChatterBatchPoster</code></li> <li>Click Schedule Apex</li> <li>Configure:<ul> <li>Job Name: <code>Event Chatter Batch Posting - Hourly</code></li> <li>Frequency: Hourly (or use cron expression <code>0 0 * * * ?</code>)</li> <li>Start Time: Top of the hour (e.g., 12:00 AM)</li> <li>Time Zone: Pacific Time</li> </ul> </li> <li>Click Save</li> </ol> <p>Verify:</p> <ul> <li>Job appears in Setup \u2192 Scheduled Jobs</li> <li>Job name: \"Event Chatter Batch Posting - Hourly\"</li> <li>Next fire time: Top of the next hour</li> <li>Status: Waiting</li> </ul> <p>Cron Expression: <code>0 0 * * * ?</code> (Every hour at minute 0, second 0)</p> <p>Time: ~2 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#post-deployment-verification","title":"Post-Deployment Verification","text":""},{"location":"automation/event-chatter-batch-production-deployment/#1-verify-deployment","title":"1. Verify Deployment","text":"<ul> <li> All classes deployed successfully</li> <li> All tests passed</li> <li> Flow is active</li> <li> Custom field exists</li> <li> Scheduled job is active</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#2-test-the-batch-job","title":"2. Test the Batch Job","text":"<p>Create a Test Event:</p> <ol> <li> <p>Create a new <code>Event_Registration__c</code> record:</p> <ul> <li>Set <code>Status__c = 'Approved'</code></li> <li>Set <code>Activity_Group__c = 'Hiking'</code> (or any valid activity group)</li> <li>Verify <code>Chatter_Posted__c</code> is unchecked (default)</li> </ul> </li> <li> <p>Run Batch Job Manually:</p> </li> </ol> <pre><code>sf apex run --target-org smi -f /dev/stdin &lt;&lt; 'EOF'\nDatabase.executeBatch(new EventChatterBatchPoster(), 200);\nEOF\n</code></pre> <p>Or in Developer Console:</p> <pre><code>Database.executeBatch(new EventChatterBatchPoster(), 200);\n</code></pre> <ol> <li> <p>Verify Results:</p> <ul> <li>Check Setup \u2192 Apex Jobs for job status (should complete successfully)</li> <li>Check the Hiking Chatter group for new post</li> <li>Verify <code>Chatter_Posted__c = true</code> on the test event</li> <li>Verify post format matches expected format (single event format)</li> </ul> </li> <li> <p>Test Duplicate Prevention:</p> <ul> <li>Modify the test event (change Location, etc.)</li> <li>Run batch job again</li> <li>Verify event is NOT reprocessed (no duplicate post)</li> <li>Verify <code>Chatter_Posted__c</code> remains <code>true</code></li> </ul> </li> </ol> <p>Time: ~5-10 minutes</p>"},{"location":"automation/event-chatter-batch-production-deployment/#3-monitor-first-scheduled-run","title":"3. Monitor First Scheduled Run","text":"<ul> <li> Check Setup \u2192 Scheduled Jobs after first run (within the next hour)</li> <li> Review Setup \u2192 Apex Jobs for any errors</li> <li> Verify posts appear in Chatter groups</li> <li> Check debug logs if issues occur</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#rollback-plan","title":"Rollback Plan","text":"<p>If issues occur after deployment:</p>"},{"location":"automation/event-chatter-batch-production-deployment/#immediate-actions","title":"Immediate Actions","text":"<ol> <li> <p>Stop the Scheduled Job:</p> <pre><code>sf apex run --target-org smi -f /dev/stdin &lt;&lt; 'EOF'\nList&lt;CronTrigger&gt; jobs = [\n    SELECT Id FROM CronTrigger\n    WHERE CronJobDetail.Name = 'Event Chatter Batch Posting - Hourly'\n];\nfor (CronTrigger ct : jobs) {\n    System.abortJob(ct.Id);\n}\nEOF\n</code></pre> <p>Or manually: - Go to Setup \u2192 Scheduled Jobs - Find \"Event Chatter Batch Posting - Hourly\" - Click Abort</p> </li> <li> <p>Deactivate Flow (if causing issues):</p> <ul> <li>Go to Setup \u2192 Flows</li> <li>Find <code>Add Chatter Service To New Groups</code></li> <li>Click Deactivate</li> </ul> </li> </ol>"},{"location":"automation/event-chatter-batch-production-deployment/#code-rollback-if-needed","title":"Code Rollback (If Needed)","text":"<p>If you need to revert code changes:</p> <ol> <li> <p>Revert Apex Classes:</p> <ul> <li>Deploy previous version from git history</li> <li>Or comment out batch job scheduling</li> </ul> </li> <li> <p>Remove Custom Field (if needed):     <pre><code>sf project delete source \\\n    --target-org smi \\\n    --source-dir force-app/main/default/objects/Event_Registration__c/fields/Chatter_Posted__c.field-meta.xml\n</code></pre> Warning: This is destructive and will remove the field and all data.</p> </li> </ol>"},{"location":"automation/event-chatter-batch-production-deployment/#re-enable-old-flow-if-needed","title":"Re-enable Old Flow (If Needed)","text":"<p>If the old <code>Notify_Subscribers_New_Event</code> flow was deactivated and needs to be re-enabled:</p> <ul> <li>Go to Setup \u2192 Flows</li> <li>Find <code>Notify Subscribers New Event</code></li> <li>Click Activate</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#deployment-timeline","title":"Deployment Timeline","text":"<p>Estimated Total Time: ~20-30 minutes</p> <ul> <li>Step 1 (Field): ~2 minutes</li> <li>Step 2 (Classes): ~5-10 minutes</li> <li>Step 3 (Flow): ~2 minutes</li> <li>Step 4 (Mark Events): ~2-3 minutes</li> <li>Step 5 (Schedule): ~2 minutes</li> <li>Step 6 (Service Account): ~2-3 minutes (optional)</li> <li>Verification: ~5-10 minutes</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#quick-reference","title":"Quick Reference","text":"<p>Required Components:</p> <ul> <li>Custom Field: <code>Event_Registration__c.Chatter_Posted__c</code> (Checkbox)</li> <li>Apex Classes: <code>EventChatterBatchPoster</code>, <code>EventChatterPostHelper</code> (updated)</li> <li>Flow: <code>Add_Chatter_Service_To_New_Groups</code></li> <li>Scheduled Job: \"Event Chatter Batch Posting - Hourly\" (runs every 60 minutes)</li> </ul> <p>Query Logic:</p> <pre><code>Status__c = 'Approved'\nAND Activity_Group__c != null\nAND Chatter_Posted__c != true\n</code></pre> <p>Cron Expression: <code>0 0 * * * ?</code> (Every hour at minute 0, second 0)</p> <p>Batch Size: 200 records per batch execution</p>"},{"location":"automation/event-chatter-batch-production-deployment/#post-deployment-monitoring","title":"Post-Deployment Monitoring","text":""},{"location":"automation/event-chatter-batch-production-deployment/#first-week","title":"First Week","text":"<ul> <li>Monitor Setup \u2192 Scheduled Jobs daily</li> <li>Check Setup \u2192 Apex Jobs for any failures</li> <li>Verify posts appear in Chatter groups</li> <li>Review any user feedback</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#ongoing","title":"Ongoing","text":"<ul> <li>Weekly check of scheduled job status</li> <li>Monthly review of batch job performance</li> <li>Monitor for any errors in debug logs</li> </ul>"},{"location":"automation/event-chatter-batch-production-deployment/#support-troubleshooting","title":"Support &amp; Troubleshooting","text":"<p>Common Issues:</p> <ol> <li> <p>Batch job fails with \"INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY\":</p> <ul> <li>Verify service account (<code>sm-client@prolocity.com</code>) has proper permissions</li> <li>Check that service account is a member of all Chatter groups</li> </ul> </li> <li> <p>Events not being posted:</p> <ul> <li>Verify <code>Chatter_Posted__c</code> field exists and is accessible</li> <li>Check that events have <code>Status__c = 'Approved'</code> and <code>Activity_Group__c != null</code></li> <li>Review batch job debug logs</li> </ul> </li> <li> <p>Duplicate posts:</p> <ul> <li>Verify <code>Chatter_Posted__c</code> is being set to <code>true</code> after posting</li> <li>Check that Step 4 (mark all existing events) was run before scheduling</li> </ul> </li> <li> <p>Scheduled job not running:</p> <ul> <li>Verify job is active in Setup \u2192 Scheduled Jobs</li> <li>Check next fire time is correct</li> <li>Review org's time zone settings</li> </ul> </li> </ol>"},{"location":"automation/event-chatter-batch-production-deployment/#notes","title":"Notes","text":"<ul> <li>The batch job runs every 60 minutes (hourly) at the top of each hour</li> <li>Events are only posted once (tracked by <code>Chatter_Posted__c</code>)</li> <li>The job processes events in batches of 200</li> <li>Posts are made to activity group Chatter groups (Hiking, Climbing, etc.)</li> <li>The job runs as the user who scheduled it (or as specified in the scheduler)</li> </ul> <p>Last Updated: Based on staging deployment on 2025-11-29 Deployment Target: Production org <code>smi</code> Feature Status: Ready for Production</p>"},{"location":"automation/event-chatter-batch-setup/","title":"Event Chatter Batch Posting - Field Setup","text":""},{"location":"automation/event-chatter-batch-setup/#problem","title":"Problem","text":"<p>The batch job needs to prevent duplicate processing when:</p> <ol> <li>Event is approved \u2192 processed \u2192 posted to Chatter</li> <li>Event leader modifies event details \u2192 LastModifiedDate updates</li> <li>Batch job runs again \u2192 re-processes the same event \u2192 duplicate post</li> </ol>"},{"location":"automation/event-chatter-batch-setup/#solution","title":"Solution","text":"<p>Use a simple checkbox field to track which events have been posted. The batch job processes ANY approved event where <code>Chatter_Posted__c != true</code>, ensuring no events are missed while preventing duplicates.</p>"},{"location":"automation/event-chatter-batch-setup/#required-field","title":"Required Field","text":"<p>Field Name: <code>Chatter_Posted__c</code></p> <ul> <li>Type: Checkbox</li> <li>Label: \"Chatter Posted\"</li> <li>Default Value: Unchecked</li> <li>Description: \"Indicates if this event has been posted to Chatter. Set to true after batch job posts the event.\"</li> </ul>"},{"location":"automation/event-chatter-batch-setup/#implementation-steps","title":"Implementation Steps","text":"<ol> <li> <p>Create the Field:</p> <ul> <li>Go to Setup \u2192 Object Manager \u2192 Event Registration</li> <li>Create the checkbox field <code>Chatter_Posted__c</code></li> <li>Add to page layouts if needed (optional, mainly used by automation)</li> </ul> </li> <li> <p>Deploy Batch Class:</p> <ul> <li>The batch class queries events where <code>Chatter_Posted__c != true</code></li> <li>After posting, it sets <code>Chatter_Posted__c = true</code></li> </ul> </li> </ol>"},{"location":"automation/event-chatter-batch-setup/#how-it-works","title":"How It Works","text":"<ol> <li>Event Approval: When an event is approved (<code>Status__c = 'Approved'</code>), <code>Chatter_Posted__c</code> is unchecked (default)</li> <li>Batch Query: Batch job queries ALL approved events where <code>Chatter_Posted__c != true</code><ul> <li>This includes events where the field is <code>false</code>, <code>null</code>, or any value other than <code>true</code></li> <li>No time window restriction - processes any unposted approved event</li> </ul> </li> <li>Posting: Batch job posts events to Chatter groups, grouped by activity group</li> <li>Tracking: Batch job sets <code>Chatter_Posted__c = true</code> after posting</li> <li>Prevention: Future batch runs skip events where <code>Chatter_Posted__c = true</code>, even if the event is modified later</li> </ol>"},{"location":"automation/event-chatter-batch-setup/#benefits-of-this-approach","title":"Benefits of This Approach","text":"<ul> <li>Simple: Only requires one checkbox field</li> <li>Robust: Catches any events that might have been missed (batch failures, field added later, etc.)</li> <li>No Time Window: Processes events regardless of when they were approved</li> <li>Duplicate Prevention: Once posted, events are never reprocessed, even if modified</li> </ul>"},{"location":"automation/event-chatter-batch-setup/#testing","title":"Testing","text":"<p>After setup, test the batch job:</p> <ol> <li>Create an <code>Event_Registration__c</code> with <code>Status__c = 'Approved'</code></li> <li>Verify <code>Chatter_Posted__c</code> is unchecked (default)</li> <li>Run batch job manually: <code>Database.executeBatch(new EventChatterBatchPoster(), 200);</code></li> <li>Verify events are posted to Chatter groups</li> <li>Verify <code>Chatter_Posted__c</code> is set to true on the events</li> <li>Modify the event (change Location, etc.)</li> <li>Run batch job again</li> <li>Verify the event is NOT reprocessed (Chatter_Posted__c = true prevents it)</li> </ol>"},{"location":"automation/google-login-automation/","title":"Google Login Automation","text":"<p>This document describes the technical implementation of Google OAuth authentication for the Spokane Mountaineers Experience Cloud site.</p>"},{"location":"automation/google-login-automation/#access","title":"Access","text":"<ul> <li>Apex Class: GoogleAuthRegistrationHandler</li> <li>Test Class: GoogleAuthRegistrationHandlerTest</li> <li>Auth Provider: Setup \u2192 Identity \u2192 Auth. Providers \u2192 Google</li> </ul>"},{"location":"automation/google-login-automation/#purpose","title":"\ud83c\udfaf Purpose","text":"<p>The <code>GoogleAuthRegistrationHandler</code> implements Salesforce's <code>Auth.RegistrationHandler</code> interface to manage user authentication for Google OAuth login on Experience Cloud sites. It:</p> <ul> <li>Authenticates existing users via Google OAuth</li> <li>Matches users by username pattern (<code>email + '.smi'</code>)</li> <li>Prevents new account creation (Donorbox-only registration)</li> <li>Provides actionable error messages for users</li> </ul>"},{"location":"automation/google-login-automation/#configuration","title":"\u2699\ufe0f Configuration","text":""},{"location":"automation/google-login-automation/#prerequisites","title":"Prerequisites","text":"<ol> <li>My Domain must be deployed</li> <li>Google Auth Provider must be configured with:<ul> <li>Consumer Key and Secret from Google Cloud Console</li> <li>Scopes: <code>openid email profile</code></li> <li>Registration Handler: <code>GoogleAuthRegistrationHandler</code></li> </ul> </li> <li>Experience Cloud Site must have:<ul> <li>Google Auth Provider enabled in Login &amp; Registration settings</li> <li>Social Login component added to the Login page</li> <li>Self-Registration disabled (to prevent bypassing Donorbox)</li> </ul> </li> </ol>"},{"location":"automation/google-login-automation/#setup-steps","title":"Setup Steps","text":"<ol> <li> <p>Configure Google Auth Provider:</p> <ul> <li>Navigate to: Setup \u2192 Identity \u2192 Auth. Providers \u2192 Google</li> <li>Assign Registration Handler: <code>GoogleAuthRegistrationHandler</code></li> <li>Set \"Execute Registration As\" to a user with appropriate permissions</li> </ul> </li> <li> <p>Enable for Experience Cloud Site:</p> <ul> <li>Navigate to: Setup \u2192 Digital Experiences \u2192 All Sites \u2192 Spokane Mountaineers \u2192 Administration \u2192 Login &amp; Registration</li> <li>Under Authentication Providers, enable Google</li> <li>Under Registration, set Self-Registration to Disabled</li> </ul> </li> <li> <p>Add Social Login Component:</p> <ul> <li>Open Experience Builder for your site</li> <li>Navigate to the Login page</li> <li>Add the Social Login component</li> <li>Publish changes</li> </ul> </li> </ol>"},{"location":"automation/google-login-automation/#implementation-details","title":"\ud83e\uddf1 Implementation Details","text":""},{"location":"automation/google-login-automation/#user-matching-strategy","title":"User Matching Strategy","text":"<p>The handler uses username pattern matching for reliable user identification:</p> <pre><code>String usernamePattern = email.toLowerCase().trim() + '.smi';\nList&lt;User&gt; usersByUsername = [\n    SELECT Id, Username, Email, IsActive\n    FROM User\n    WHERE Username = :usernamePattern\n    LIMIT 1\n];\n</code></pre> <p>Why username pattern matching?</p> <ul> <li>Usernames cannot be modified - Provides a stable identifier for authentication</li> <li>Email addresses can change - Members might update their email in Salesforce, but username remains constant</li> <li>Single query - Efficient database lookup using indexed Username field</li> <li>Predictable format - Always follows <code>email@example.com.smi</code> pattern</li> </ul>"},{"location":"automation/google-login-automation/#account-creation-prevention","title":"Account Creation Prevention","text":"<p>The handler does not create new accounts. If no matching user is found, it throws an exception with actionable guidance:</p> <pre><code>if (!usersByUsername.isEmpty()) {\n    return usersByUsername[0];\n}\n\n// No user found - provide actionable guidance\nthrow new RegistrationHandlerException(\n    'No account found for this email address.\\n\\n' +\n    'If you are a new member, please sign up at:\\n' +\n    'https://donorbox.org/spokanemountaineers-membership-2\\n\\n' +\n    'If you already have an account, please:\\n' +\n    '1. Use your usual login method for now\\n' +\n    '2. Report this issue to webdev@spokanemountaineers.org\\n\\n' +\n    'We will help you link your Google account to your existing membership.'\n);\n</code></pre> <p>This ensures that:</p> <ul> <li>New memberships go through Donorbox (payment required)</li> <li>Existing members get clear guidance on next steps</li> <li>No duplicate accounts are created</li> </ul>"},{"location":"automation/google-login-automation/#flow-diagram","title":"\ud83d\udcca Flow Diagram","text":"<p>Source: google-login-flow.d2</p>"},{"location":"automation/google-login-automation/#code-structure","title":"\ud83d\udd0d Code Structure","text":""},{"location":"automation/google-login-automation/#main-methods","title":"Main Methods","text":""},{"location":"automation/google-login-automation/#createuserid-portalid-authuserdata-data","title":"<code>createUser(Id portalId, Auth.UserData data)</code>","text":"<p>Main entry point called by Salesforce during Google OAuth flow.</p> <p>Parameters:</p> <ul> <li><code>portalId</code>: Network (Experience Cloud site) ID</li> <li><code>data</code>: User data from Google OAuth callback (includes email, firstName, lastName)</li> </ul> <p>Returns: <code>User</code> record if found, throws exception if not found</p> <p>Logic:</p> <ol> <li>Validates email is present</li> <li>Calls <code>findExistingUser()</code> to locate user</li> <li>If found, returns user</li> <li>If not found, throws exception with actionable guidance</li> </ol>"},{"location":"automation/google-login-automation/#findexistinguserstring-email","title":"<code>findExistingUser(String email)</code>","text":"<p>Finds existing user by username pattern.</p> <p>Parameters:</p> <ul> <li><code>email</code>: Email address from Google OAuth</li> </ul> <p>Returns: <code>User</code> record if found, <code>null</code> if not found</p> <p>Logic:</p> <ol> <li>Constructs username pattern: <code>email.toLowerCase().trim() + '.smi'</code></li> <li>Queries User table for matching username</li> <li>Returns first match or <code>null</code></li> </ol>"},{"location":"automation/google-login-automation/#updateuserid-userid-id-portalid-authuserdata-data","title":"<code>updateUser(Id userId, Id portalId, Auth.UserData data)</code>","text":"<p>Called when user data needs updating (not used in this implementation).</p> <p>Note: This method intentionally does nothing. Existing flows handle user updates automatically.</p>"},{"location":"automation/google-login-automation/#testing","title":"\ud83e\uddea Testing","text":""},{"location":"automation/google-login-automation/#test-coverage","title":"Test Coverage","text":"<p>The test class <code>GoogleAuthRegistrationHandlerTest</code> provides 100% code coverage with 22 test methods covering:</p> <ul> <li>User matching by username pattern</li> <li>Error handling for blank emails</li> <li>Error handling for non-existent users</li> <li>Helper method testing (alias generation, password generation, etc.)</li> </ul>"},{"location":"automation/google-login-automation/#running-tests","title":"Running Tests","text":"<pre><code>sf apex run test --class-names GoogleAuthRegistrationHandlerTest --target-org smi --code-coverage\n</code></pre>"},{"location":"automation/google-login-automation/#test-scenarios","title":"Test Scenarios","text":"<ol> <li>Existing User Found: Verifies successful login when username pattern matches</li> <li>User Not Found: Verifies exception is thrown with actionable error message</li> <li>Blank Email: Verifies exception is thrown for invalid input</li> <li>Edge Cases: Tests helper methods with various inputs</li> </ol>"},{"location":"automation/google-login-automation/#error-handling","title":"\ud83d\udea8 Error Handling","text":""},{"location":"automation/google-login-automation/#common-error-scenarios","title":"Common Error Scenarios","text":""},{"location":"automation/google-login-automation/#no-account-found","title":"No Account Found","text":"<p>User sees:</p> <pre><code>No account found for this email address.\n\nIf you are a new member, please sign up at:\nhttps://donorbox.org/spokanemountaineers-membership-2\n\nIf you already have an account, please:\n1. Use your usual login method for now\n2. Report this issue to webdev@spokanemountaineers.org\n\nWe will help you link your Google account to your existing membership.\n</code></pre> <p>Resolution:</p> <ul> <li>New members: Direct to Donorbox signup</li> <li>Existing members: Contact webdev for account linking assistance</li> </ul>"},{"location":"automation/google-login-automation/#blank-email","title":"Blank Email","text":"<p>User sees:</p> <pre><code>Email is required for authentication\n</code></pre> <p>Resolution: This should not occur in normal operation. If it does, contact webdev.</p>"},{"location":"automation/google-login-automation/#maintenance","title":"\ud83d\udd27 Maintenance","text":""},{"location":"automation/google-login-automation/#updating-username-pattern","title":"Updating Username Pattern","text":"<p>If the <code>.smi</code> suffix is removed in the future, update line 96 in <code>GoogleAuthRegistrationHandler.cls</code>:</p> <p>Current:</p> <pre><code>String usernamePattern = email.toLowerCase().trim() + '.smi';\n</code></pre> <p>Future (if .smi removed):</p> <pre><code>String usernamePattern = email.toLowerCase().trim();\n</code></pre>"},{"location":"automation/google-login-automation/#adding-additional-auth-providers","title":"Adding Additional Auth Providers","text":"<p>To add support for additional OAuth providers (e.g., Microsoft, Facebook):</p> <ol> <li>Create new Auth Provider in Setup</li> <li>Create new Registration Handler class (or extend existing)</li> <li>Assign handler to Auth Provider</li> <li>Enable provider in Experience Cloud site settings</li> </ol>"},{"location":"automation/google-login-automation/#monitoring","title":"Monitoring","text":"<p>Monitor for:</p> <ul> <li>Failed login attempts (check debug logs)</li> <li>User-reported issues (webdev@spokanemountaineers.org)</li> <li>Exception frequency (Salesforce debug logs)</li> </ul>"},{"location":"automation/google-login-automation/#performance","title":"\ud83d\udcc8 Performance","text":""},{"location":"automation/google-login-automation/#query-optimization","title":"Query Optimization","text":"<ul> <li>Single SOQL query per login attempt</li> <li>Indexed field (Username) for fast lookups</li> <li>LIMIT 1 to minimize data transfer</li> <li>Efficient database lookup with minimal overhead</li> </ul>"},{"location":"automation/google-login-automation/#security-considerations","title":"\ud83d\udd10 Security Considerations","text":""},{"location":"automation/google-login-automation/#account-creation-prevention_1","title":"Account Creation Prevention","text":"<ul> <li>Self-Registration must be disabled in Experience Cloud settings</li> <li>Handler explicitly throws exceptions instead of creating users</li> <li>Donorbox remains the only account creation path</li> </ul>"},{"location":"automation/google-login-automation/#user-matching","title":"User Matching","text":"<ul> <li>Username pattern matching provides a stable authentication identifier</li> <li>Usernames cannot be modified, preventing account hijacking</li> <li>Email changes don't break authentication since matching is based on username</li> </ul>"},{"location":"automation/google-login-automation/#error-messages","title":"Error Messages","text":"<ul> <li>Error messages are user-friendly but don't expose system internals</li> <li>Clear guidance directs users to appropriate support channels</li> </ul>"},{"location":"automation/google-login-automation/#related-documentation","title":"\ud83d\udcdd Related Documentation","text":"<ul> <li>Google Login Article - User-friendly overview</li> <li>Experience Cloud Setup - Salesforce documentation</li> <li>Auth.RegistrationHandler Interface - Salesforce Apex documentation</li> </ul>"},{"location":"automation/google-login-automation/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"automation/google-login-automation/#google-button-not-appearing","title":"Google Button Not Appearing","text":"<ol> <li>Verify Auth Provider is enabled for the Experience Cloud site</li> <li>Check that Social Login component is added to Login page</li> <li>Verify Self-Registration settings (should be disabled)</li> <li>Check browser console for JavaScript errors</li> </ol>"},{"location":"automation/google-login-automation/#login-fails-for-existing-user","title":"Login Fails for Existing User","text":"<ol> <li>Verify user's username follows pattern: <code>email@example.com.smi</code></li> <li>Check that user is active (<code>IsActive = true</code>)</li> <li>Review debug logs for exception details</li> <li>Verify email from Google matches username pattern</li> </ol>"},{"location":"automation/google-login-automation/#exception-messages-not-showing","title":"Exception Messages Not Showing","text":"<ol> <li>Check Salesforce debug logs for full exception details</li> <li>Verify error handling in Experience Cloud login component</li> <li>Test with different browsers/devices</li> </ol>"},{"location":"automation/google-login-automation/#support","title":"\ud83d\udcde Support","text":"<p>For issues or questions about Google login automation:</p> <ul> <li>Email: webdev@spokanemountaineers.org</li> <li>GitHub Issues: Create an issue</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/","title":"\ud83d\udd14 Flow: Notify Leader on RSVP","text":"<p>This automated Salesforce Flow sends an email notification to the event leader whenever someone RSVPs \"Attending\" to an event registration.</p>"},{"location":"automation/notify-leader-on-rsvp/#access","title":"Access","text":"<ul> <li>Flow: Notify Leader on RSVP</li> <li>GitHub: Notify_Leader_on_RSVP.flow-meta.xml</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#purpose","title":"\ud83c\udfaf Purpose","text":"<p>This Flow automatically notifies event leaders via email when a member RSVPs to their event. It:</p> <ul> <li>Triggers automatically when a new <code>Event_Participant__c</code> record is created</li> <li>Only processes participants with <code>Response__c = \"Attending\"</code></li> <li>Retrieves the event leader's email from their associated Contact record</li> <li>Sends a formatted email with event and participant details</li> <li>Includes a direct link to view the event registration in Salesforce</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#trigger","title":"\u26a1 Trigger","text":"<ul> <li>Object: <code>Event_Participant__c</code></li> <li>Trigger Type: Record-Triggered Flow</li> <li>Trigger Timing: After Save</li> <li>Entry Conditions:<ul> <li>Record is created (not updated)</li> <li><code>Response__c = \"Attending\"</code></li> </ul> </li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#flow-structure","title":"\ud83e\uddf1 Flow Structure","text":""},{"location":"automation/notify-leader-on-rsvp/#1-get-event-registration","title":"1. Get Event Registration","text":"<p>Retrieves the related <code>Event_Registration__c</code> record to access:</p> <ul> <li>Event name</li> <li>Leader lookup (<code>Leader__c</code>)</li> <li>Event start time (<code>Start__c</code>)</li> <li>Event location (<code>Location__c</code>)</li> </ul> <p>Element: <code>Get_Event_Registration</code></p>"},{"location":"automation/notify-leader-on-rsvp/#2-decision-is-attending","title":"2. Decision: Is Attending?","text":"<p>Checks if the participant's response is \"Attending\".</p> <p>Element: <code>Is_Attending</code></p> <ul> <li>\u2705 Response is Attending: Proceeds to get leader information</li> <li>\u274c Not Attending: Flow exits (no email sent)</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#3-get-leader-user-record","title":"3. Get Leader User Record","text":"<p>Retrieves the User record from <code>Event_Registration__c.Leader__c</code> to access:</p> <ul> <li>User ID</li> <li>User Name (for email greeting)</li> <li>Contact ID (<code>ContactId</code>) - used to get the Contact email</li> </ul> <p>Element: <code>Get_Leader</code></p> <p>Note: We get the leader's email from their Contact record rather than directly from the User record, as Contact.Email is more reliable for Community users.</p>"},{"location":"automation/notify-leader-on-rsvp/#4-decision-has-leader","title":"4. Decision: Has Leader?","text":"<p>Validates that a leader is assigned to the event.</p> <p>Element: <code>Has_Leader</code></p> <ul> <li>\u2705 Leader Exists: Proceeds to get leader's Contact record</li> <li>\u274c No Leader: Flow exits (no email to send)</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#5-get-leader-contact-parallel-with-get-participant-contact","title":"5. Get Leader Contact (Parallel with Get Participant Contact)","text":"<p>Retrieves the Contact record associated with the leader User to access:</p> <ul> <li>Contact Email (primary email address)</li> <li>Contact Name</li> </ul> <p>Element: <code>Get_Leader_Contact</code></p> <p>This runs in parallel with <code>Get_Participant_Contact</code> for efficiency.</p>"},{"location":"automation/notify-leader-on-rsvp/#6-get-participant-contact-parallel-with-get-leader-contact","title":"6. Get Participant Contact (Parallel with Get Leader Contact)","text":"<p>Retrieves the Contact record of the person who RSVP'd to include their name in the email.</p> <p>Element: <code>Get_Participant_Contact</code></p> <p>This runs in parallel with <code>Get_Leader_Contact</code> for efficiency.</p>"},{"location":"automation/notify-leader-on-rsvp/#7-decision-has-leader-email","title":"7. Decision: Has Leader Email?","text":"<p>Validates that the leader's Contact record has an email address.</p> <p>Element: <code>Has_Leader_Email</code></p> <ul> <li>\u2705 Email Exists: Proceeds to send email</li> <li>\u274c No Email: Flow exits (cannot send email)</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#8-send-email-to-leader","title":"8. Send Email to Leader","text":"<p>Sends a formatted email to the event leader.</p> <p>Element: <code>Send_Email_to_Leader</code></p> <p>Email Subject:</p> <pre><code>New RSVP for {Event Registration Name}\n</code></pre> <p>Email Body:</p> <pre><code>Hi {Leader Name},\n\nA member has RSVP'd for your event.\n\nEvent: {Event Registration Name}\nParticipant: {Participant Contact Name}\nResponse: Attending\nEvent Start: {Event Start Date/Time}\nLocation: {Event Location}\n\nYou can view the event here:\nhttps://www.spokanemountaineers.org/s/event-registration/{Event Registration ID}\n\nBest regards,\nSpokane Mountaineers\n</code></pre> <p>Email Configuration:</p> <ul> <li>To: <code>Get_Leader_Contact.Email</code></li> <li>From/Sender: <code>admin@spokanemountaineers.org</code> (Org-Wide Email Address)</li> <li>Sender Type: <code>OrgWideEmailAddress</code></li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#data-model","title":"\ud83d\udd0d Data Model","text":""},{"location":"automation/notify-leader-on-rsvp/#objects-used","title":"Objects Used","text":"Object Purpose Key Fields <code>Event_Participant__c</code> Trigger record - represents someone RSVPing <code>Event_Registration__c</code>, <code>Contact__c</code>, <code>Response__c</code> <code>Event_Registration__c</code> The event being RSVP'd for <code>Leader__c</code>, <code>Name</code>, <code>Start__c</code>, <code>Location__c</code> <code>User</code> Event leader's user record <code>Id</code>, <code>Name</code>, <code>ContactId</code> <code>Contact</code> Leader's contact record (for email) <code>Id</code>, <code>Email</code>, <code>Name</code> <code>Contact</code> Participant's contact record (for email content) <code>Id</code>, <code>Name</code>, <code>FirstName</code>, <code>LastName</code>"},{"location":"automation/notify-leader-on-rsvp/#relationships","title":"Relationships","text":"<ul> <li><code>Event_Participant__c.Event_Registration__c</code> \u2192 <code>Event_Registration__c</code> (Master-Detail)</li> <li><code>Event_Registration__c.Leader__c</code> \u2192 <code>User</code> (Lookup)</li> <li><code>User.ContactId</code> \u2192 <code>Contact</code> (Lookup)</li> <li><code>Event_Participant__c.Contact__c</code> \u2192 <code>Contact</code> (Lookup)</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#edge-cases-handled","title":"\u26a0\ufe0f Edge Cases Handled","text":"<ol> <li>Response is not \"Attending\": Flow exits early, no email sent</li> <li>No Leader assigned: Flow exits if <code>Event_Registration__c.Leader__c</code> is null</li> <li>Leader has no Contact: Flow exits if <code>User.ContactId</code> is null</li> <li>Leader Contact has no Email: Flow exits if <code>Contact.Email</code> is null</li> <li>Participant Contact lookup fails: Flow still continues if participant contact cannot be retrieved (uses available data)</li> </ol>"},{"location":"automation/notify-leader-on-rsvp/#why-use-contact-email-instead-of-user-email","title":"\ud83d\udd27 Why Use Contact Email Instead of User Email?","text":"<p>This flow intentionally retrieves the email address from the leader's Contact record rather than directly from the User record. This is because:</p> <ul> <li>Community Users: For Community/Experience Cloud users, the <code>User.Email</code> field may not always be reliable or up-to-date</li> <li>Contact as Source of Truth: The <code>Contact.Email</code> field is typically the primary communication email and is more likely to be current</li> <li>Consistency: Using Contact.Email ensures consistent email delivery across standard and community users</li> </ul> <p>The flow retrieves the Contact via <code>User.ContactId</code>, then uses <code>Contact.Email</code> for the email notification.</p>"},{"location":"automation/notify-leader-on-rsvp/#monitoring-troubleshooting","title":"\ud83d\udcca Monitoring &amp; Troubleshooting","text":""},{"location":"automation/notify-leader-on-rsvp/#check-flow-execution","title":"Check Flow Execution","text":"<ol> <li>Go to Setup \u2192 Flows</li> <li>Find Notify Leader on RSVP</li> <li>Click View Details and Versions</li> <li>Click View next to the active version</li> <li>Review Interview Logs to see execution history</li> </ol>"},{"location":"automation/notify-leader-on-rsvp/#common-issues","title":"Common Issues","text":"Issue Possible Cause Solution No email received Leader Contact missing email Verify <code>Contact.Email</code> is populated for the leader No email received Leader User missing ContactId Verify <code>User.ContactId</code> is populated Flow not triggering Event Participant created with wrong Response Verify <code>Response__c = \"Attending\"</code> on new records Email not sending Invalid sender address Verify Org-Wide Email Address <code>admin@spokanemountaineers.org</code> is configured and active"},{"location":"automation/notify-leader-on-rsvp/#verify-email-delivery","title":"Verify Email Delivery","text":"<ul> <li>Review Flow Interview logs for errors</li> <li>Verify leader's Contact.Email is valid and active</li> <li>Verify Org-Wide Email Address <code>admin@spokanemountaineers.org</code> is configured and active</li> <li>Check email delivery logs in Setup \u2192 Email Administration \u2192 View Email Logs</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#future-enhancements","title":"\ud83d\ude80 Future Enhancements","text":"Feature Notes Handle Updates Currently only triggers on Create. Could add Update trigger to notify when someone changes from \"Not Attending\" to \"Attending\" Email Template Use Salesforce Email Template instead of hardcoded email body for easier customization HTML Email Format email as HTML for better presentation Bulk RSVP Notification Option to batch RSVP notifications (e.g., send one email per day with all new RSVPs) Opt-out Preference Allow leaders to opt-out of RSVP notifications per event Participant Count Include total participant count in the email"},{"location":"automation/notify-leader-on-rsvp/#related-documentation","title":"\ud83d\udcdd Related Documentation","text":"<ul> <li>Event Participant Redirect: Related solution for event participant functionality</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#technical-details","title":"\ud83d\udee0 Technical Details","text":"<ul> <li>API Version: 65.0</li> <li>Flow Type: Auto-Launched Flow (Record-Triggered)</li> <li>Process Type: RecordAfterSave</li> <li>Status: Active</li> <li>Bulk Support: Yes (handles multiple Event_Participant__c records created in same transaction)</li> <li>Maintainability: Each flow element includes a description explaining its purpose and intent for easier future maintenance</li> </ul>"},{"location":"automation/notify-leader-on-rsvp/#support","title":"\ud83d\udcde Support","text":"<p>For issues or questions about this flow, contact the tech team at webdev@spokanemountaineers.org.</p>"},{"location":"automation/notify-subscribers-new-event/","title":"\ud83d\udd14 Batch Service: Event Chatter Batch Posting","text":"<p>This automated Salesforce batch job posts rich text notifications to activity group Chatter groups daily, collecting all approved events that haven't been posted yet and posting one comprehensive message per activity group.</p>"},{"location":"automation/notify-subscribers-new-event/#access","title":"Access","text":"<ul> <li>Apex Class: EventChatterBatchPoster.cls</li> <li>Helper Class: EventChatterPostHelper.cls</li> <li>Scheduled Jobs: Setup \u2192 Scheduled Jobs</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#purpose","title":"\ud83c\udfaf Purpose","text":"<p>This batch service automatically posts rich text notifications to activity group Chatter groups on a daily schedule. It:</p> <ul> <li>Runs daily at 5:00 AM Pacific Time</li> <li>Queries all <code>Event_Registration__c</code> records that are approved but haven't been posted yet (<code>Chatter_Posted__c != true</code>)</li> <li>Groups events by <code>Activity_Group__c</code></li> <li>Posts one comprehensive message per activity group containing all events for that group</li> <li>Handles high-volume event approvals efficiently (10-20 events at once)</li> <li>Leverages Chatter's native notification system for members subscribed to the groups</li> <li>Processes any unposted approved event, regardless of when it was approved (ensures no events are missed)</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#schedule","title":"\u26a1 Schedule","text":"<ul> <li>Frequency: Daily</li> <li>Time: 5:00 AM Pacific Time</li> <li>Type: Scheduled Apex Batch Job</li> <li>Cron Expression: <code>0 0 5 * * ?</code></li> </ul> <p>Note: The batch job processes ANY approved event where <code>Chatter_Posted__c != true</code>, regardless of when it was approved. This ensures no events are missed, even if the batch job was skipped previously or events were approved before the field was added. Once posted, <code>Chatter_Posted__c</code> is set to <code>true</code> to prevent duplicate processing.</p>"},{"location":"automation/notify-subscribers-new-event/#batch-job-structure","title":"\ud83e\uddf1 Batch Job Structure","text":"<p>The batch job implements the standard Salesforce batchable pattern:</p>"},{"location":"automation/notify-subscribers-new-event/#1-start-method","title":"1. Start Method","text":"<p>Purpose: Query all approved events that haven't been posted yet</p> <p>Query Logic:</p> <pre><code>SELECT Id, Name, Activity_Group__c, Start__c, Location__c, Chatter_Posted__c\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nAND Activity_Group__c != null\nAND (Chatter_Posted__c != true)\nORDER BY Activity_Group__c, Start__c\n</code></pre> <p>Returns: <code>Database.QueryLocator</code> with all qualifying events</p> <p>Note: The query processes ANY approved event where <code>Chatter_Posted__c != true</code> (includes <code>false</code>, <code>null</code>, or any non-true value). This ensures no events are missed, regardless of when they were approved.</p>"},{"location":"automation/notify-subscribers-new-event/#2-execute-method","title":"2. Execute Method","text":"<p>Purpose: Process events in batches, group by activity group, and post</p> <p>Process:</p> <ol> <li>Receives batch of up to 200 Event_Registration__c records</li> <li>Groups events by <code>Activity_Group__c</code> into a Map</li> <li>For each activity group:<ul> <li>Finds matching Public Chatter group</li> <li>Calls <code>EventChatterPostHelper.postBatchToChatterGroup()</code> with all events for that group</li> <li>Posts single comprehensive message</li> </ul> </li> </ol> <p>Error Handling:</p> <ul> <li>If one activity group fails, continues processing other groups</li> <li>Logs errors but doesn't throw exceptions</li> <li>Ensures batch job completes even if some posts fail</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#3-finish-method","title":"3. Finish Method","text":"<p>Purpose: Log completion status</p> <p>Actions:</p> <ul> <li>Queries AsyncApexJob to get execution details</li> <li>Logs status, job items processed, and any errors</li> <li>Provides summary for monitoring</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#data-model","title":"\ud83d\udd0d Data Model","text":""},{"location":"automation/notify-subscribers-new-event/#objects-used","title":"Objects Used","text":"Object Purpose Key Fields <code>Event_Registration__c</code> Trigger record - the approved event <code>Id</code>, <code>Name</code>, <code>Activity_Group__c</code>, <code>Start__c</code>, <code>Location__c</code>, <code>Status__c</code> <code>CollaborationGroup</code> Target Chatter group for posting <code>Id</code>, <code>Name</code>, <code>CollaborationType</code>"},{"location":"automation/notify-subscribers-new-event/#relationships","title":"Relationships","text":"<ul> <li><code>Event_Registration__c.Activity_Group__c</code> \u2192 Matches <code>CollaborationGroup.Name</code> (Text match)</li> <li>Flow queries for Public Chatter groups where <code>Name = Activity_Group__c</code></li> </ul>"},{"location":"automation/notify-subscribers-new-event/#rich-text-message-format","title":"\ud83d\udcdd Rich Text Message Format","text":""},{"location":"automation/notify-subscribers-new-event/#single-event-format","title":"Single Event Format","text":"<p>When only one event is found for an activity group:</p> <ol> <li>Bold Title: \"New {Activity Group} Event!\"</li> <li>Blank line</li> <li>Introduction: \"A new {Activity Group} event has been added to the club calendar!\"</li> <li>Blank line</li> <li>Bold Event Name</li> <li>Event Details (separate paragraphs):<ul> <li>Leader: {Leader Name} or \"TBD\"</li> <li>Start: {Date/Time in M/d/yy at h:mma format} or \"TBD\"</li> <li>Location: {Location} or \"Location TBD\"</li> </ul> </li> <li>View Event: URL (auto-linked by Chatter)</li> </ol>"},{"location":"automation/notify-subscribers-new-event/#multiple-events-format-batch","title":"Multiple Events Format (Batch)","text":"<p>When multiple events are found for an activity group:</p> <ol> <li>Bold Title: \"New {Activity Group} Events Added!\"</li> <li>Introduction: \"We've added X new {Activity Group} events to the club calendar:\"</li> <li>Blank line</li> <li>For each event:<ul> <li>Bold Event Name</li> <li>Leader: {Leader Name}</li> <li>Start: {Date/Time}</li> <li>Location: {Location}</li> <li>View Event: {URL}</li> <li>(blank line between events)</li> </ul> </li> </ol>"},{"location":"automation/notify-subscribers-new-event/#example-output-single-event","title":"Example Output (Single Event)","text":"<pre><code>**New Hiking Event!**\n\nA new Hiking event has been added to the club calendar!\n\n**Stevens Lakes Snowshoe**\nLeader: Tyler Nyman\nStart: 1/15/26 at 7:00AM\nLocation: Mullan, ID\nView Event: https://www.spokanemountaineers.org/s/event-registration/a01...\n</code></pre>"},{"location":"automation/notify-subscribers-new-event/#example-output-batch","title":"Example Output (Batch)","text":"<pre><code>**New Hiking Events Added!**\n\nWe've added 3 new Hiking events to the club calendar:\n\n**Glacier Travel Practice**\nLeader: John Smith\nStart: 7/1/25 at 6:30PM\nLocation: Clubhouse\nView Event: https://www.spokanemountaineers.org/s/event-registration/a01...\n\n**Mountain Summit Hike**\nLeader: Jane Doe\nStart: 7/5/25 at 8:00AM\nLocation: Trailhead\nView Event: https://www.spokanemountaineers.org/s/event-registration/a02...\n\n**Evening Nature Walk**\nLeader: Bob Wilson\nStart: 7/10/25 at 6:00PM\nLocation: Park\nView Event: https://www.spokanemountaineers.org/s/event-registration/a03...\n</code></pre>"},{"location":"automation/notify-subscribers-new-event/#edge-cases-handled","title":"\u26a0\ufe0f Edge Cases Handled","text":"<ol> <li>No Events Approved: If no approved events need posting, batch completes with no posts</li> <li>No Activity Group: Query filters out events without <code>Activity_Group__c</code></li> <li>Chatter Group Not Found: If no matching Public group exists, logs error and continues with other groups</li> <li>Null Fields: Provides default values:<ul> <li>Missing Name \u2192 \"Unnamed Event\"</li> <li>Missing Activity Group \u2192 \"Unknown\"</li> <li>Missing Start \u2192 \"TBD\"</li> <li>Missing Location \u2192 \"Location TBD\"</li> </ul> </li> <li>Multiple Events Same Group: Groups all events by activity group and posts single message</li> <li>Posting Failures: If one group fails, continues processing other groups</li> <li>Large Batches: Processes in batches of 200 records to handle governor limits</li> <li>Duplicate Prevention: Uses <code>Chatter_Posted__c</code> checkbox to prevent reprocessing events that were already posted, even if they're modified later</li> <li>No Time Window: Processes any approved event that hasn't been posted, ensuring no events are missed even if batch job was skipped or events were approved before field was added</li> </ol>"},{"location":"automation/notify-subscribers-new-event/#required-setup","title":"\ud83d\udd27 Required Setup","text":"<p>IMPORTANT: This batch job requires custom fields and a Flow to prevent duplicate processing. See Event Chatter Batch Setup Guide for details.</p> <p>Required Field:</p> <ul> <li><code>Chatter_Posted__c</code> (Checkbox) - Tracks if event has been posted to Chatter</li> </ul> <p>No Flow Required: The batch job handles setting <code>Chatter_Posted__c = true</code> after posting. The field defaults to unchecked for new approved events.</p>"},{"location":"automation/notify-subscribers-new-event/#technical-implementation","title":"\ud83d\udd27 Technical Implementation","text":""},{"location":"automation/notify-subscribers-new-event/#eventchatterbatchposter-class","title":"EventChatterBatchPoster Class","text":"<p>The batch class implements <code>Database.Batchable&lt;SObject&gt;</code> and <code>Schedulable</code>:</p> <p>Schedulable Interface:</p> <pre><code>public void execute(SchedulableContext ctx) {\n    EventChatterBatchPoster batch = new EventChatterBatchPoster();\n    Database.executeBatch(batch, 200);\n}\n</code></pre> <p>Batchable Interface:</p> <ul> <li><code>start(Database.BatchableContext)</code> - Returns QueryLocator for all approved events where <code>Chatter_Posted__c != true</code></li> <li><code>execute(Database.BatchableContext, List&lt;Event_Registration__c&gt;)</code> - Groups events and posts</li> <li><code>finish(Database.BatchableContext)</code> - Logs completion status</li> </ul> <p>Key Features:</p> <ul> <li>Processes in batches of 200 records</li> <li>Groups events by Activity_Group__c before posting</li> <li>Calls EventChatterPostHelper.postBatchToChatterGroup() for each group</li> <li>Comprehensive error handling and logging</li> </ul> <p>See: EventChatterBatchPoster.cls</p>"},{"location":"automation/notify-subscribers-new-event/#eventchatterposthelper-class","title":"EventChatterPostHelper Class","text":"<p>The helper class provides batch posting methods:</p> <p>Batch Methods:</p> <pre><code>public static void postBatchToChatterGroup(\n    String activityGroupName,\n    List&lt;Event_Registration__c&gt; events\n)\n\npublic static ConnectApi.MessageBodyInput buildBatchRichTextMessageBody(\n    List&lt;Event_Registration__c&gt; events,\n    String activityGroup\n)\n</code></pre> <p>Key Methods:</p> <ul> <li><code>buildBatchRichTextMessageBody(...)</code> - Builds formatted message with multiple events</li> <li><code>postBatchToChatterGroup(...)</code> - Posts batch message to a single Chatter group</li> <li><code>buildRichTextMessageBody(Event_Registration__c)</code> - Single event format</li> <li><code>addParagraphWithBoldText(...)</code> - Helper for bold text paragraphs</li> <li><code>addParagraphText(...)</code> - Helper for plain text paragraphs</li> <li><code>addSpacerParagraph(...)</code> - Helper for blank lines between sections</li> <li><code>formatDateTime(DateTime)</code> - Formats dates as \"M/d/yy 'at' h:mma\" (e.g., \"1/22/26 at 7:00AM\")</li> </ul> <p>Connect API Usage: The class uses Salesforce's Connect API (<code>ConnectApi.ChatterFeeds.postFeedElement</code>) to post rich text messages with proper formatting. This ensures:</p> <ul> <li>Native Chatter formatting</li> <li>Proper paragraph structure</li> <li>Bold text support</li> <li>Bulleted lists for multiple events</li> <li>Automatic URL linking</li> </ul> <p>See: EventChatterPostHelper.cls</p>"},{"location":"automation/notify-subscribers-new-event/#monitoring-troubleshooting","title":"\ud83d\udcca Monitoring &amp; Troubleshooting","text":""},{"location":"automation/notify-subscribers-new-event/#check-batch-job-execution","title":"Check Batch Job Execution","text":"<ol> <li>Go to Setup \u2192 Scheduled Jobs</li> <li>Find Event Chatter Batch Posting - Daily 5am</li> <li>Review execution history, next run time, and status</li> <li>Click on job to see detailed execution logs</li> </ol>"},{"location":"automation/notify-subscribers-new-event/#check-async-apex-jobs","title":"Check Async Apex Jobs","text":"<ol> <li>Go to Setup \u2192 Apex Jobs (or Monitoring \u2192 Apex Jobs)</li> <li>Filter by class name: <code>EventChatterBatchPoster</code></li> <li>Review job status, records processed, and any errors</li> <li>Click on job to see detailed logs</li> </ol>"},{"location":"automation/notify-subscribers-new-event/#verify-chatter-posts","title":"Verify Chatter Posts","text":"<ol> <li>Navigate to the activity group Chatter group (e.g., \"Hiking\")</li> <li>Look for posts with title \"New {Activity Group} Events!\" (or \"Event!\" for single)</li> <li>Posts should appear after the 5am batch job runs</li> <li>Check that all events approved in last 24 hours are included</li> </ol>"},{"location":"automation/notify-subscribers-new-event/#common-issues","title":"Common Issues","text":"Issue Possible Cause Solution No Chatter posts appearing Batch job not scheduled Run the scheduling script: <code>scripts/apex/schedule_event_chatter_batch.apex</code> No Chatter posts appearing Events already posted Verify <code>Chatter_Posted__c</code> is not <code>true</code> on approved events No Chatter posts appearing Event not approved Verify <code>Status__c = 'Approved'</code> on Event_Registration__c No Chatter posts appearing Chatter group not found Verify Public Chatter group exists with name matching Activity_Group__c No Chatter posts appearing Activity Group not set Verify <code>Activity_Group__c</code> is populated on Event_Registration__c Batch job not running Job not scheduled Schedule the job using the script or manually via Setup \u2192 Scheduled Jobs Batch job not running Job aborted Check Scheduled Jobs for aborted jobs, reschedule if needed Batch job failing Apex errors Check debug logs and Apex Jobs for error details Chatter group not found Name mismatch Verify Chatter group name exactly matches Activity_Group__c (case-sensitive) Chatter group not found Group is Private Ensure Chatter group is Public (CollaborationType = 'Public') Posting fails Network/API issues Check debug logs for Connect API errors Posting fails User permissions Verify running user has permission to post to Chatter groups Events missing from post Already marked as posted Verify <code>Chatter_Posted__c</code> is not <code>true</code> on the event. If needed, set to <code>false</code> to reprocess Duplicate posts Multiple batch runs <code>Chatter_Posted__c = true</code> prevents duplicates. Verify field is being set correctly after posting"},{"location":"automation/notify-subscribers-new-event/#debug-logs","title":"Debug Logs","text":"<p>Enable debug logs for the <code>EventChatterPostHelper</code> class to see detailed execution:</p> <ol> <li>Go to Setup \u2192 Debug Logs</li> <li>Create a new trace flag for the user who approves events</li> <li>Set Apex Class to <code>EventChatterPostHelper</code></li> <li>Set log level to <code>DEBUG</code></li> <li>Approve an event and review the logs</li> </ol> <p>Look for:</p> <ul> <li>\"Event Registration not found\" - Event query failed</li> <li>\"Chatter group not found\" - Group lookup failed</li> <li>\"Successfully posted to Chatter group\" - Post succeeded</li> <li>Any exception messages</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#query-event-registrations","title":"Query Event Registrations","text":"<pre><code>-- See events that will be processed by batch job (approved but not posted)\nSELECT Id, Name, Activity_Group__c, Status__c, Start__c, Location__c, Chatter_Posted__c\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nAND Activity_Group__c != null\nAND (Chatter_Posted__c != true)\nORDER BY Activity_Group__c, Start__c\n\n-- Check for events without activity groups (won't be processed)\nSELECT Id, Name, Activity_Group__c, Status__c, Chatter_Posted__c\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nAND (Activity_Group__c = NULL OR Activity_Group__c = '')\n\n-- Count events by activity group (not yet posted)\nSELECT Activity_Group__c, COUNT(Id) EventCount\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nAND Activity_Group__c != null\nAND (Chatter_Posted__c != true)\nGROUP BY Activity_Group__c\nORDER BY EventCount DESC\n\n-- See events that have already been posted\nSELECT Id, Name, Activity_Group__c, Chatter_Posted__c\nFROM Event_Registration__c\nWHERE Status__c = 'Approved'\nAND Chatter_Posted__c = true\nORDER BY LastModifiedDate DESC\n</code></pre>"},{"location":"automation/notify-subscribers-new-event/#query-chatter-groups","title":"Query Chatter Groups","text":"<pre><code>-- List all Public Chatter groups\nSELECT Id, Name, CollaborationType, MemberCount\nFROM CollaborationGroup\nWHERE CollaborationType = 'Public'\nORDER BY Name\n\n-- Find groups matching activity groups\nSELECT Id, Name\nFROM CollaborationGroup\nWHERE CollaborationType = 'Public'\nAND Name IN ('Hiking', 'Climbing', 'Alpine', 'Conservation')\n</code></pre>"},{"location":"automation/notify-subscribers-new-event/#related-components","title":"\ud83d\udd17 Related Components","text":""},{"location":"automation/notify-subscribers-new-event/#apex-batch-class","title":"Apex Batch Class","text":"<p>The <code>EventChatterBatchPoster</code> class provides the batch processing:</p> <p>Main Methods:</p> <ul> <li><code>execute(SchedulableContext)</code> - Schedules the batch job</li> <li><code>start(Database.BatchableContext)</code> - Queries all approved events where <code>Chatter_Posted__c != true</code></li> <li><code>execute(Database.BatchableContext, List&lt;Event_Registration__c&gt;)</code> - Groups and posts events</li> <li><code>finish(Database.BatchableContext)</code> - Logs completion</li> </ul> <p>Test Coverage:</p> <ul> <li>Comprehensive test coverage for batch execution, grouping, and edge cases</li> <li>Tests cover empty batches, missing groups, and multiple events</li> </ul> <p>See: EventChatterBatchPoster.cls</p>"},{"location":"automation/notify-subscribers-new-event/#apex-helper-class","title":"Apex Helper Class","text":"<p>The <code>EventChatterPostHelper</code> class provides the posting functionality:</p> <p>Batch Methods:</p> <ul> <li><code>postBatchToChatterGroup(String, List&lt;Event_Registration__c&gt;)</code> - Posts batch of events to a single group</li> <li><code>buildBatchRichTextMessageBody(List&lt;Event_Registration__c&gt;, String)</code> - Builds formatted message with multiple events</li> </ul> <p>Single Event Methods:</p> <ul> <li><code>postEventToChatterGroup(List&lt;PostToChatterInput&gt;)</code> - Invocable Method - Posts single event (can be called from Flows)</li> </ul> <p>Helper Methods:</p> <ul> <li><code>buildRichTextMessageBody(Event_Registration__c)</code> - Builds formatted message for single event</li> <li><code>addParagraphText(...)</code> - Adds text paragraphs</li> <li><code>addParagraphWithBoldText(...)</code> - Adds bold text paragraphs</li> <li><code>addSpacerParagraph(...)</code> - Adds blank lines between sections</li> <li><code>formatDateTime(DateTime)</code> - Formats dates as \"M/d/yy at h:mma\"</li> </ul> <p>Test Coverage:</p> <ul> <li>Comprehensive test coverage for both batch and single event methods</li> <li>Tests cover all helper methods, edge cases, and error handling</li> </ul> <p>See: EventChatterPostHelper.cls</p>"},{"location":"automation/notify-subscribers-new-event/#future-enhancements","title":"\ud83d\ude80 Future Enhancements","text":"Feature Notes Reset Posted Flag Allow admins to reset <code>Chatter_Posted__c</code> to reprocess events if needed Multiple Schedule Times Run multiple times per day if needed (e.g., morning and evening) Service Account Integration Use dedicated service account (<code>sm-client@prolocity.com</code>) for consistent posting identity Email Notifications Add email notifications in addition to Chatter posts (Phase 2) Custom Message Templates Allow customization of message format per activity group Image Support Include event images in Chatter posts Multi-group Support Post to multiple groups if an event spans multiple activity types Engagement Analytics Track views, clicks, and comments on event posts Batch Size Configuration Allow configuration of batch size (currently 200)"},{"location":"automation/notify-subscribers-new-event/#related-documentation","title":"\ud83d\udcdd Related Documentation","text":"<ul> <li>Activity Group Event Notifications: Article explaining the feature and implementation</li> <li>Notify Leader on RSVP: Similar notification flow for event leaders</li> <li>Event Participant Redirect: Related solution for event participant functionality</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#scheduling-the-batch-job","title":"\ud83d\udcc5 Scheduling the Batch Job","text":"<p>To set up the scheduled batch job, run the following Apex script:</p> <p>Script: <code>scripts/apex/schedule_event_chatter_batch.apex</code></p> <p>This script:</p> <ol> <li>Checks for existing scheduled jobs and removes them</li> <li>Schedules the batch job to run daily at 5:00 AM Pacific Time</li> <li>Logs the job ID and next fire time</li> </ol> <p>Manual Scheduling (Alternative):</p> <ol> <li>Go to Setup \u2192 Apex Classes</li> <li>Find <code>EventChatterBatchPoster</code></li> <li>Click Schedule Apex</li> <li>Set schedule: Daily at 5:00 AM</li> <li>Save</li> </ol> <p>Verifying Schedule:</p> <ul> <li>Go to Setup \u2192 Scheduled Jobs</li> <li>Look for \"Event Chatter Batch Posting - Daily 5am\"</li> <li>Verify next fire time is correct</li> </ul>"},{"location":"automation/notify-subscribers-new-event/#technical-details","title":"\ud83d\udee0 Technical Details","text":"<ul> <li>API Version: 65.0</li> <li>Batch Class: EventChatterBatchPoster (implements Database.Batchable and Schedulable) <li>Schedule: Daily at 5:00 AM Pacific Time (Cron: <code>0 0 5 * * ?</code>)</li> <li>Batch Size: 200 records per batch execution</li> <li>Processing Logic: Processes any approved event where <code>Chatter_Posted__c != true</code> (no time window restriction)</li> <li>Bulk Support: Yes (handles large volumes efficiently via batch processing)</li> <li>Helper Class: EventChatterPostHelper.postBatchToChatterGroup</li> <li>Connect API: Uses ConnectApi.ChatterFeeds.postFeedElement for rich text posting</li> <li>Status: Active (scheduled job must be set up)</li>"},{"location":"automation/notify-subscribers-new-event/#support","title":"\ud83d\udcde Support","text":"<p>For issues or questions about this flow, contact the tech team at webdev@spokanemountaineers.org.</p>"},{"location":"automation/scheduled-add-members-to-conservation-group/","title":"\ud83d\udd04 Scheduled Flow: Add Members To Conservation Group","text":"<p>This scheduled Salesforce Flow ensures that all eligible site users (Community Users) are members of the Conservation Chatter Group, and logs each action for auditing.</p>"},{"location":"automation/scheduled-add-members-to-conservation-group/#access","title":"Access","text":"<ul> <li>Flow: Scheduled: Add Members To Conservation Group</li> <li>Logs: Conservation Group Membership Logs</li> <li>GitHub: Scheduled_Add_Members_To_Conservation_Group.flow-meta.xml</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#schedule","title":"\ud83d\udcc6 Schedule","text":"<ul> <li>Runs Once at 04:30 AM Pacific</li> <li>Type: Scheduled Flow</li> <li>Trigger: Platform-Scheduled, not user-initiated</li> </ul> <p>Note: This flow has been deactivated to ensure members who Opt Out of the Conservation group are not put back into teh group the next day.</p>"},{"location":"automation/scheduled-add-members-to-conservation-group/#purpose","title":"\ud83c\udfaf Purpose","text":"<p>This Flow:</p> <ul> <li>Adds eligible users (active site users) to a specific Chatter Group (CollaborationGroup).</li> <li>Skips users who are already members of the group.</li> <li>Logs each operation (only added) into the <code>Conservation_Group_Membership_Log__c</code> object.   Can be viewed here: Conservation Group Membership Logs</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#criteria-for-eligible-users","title":"\ud83d\udccb Criteria for Eligible Users","text":"<p>The flow targets active Community users, defined as:</p> <pre><code>User.IsActive = true\nAND (\n  User.UserType = 'Customer Portal User' OR\n  User.UserType = 'PowerCustomerSuccess' OR\n  User.UserType = 'PowerPartner'\n)\n</code></pre> <p>These users are queried via a Get Records element labeled Get_User_Records.</p>"},{"location":"automation/scheduled-add-members-to-conservation-group/#flow-structure","title":"\ud83e\uddf1 Flow Structure","text":""},{"location":"automation/scheduled-add-members-to-conservation-group/#1-get-existing-group-memberships","title":"1. Get Existing Group Memberships","text":"<ul> <li>Retrieves all CollaborationGroupMember records for the Conservation Group.</li> <li>Group ID is hardcoded as: 0F91N000000m2jESAQ.</li> </ul> <p>\u28002. Get Active Community Users</p> <ul> <li>Loads active site users matching the criteria above.</li> </ul> <p>\u28003. Loop Through Each User</p> <ul> <li>For each user:<ul> <li>Filters existing memberships to check if the user is already in the group.</li> <li>Uses a Decision node (Member in Group?) to branch:</li> </ul> </li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#decision-logic","title":"\ud83e\udd16 Decision Logic","text":""},{"location":"automation/scheduled-add-members-to-conservation-group/#if-the-user-is-not-already-a-group-member","title":"\u274c If the user is not already a group member","text":"<ul> <li>Assigns:<ul> <li>CollaborationGroupId = 0F91N000000m2jESAQ</li> <li>MemberId = User.Id</li> <li>CollaborationRole = Standard</li> </ul> </li> <li>Adds the new member record to a collection for batch creation.</li> <li>Logs the action with:<ul> <li>Message__c = \"Added To Conservation Group\"</li> </ul> </li> </ul> <p>\u2800\u2705 If the user is already a member:</p> <ul> <li>Loops through their existing CollaborationGroupMember record(s)</li> <li>Logs the status:<ul> <li>Message__c = \"Already a Member\"</li> </ul> </li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#record-creation","title":"\ud83d\udce6 Record Creation","text":"<p>At the end of all processing:</p> <ul> <li>The flow bulk-creates all new CollaborationGroupMember records.</li> <li>It also bulk-creates all Conservation_Group_Membership_Log__c log entries.</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#key-variables-and-resources","title":"\ud83d\udee0 Key Variables and Resources","text":"Variable Name Type Description <code>variable_collaboration_group_members</code> Collection of CollaborationGroupMember Holds new group members to create <code>variable_conservation_group_logs</code> Collection of Conservation_Group_Membership_Log__c Holds logs for both added and skipped users <code>variable_collaboration_group_member</code> Single CollaborationGroupMember Template record used per user <code>variable_conservation_log</code> Single Conservation_Group_Membership_Log__c Template log record used per user"},{"location":"automation/scheduled-add-members-to-conservation-group/#logging-details","title":"\ud83e\uddfe Logging Details","text":"<p>Each log record stores:</p> <ul> <li>User_ID__c</li> <li>Username__c</li> <li>Email__c</li> <li>Group_Member_Id__c</li> <li>Role__c</li> <li>Updated_At__c (timestamp)</li> <li>Message__c: either \"Added To Conservation Group\" or \"Already a Member\"</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#edge-cases-handled","title":"\u26a0\ufe0f Edge Cases Handled","text":"<ul> <li>Users not in the group are added and logged.</li> <li>Users already in the group are skipped.</li> <li>The Chatter Group ID is hardcoded to prevent accidental misrouting.</li> <li>Only users who are eligible site users are processed.</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#monitoring-auditing","title":"\ud83d\udcc8 Monitoring &amp; Auditing","text":"<p>Admins can monitor execution by:</p> <ul> <li>Querying the Conservation_Group_Membership_Log__c object</li> <li>Filtering by <code>Updated_At__c</code> or <code>Message__c</code></li> <li>Verifying membership through CollaborationGroupMember records</li> </ul>"},{"location":"automation/scheduled-add-members-to-conservation-group/#future-enhancements","title":"\ud83d\ude80 Future Enhancements","text":"Feature Notes Dynamic Group Selection Use custom metadata or Flow input variables instead of hardcoding Group ID Error Handling Add fault paths to log or notify errors during record creation Notification Email Optionally email a summary of actions after each run"},{"location":"google-workspace/","title":"Google Workspace Documentation","text":"<p>This section covers configuration and automation related to Google Workspace for Spokane Mountaineers.</p> <p>It includes tools and practices that ensure secure, consistent management of user accounts, directory information, and integrations with external systems like Salesforce.</p>"},{"location":"google-workspace/#subsections","title":"\ud83d\udcc2 Subsections","text":""},{"location":"google-workspace/#directory-customization","title":"\ud83d\udcca Directory Customization","text":"<ul> <li>Querying Custom Schema: Mountaineers.PublicEmail: How to access and export public-facing email addresses for communication lists.</li> </ul>"},{"location":"google-workspace/#tools","title":"\ud83d\udd27 Tools","text":"<ul> <li>GAM: Command-line tool to interact with Google Workspace Admin SDK.</li> <li>Admin SDK Directory API: REST API for programmatically managing user accounts and attributes.</li> </ul> <p>For access requests or contributions, contact the Web Dev team at <code>webdev@spokanemountaineers.org</code>.</p>"},{"location":"google-workspace/querying-custom-user-schema/","title":"Querying Custom Schema: Mountaineers.PublicEmail","text":"<p>This document explains how to access and query the custom schema field <code>Mountaineers.PublicEmail</code> that is populated by the user sync script.</p>"},{"location":"google-workspace/querying-custom-user-schema/#schema-definition","title":"\ud83e\udde9 Schema Definition","text":"Schema Name Field Name Type Description <code>Mountaineers</code> <code>PublicEmail</code> String Public-facing email for mailing lists <p>This field is stored under the <code>customSchemas</code> object in each user's Google Workspace profile. Example JSON structure:</p> <pre><code>\"customSchemas\": {\n  \"Mountaineers\": {\n    \"PublicEmail\": \"public-facing@example.com\"\n  }\n}\n</code></pre>"},{"location":"google-workspace/querying-custom-user-schema/#query-via-admin-sdk","title":"\ud83d\udd0d Query via Admin SDK","text":"<p>Use the Directory API <code>users.list</code> endpoint with <code>projection=full</code>:</p> <pre><code>GET https://admin.googleapis.com/admin/directory/v1/users?customer=my_customer&amp;orgUnitPath=/IdP%20Users%20Only&amp;projection=full\n</code></pre> <p>Parse each user's schema:</p> <pre><code>user.customSchemas?.Mountaineers?.PublicEmail\n</code></pre> <p>Reference: Admin SDK Directory API - Users: list</p>"},{"location":"google-workspace/querying-custom-user-schema/#query-via-gam-cli","title":"\ud83e\uddf0 Query via GAM CLI","text":""},{"location":"google-workspace/querying-custom-user-schema/#show-for-a-single-user","title":"Show for a single user:","text":"<pre><code>gam users show &lt;user@example.com&gt; fields customSchemas\n</code></pre>"},{"location":"google-workspace/querying-custom-user-schema/#export-for-all-users-in-ou","title":"Export for all users in OU:","text":"<pre><code>gam print users query \"orgUnitPath='/IdP Users Only'\" \\\n  fields primaryEmail,customSchemas.Mountaineers.PublicEmail \\\n  &gt; mountaineers-emails.csv\n</code></pre> <p>This enables easy generation of mailing lists based on public-facing emails independent of Google usernames.</p>"},{"location":"how-to-guides/","title":"How-To Guides","text":"<p>Welcome to the How-To Guides section of the Spokane Mountaineers documentation site. These guides are designed to walk you through common tasks, administrative processes, and website management tools that keep our organization running smoothly.</p> <p>Whether you're a club admin, event leader, or website contributor, this is your go-to spot for practical step-by-step instructions.</p>"},{"location":"how-to-guides/#available-guides","title":"\ud83d\udcd8 Available Guides","text":"<ul> <li>KeepAlive Sessions: Prevent users from being logged out too quickly.</li> <li>Update Experience Cloud Favicon: Customize the browser tab icon for our public Salesforce site.</li> <li>Website Editing</li> <li>Bulk Delete Events in Salesforce: Safely identify and bulk delete unwanted Event records in Salesforce.</li> <li>Salesforce Development Console Cheatsheet: A quick reference for using the Salesforce Developer Console, including common tasks and useful tips.</li> <li>Setup Staging Sandbox: Set up a staging sandbox with Activity Group pages, Chatter groups, and test data for Experience Builder.</li> </ul> <p>More guides coming soon!</p> <p>\ud83d\udee0 Have a task you'd like documented? Open a GitHub issue or contribute a page.</p>"},{"location":"how-to-guides/bulk-delete-events-in-salesforce/","title":"How To: Bulk Delete Events in Salesforce","text":"<p>When a user accidentally creates a large number of recurring Events (e.g., hundreds of records), manually deleting them one by one is not practical. This guide shows how to identify and bulk delete Events safely using Salesforce tools.</p>"},{"location":"how-to-guides/bulk-delete-events-in-salesforce/#delete-events-using-developer-console-soql-query","title":"Delete Events Using Developer Console (SOQL Query)","text":"<ol> <li> <p>Open the Developer Console</p> <ul> <li>In Salesforce, click the \u2699\ufe0f (Setup gear) in the top right.</li> <li>Select Developer Console.</li> </ul> <p></p> </li> <li> <p>Open the Query Editor</p> <ul> <li>In the Developer Console, go to the bottom panel \u2192 Query Editor tab.</li> </ul> <p></p> </li> <li> <p>Run a SOQL Query to Identify Records</p> <ul> <li>Example query:     <pre><code>SELECT Id, Subject, ActivityDate, CreatedById\nFROM Event\nWHERE Subject LIKE '%%Bad Event Subject%%'\n</code></pre></li> <li>Replacing <code>%%Bad Event Subject%%</code> with the actual subject or criteria of the unwanted Events.</li> <li>Add filters such as <code>Subject LIKE '%Meeting%'</code> or <code>ActivityDate &gt;= 2025-09-01</code> to narrow results.</li> </ul> </li> <li> <p>Review the Results</p> <ul> <li>Confirm you\u2019re only pulling the unwanted Events.</li> <li>Export results if you want a record for audit.</li> </ul> </li> <li> <p>Delete the Records</p> <ul> <li>Copy the list of Ids and use Data Loader or Workbench (see below) to bulk delete.</li> <li>Alternatively, use Execute Anonymous with Apex (advanced).   </li> </ul> </li> </ol>"},{"location":"how-to-guides/bulk-delete-events-in-salesforce/#optional-delete-in-the-event-registration-table","title":"Optional: Delete In The Event Registration Table","text":"<p>If the event has not yet been approved then it will be in the Event Registration table. You can and sholud delete it from there as well.</p> <ol> <li> <p>Open the Developer Console</p> <ul> <li>In Salesforce, click the \u2699\ufe0f (Setup gear) in the top right.</li> <li>Select Developer Console.</li> </ul> <p></p> </li> <li> <p>Open the Query Editor</p> <ul> <li>In the Developer Console, go to the bottom panel \u2192 Query Editor tab.   </li> </ul> </li> <li> <p>Run a SOQL Query to Identify Records</p> <ul> <li>Example query:     <pre><code>SELECT ID, Status__c, Start__c, Name\nFROM Event_Registration__c\nWHERE Name LIKE '%%Evening Hike at James T Slavin%%'\n</code></pre></li> <li>Replacing <code>%%Evening Hike at James T Slavin%%</code> with the actual subject or criteria of the unwanted Events.</li> <li>Add filters such as <code>Name LIKE '%Meeting%'</code> or <code>Start__c &gt;= 2025-09-01</code> to narrow results.</li> </ul> </li> <li>Review the Results<ul> <li>Confirm you\u2019re only pulling the unwanted Event Registrations.</li> <li>Export results if you want a record for audit.</li> </ul> </li> <li>Delete the Records<ul> <li>Select the records you want to delete, then cick the Delete Row button.   </li> </ul> </li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/","title":"Configure Custom Login Page for Experience Cloud","text":"<p>This guide walks through deploying and configuring the custom login page with modern UI and <code>.smi</code> username normalization.</p>"},{"location":"how-to-guides/configure-custom-login-page/#overview","title":"Overview","text":"<p>The custom login page provides:</p> <ul> <li>Modern, responsive UI design</li> <li>Loading spinner during authentication</li> <li>Password visibility toggle</li> <li>Alpine.js-powered interactivity</li> <li>Automatic <code>.smi</code> suffix stripping for backward compatibility</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#prerequisites","title":"Prerequisites","text":"<ul> <li>Salesforce CLI installed</li> <li>Access to the target org (Staging or Production)</li> <li>Admin permissions to configure Experience Cloud site</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#component-overview","title":"Component Overview","text":""},{"location":"how-to-guides/configure-custom-login-page/#files-created","title":"Files Created","text":"<ol> <li>CommunitiesLoginController.cls - Apex controller handling login logic</li> <li>CommunitiesLoginControllerTest.cls - Test class with 100% coverage</li> <li>CommunitiesLogin.page - Visualforce page with modern UI</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#key-features","title":"Key Features","text":""},{"location":"how-to-guides/configure-custom-login-page/#username-normalization","title":"Username Normalization","text":"<p>The controller automatically strips the <code>.smi</code> suffix from usernames:</p> <ul> <li>User enters: <code>user@example.com.smi</code></li> <li>System processes: <code>user@example.com</code></li> <li>Supports legacy user habits after migration</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#modern-ui-components","title":"Modern UI Components","text":"<ul> <li>Loading State: Spinner appears during login, button disabled</li> <li>Password Toggle: Eye icon to show/hide password</li> <li>Google OAuth: Styled button for Google sign-in</li> <li>Responsive: Works on mobile, tablet, and desktop</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#deployment-steps","title":"Deployment Steps","text":""},{"location":"how-to-guides/configure-custom-login-page/#1-deploy-to-sandbox-staging","title":"1. Deploy to Sandbox (Staging)","text":"<p>First, always test in staging before production:</p> <pre><code># Make sure you're on the feature branch\ngit checkout feature/custom-login-page\n\n# Deploy to staging sandbox\nsf project deploy start \\\n  --source-dir force-app/main/default/classes/CommunitiesLoginController.cls \\\n  --source-dir force-app/main/default/classes/CommunitiesLoginControllerTest.cls \\\n  --source-dir force-app/main/default/pages/CommunitiesLogin.page \\\n  --target-org staging \\\n  --test-level RunLocalTests\n\n# Or deploy all changes at once\nsf project deploy start \\\n  --source-dir force-app/main/default \\\n  --target-org staging \\\n  --test-level RunLocalTests\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#2-run-tests-in-staging","title":"2. Run Tests in Staging","text":"<p>Verify all tests pass:</p> <pre><code># Run specific test class\nsf apex run test \\\n  --class-names CommunitiesLoginControllerTest \\\n  --target-org staging \\\n  --result-format human \\\n  --code-coverage\n\n# Verify 75%+ org-wide coverage\nsf apex get test \\\n  --code-coverage \\\n  --result-format human \\\n  --target-org staging\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#3-configure-staging-experience-cloud-site","title":"3. Configure Staging Experience Cloud Site","text":""},{"location":"how-to-guides/configure-custom-login-page/#step-by-step-configuration","title":"Step-by-Step Configuration","text":"<ol> <li> <p>Navigate to Digital Experiences</p> <ul> <li>Setup \u2192 Digital Experiences \u2192 All Sites</li> <li>Click Builder next to your site</li> <li>Or click Administration</li> </ul> </li> <li> <p>Access Login &amp; Registration Settings</p> <ul> <li>In Builder: Click \u2699\ufe0f (Settings) \u2192 Login &amp; Registration</li> <li>Or in Administration: Click Login &amp; Registration</li> </ul> </li> <li> <p>Configure Login Page</p> <ul> <li>Under Login Page, select Change Login Page</li> <li>Choose Visualforce Page</li> <li>Select <code>CommunitiesLogin</code> from dropdown</li> <li>Click OK</li> </ul> </li> <li> <p>Configure Google OAuth (if using)</p> <ul> <li>Verify Auth Provider is configured: Setup \u2192 Auth. Providers</li> <li>Ensure Google provider is active and configured</li> </ul> </li> <li> <p>Save and Publish</p> <ul> <li>Click Save in the Settings modal</li> <li>Click Publish in the Builder to make changes live</li> </ul> </li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#alternative-configure-via-setup","title":"Alternative: Configure via Setup","text":"<p>If you prefer Setup over Builder:</p> <ol> <li>Setup \u2192 Digital Experiences \u2192 All Sites</li> <li>Click dropdown next to site \u2192 Administration</li> <li>Under Settings, click Login &amp; Registration</li> <li>Follow steps 3-5 above</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#4-test-in-staging","title":"4. Test in Staging","text":""},{"location":"how-to-guides/configure-custom-login-page/#test-scenarios","title":"Test Scenarios","text":"<p>Test with .smi suffix:</p> <pre><code>Username: testuser@example.com.smi\nPassword: YourPassword123\nExpected: Login succeeds, .smi stripped automatically\n</code></pre> <p>Test without .smi suffix:</p> <pre><code>Username: testuser@example.com\nPassword: YourPassword123\nExpected: Login succeeds as normal\n</code></pre> <p>Test Google OAuth:</p> <ol> <li>Click \"Continue with Google\" button</li> <li>Authenticate with Google</li> <li>Verify redirect to startURL</li> </ol> <p>Test Password Toggle:</p> <ol> <li>Enter password</li> <li>Click eye icon</li> <li>Verify password becomes visible</li> <li>Click eye icon again</li> <li>Verify password hidden</li> </ol> <p>Test Loading State:</p> <ol> <li>Enter credentials</li> <li>Click \"Sign In\"</li> <li>Verify spinner appears and button shows \"Signing in...\"</li> <li>Verify button is disabled during processing</li> </ol> <p>Test Mobile Responsiveness:</p> <ol> <li>Open site on mobile device or use browser dev tools</li> <li>Verify layout adapts to smaller screen</li> <li>Test all features work on mobile</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#5-validation-checklist","title":"5. Validation Checklist","text":"<p>Before deploying to production, verify:</p> <ul> <li> All unit tests pass (75%+ coverage)</li> <li> Login works with <code>.smi</code> suffix</li> <li> Login works without <code>.smi</code> suffix</li> <li> Google OAuth login works</li> <li> Forgot password link works</li> <li> Sign up link works</li> <li> Renew link works</li> <li> Password toggle works</li> <li> Loading spinner appears</li> <li> Error messages display properly</li> <li> Mobile responsive design works</li> <li> No console errors in browser</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#deploy-to-production","title":"Deploy to Production","text":"<p>Once staging validation is complete:</p> <pre><code># Deploy to production\nsf project deploy start \\\n  --source-dir force-app/main/default/classes/CommunitiesLoginController.cls \\\n  --source-dir force-app/main/default/classes/CommunitiesLoginControllerTest.cls \\\n  --source-dir force-app/main/default/pages/CommunitiesLogin.page \\\n  --target-org production \\\n  --test-level RunLocalTests\n\n# Run tests\nsf apex run test \\\n  --class-names CommunitiesLoginControllerTest \\\n  --target-org production \\\n  --result-format human \\\n  --code-coverage\n</code></pre> <p>Follow the same configuration steps as staging (Section 3).</p>"},{"location":"how-to-guides/configure-custom-login-page/#customization-options","title":"Customization Options","text":""},{"location":"how-to-guides/configure-custom-login-page/#change-colors","title":"Change Colors","text":"<p>Edit the CSS in <code>CommunitiesLogin.page</code>:</p> <pre><code>/* Change gradient background */\nbackground: linear-gradient(135deg, #YOUR_COLOR1 0%, #YOUR_COLOR2 100%);\n\n/* Change button colors */\n.btn-primary {\n    background: linear-gradient(135deg, #YOUR_COLOR1 0%, #YOUR_COLOR2 100%);\n}\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#change-logo","title":"Change Logo","text":"<p>Replace the SVG logo in the page with your image:</p> <pre><code>&lt;!-- Replace the SVG with an image tag --&gt;\n&lt;img src=\"{!$Resource.YourLogoResource}\" alt=\"Your Organization\" class=\"logo\" /&gt;\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#add-custom-labels","title":"Add Custom Labels","text":"<p>Custom labels have been created for commonly changing URLs and email addresses.</p> <p>Available Custom Labels</p> Label Name Value Description <code>Community_Join_URL</code> <code>https://donorbox.org/spokane-mountaineers-membership-2</code> URL for new member registration/join <code>Community_Renew_URL</code> <code>https://donorbox.org/spokane-mountaineers-membership</code> URL for membership renewal <code>Community_Support_Email</code> <code>membership@spokanemountaineers.org</code> Support email address for member questions <p>To modify these values:</p> <ol> <li>Setup \u2192 Custom Labels</li> <li>Find the label by name</li> <li>Click Edit</li> <li>Update the Value field</li> <li>Click Save</li> </ol> <p>Changes take effect immediately without code deployment.</p>"},{"location":"how-to-guides/configure-custom-login-page/#modify-session-duration","title":"Modify Session Duration","text":"<p>Salesforce session duration is controlled by session settings:</p> <ol> <li>Setup \u2192 Session Settings</li> <li>Configure Session Timeout value</li> <li>This controls how long sessions persist</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#troubleshooting","title":"Troubleshooting","text":""},{"location":"how-to-guides/configure-custom-login-page/#issue-login-fails-with-invalid-username-or-password","title":"Issue: Login fails with \"Invalid username or password\"","text":"<p>Possible Causes:</p> <ol> <li>Username normalization not working</li> <li>User doesn't exist in database</li> <li>Incorrect password</li> </ol> <p>Resolution:</p> <ol> <li>Check debug logs in Developer Console</li> <li>Verify <code>normalizeUsername()</code> is stripping <code>.smi</code></li> <li>Query User object: <code>SELECT Id, Username FROM User WHERE Email = 'user@example.com'</code></li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#issue-google-oauth-button-doesnt-work","title":"Issue: Google OAuth button doesn't work","text":"<p>Possible Causes:</p> <ol> <li>Auth Provider not configured</li> <li>Google OAuth credentials invalid</li> <li>Callback URL mismatch</li> </ol> <p>Resolution:</p> <ol> <li>Setup \u2192 Auth. Providers \u2192 Google</li> <li>Verify Client ID and Client Secret</li> <li>Check Callback URL matches Google Console</li> <li>Test URL format: <code>/services/auth/sso/Google</code></li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#issue-page-styles-not-loading","title":"Issue: Page styles not loading","text":"<p>Possible Causes:</p> <ol> <li>CDN blocked (Alpine.js)</li> <li>CSS not rendering</li> <li>Browser caching</li> </ol> <p>Resolution:</p> <ol> <li>Check browser console for errors</li> <li>Verify network can reach CDN: <code>https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js</code></li> <li>Clear browser cache</li> <li>Test in incognito mode</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#issue-password-toggle-not-working","title":"Issue: Password toggle not working","text":"<p>Possible Causes:</p> <ol> <li>JavaScript error</li> <li>Input type binding issue</li> </ol> <p>Resolution:</p> <ol> <li>Check browser console for errors</li> <li>Verify password field ID is correct</li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#issue-forgot-password-routing-with-visualforce-pages","title":"Issue: Forgot Password routing with Visualforce pages","text":"<p>Known Platform Limitation:</p> <p>Experience Cloud's Login &amp; Registration settings don't reliably override authentication routes (<code>/ForgotPassword</code>) when using Visualforce pages. This is a known Salesforce platform limitation where hardcoded authentication servlet routes don't respect Experience Builder configuration for Visualforce pages.</p> <p>Current Implementation:</p> <p>The <code>CommunitiesLoginController.getForgotPasswordUrl()</code> method uses the direct Visualforce page path (<code>/CommunitiesForgotPassword</code>) instead of the generic route (<code>/ForgotPassword</code>). This ensures users always see the custom branded forgot password page.</p> <p>Alternative Solutions (if needed in the future):</p> <ul> <li>Convert to Lightning Web Component (LWC) - Experience Builder routing works properly with Lightning components</li> <li>Use the direct URL pattern as the canonical approach for authentication flows</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#testing-commands","title":"Testing Commands","text":""},{"location":"how-to-guides/configure-custom-login-page/#run-all-tests","title":"Run All Tests","text":"<pre><code># Run all Apex tests in org\nsf apex run test \\\n  --test-level RunLocalTests \\\n  --target-org staging \\\n  --result-format human \\\n  --code-coverage \\\n  --wait 30\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#run-specific-test-class","title":"Run Specific Test Class","text":"<pre><code>sf apex run test \\\n  --class-names CommunitiesLoginControllerTest \\\n  --target-org staging \\\n  --result-format human \\\n  --code-coverage\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#check-code-coverage","title":"Check Code Coverage","text":"<pre><code>sf apex get test \\\n  --code-coverage \\\n  --target-org staging \\\n  --result-format human\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#view-debug-logs","title":"View Debug Logs","text":"<pre><code># Get recent logs\nsf apex list log --target-org staging\n\n# Download specific log\nsf apex get log --log-id YOUR_LOG_ID --target-org staging\n</code></pre>"},{"location":"how-to-guides/configure-custom-login-page/#rollback-procedure","title":"Rollback Procedure","text":"<p>If issues occur in production:</p> <ol> <li> <p>Revert to Standard Login Page</p> <ul> <li>Setup \u2192 Digital Experiences \u2192 All Sites</li> <li>Click Administration \u2192 Login &amp; Registration</li> <li>Change Login Page back to \"Default\"</li> <li>Click Save and Publish</li> </ul> </li> <li> <p>Users Can Still Login</p> <ul> <li>Standard Salesforce login page will be used</li> <li><code>.smi</code> normalization won't work (users must use exact username)</li> </ul> </li> <li> <p>Fix Issues and Redeploy</p> <ul> <li>Address the issue in staging</li> <li>Test thoroughly</li> <li>Redeploy to production when ready</li> </ul> </li> </ol>"},{"location":"how-to-guides/configure-custom-login-page/#support","title":"Support","text":"<p>For questions or issues:</p> <ul> <li>Email: info@spokanemountaineers.org</li> <li>GitHub: Create an issue in the repository</li> <li>Slack: #tech-support channel</li> </ul>"},{"location":"how-to-guides/configure-custom-login-page/#related-documentation","title":"Related Documentation","text":"<ul> <li>Username Migration Plan</li> <li>Google OAuth Setup</li> <li>Experience Cloud Configuration</li> </ul>"},{"location":"how-to-guides/keepalive-sessions/","title":"KeepAlive Sessions in Salesforce Experience Cloud","text":"<p>This page documents how we implemented a session keep-alive strategy for our Salesforce Experience Cloud site, and how to maintain it over time.</p>"},{"location":"how-to-guides/keepalive-sessions/#testing-results","title":"Testing Results","text":"<p>This method has been tested but does not resolve the issue of users being logged out prematurely. Further investigation and alternative solutions may be required.</p>"},{"location":"how-to-guides/keepalive-sessions/#why-we-did-this","title":"Why We Did This","text":"<p>By default, users are logged out of our Experience Cloud site after 24 hours of inactivity. We wanted to improve the user experience by reducing the frequency of session timeouts, especially for members who leave a tab open for long periods.</p>"},{"location":"how-to-guides/keepalive-sessions/#how-it-works","title":"How It Works","text":"<p>We created a lightweight Aura component called <code>keepAlive</code>, which silently pings a no-op Apex method (<code>KeepAliveController.ping()</code>) every 10 minutes. This keeps the user session active as long as the tab remains open.</p> <ul> <li>Component Name: <code>keepAlive</code></li> <li>Apex Controller: <code>KeepAliveController</code></li> <li>Ping Interval: 10 minutes</li> <li>Location: The component is added to the site's shared header layout to ensure it runs on all pages.</li> </ul>"},{"location":"how-to-guides/keepalive-sessions/#how-we-built-it","title":"How We Built It","text":"<ol> <li> <p>Created Apex Class: <code>KeepAliveController</code></p> <ul> <li>Public, static, and marked <code>@AuraEnabled</code></li> <li>Contains an empty <code>ping()</code> method</li> </ul> </li> <li> <p>Created Aura Component: <code>keepAlive</code></p> <ul> <li>On page load, starts a JS <code>setInterval</code> timer that calls <code>KeepAliveController.ping()</code> every 10 minutes</li> <li>Logs results to the browser console for debugging</li> </ul> </li> <li> <p>Added the component to the site header in Experience Builder</p> <ul> <li>Ensures it loads on every page without duplicating it per page</li> </ul> </li> <li> <p>Tested in browser using DevTools (Console + Network tabs)</p> </li> </ol>"},{"location":"how-to-guides/keepalive-sessions/#maintaining-apex-class-access","title":"Maintaining Apex Class Access","text":"<p>If new user profiles are added, or users report seeing this error in the Development Tools Console:</p> <p><code>\"You do not have access to the Apex class named 'KeepAliveController'\"</code></p> <p>\u2026then you need to grant access to the Apex class. Here's how:</p>"},{"location":"how-to-guides/keepalive-sessions/#steps-to-update-profile-apex-class-access","title":"\ud83d\udd27 Steps to Update Profile &gt; Apex Class Access","text":"<ol> <li>Go to Setup &gt; Profiles</li> <li>Find and click on the profile name (e.g. <code>SM Community Plus Member</code>)</li> <li>Scroll down to Apex Class Access</li> <li>Click Edit</li> <li>Move <code>KeepAliveController</code> from the Available list to the Enabled list</li> <li>Click Save</li> </ol>"},{"location":"how-to-guides/keepalive-sessions/#verifying-its-working","title":"Verifying It's Working","text":"<ol> <li>Open the browser's DevTools &gt; Console</li> <li>Look for log messages like: <code>[KeepAlive] Pinging server to keep session alive\u2026 [KeepAlive] Ping response: SUCCESS</code></li> <li>Visit Setup &gt; Session Management to view real-time session activity</li> </ol>"},{"location":"how-to-guides/keepalive-sessions/#contact","title":"Contact","text":"<p>If you're troubleshooting this feature or extending it, contact webdev@spokanemountaineers.org or check the source code in our GitHub repository.</p>"},{"location":"how-to-guides/salesforce-development-console-cheatsheet/","title":"Salesforce Development Console Cheatsheet","text":"<p>This page is a quick reference for using the Salesforce Developer Console, including common tasks and useful tips.</p>"},{"location":"how-to-guides/salesforce-development-console-cheatsheet/#frequently-used-queries","title":"Frequently Used Queries","text":"<ul> <li>List all standard and custom objects:     <pre><code>SELECT QualifiedApiName\nFROM EntityDefinition\nORDER BY QualifiedApiName\n</code></pre></li> </ul>"},{"location":"how-to-guides/salesforce-development-console-cheatsheet/#frequently-used-commands","title":"Frequently Used Commands","text":"<ul> <li>List all fields related to a specific object using <code>sf</code> <pre><code>sf force:schema:sobject:describe -s Event_Participant__c | jq -r .fields[].name\n</code></pre></li> </ul>"},{"location":"how-to-guides/setup-staging-sandbox/","title":"Setting Up Staging Sandbox for Experience Builder","text":"<p>This guide walks through setting up a staging sandbox to match your production Experience Cloud site configuration, including Activity Group pages and Managed Content folders.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#overview","title":"\ud83c\udfaf Overview","text":"<p>When setting up a new sandbox, you may encounter errors in Experience Builder such as:</p> <ul> <li>\"The Managed Content Folder Definition, Activity_Groups, is not valid.\"</li> <li>\"We can't load the  component because it's not supported by any data.\" <p>This guide helps you resolve these issues by setting up the necessary components and data.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#prerequisites","title":"\ud83d\udccb Prerequisites","text":"<ul> <li>Access to your staging sandbox</li> <li>System Administrator permissions</li> <li>Experience Cloud site already created (or cloned from production)</li> </ul>"},{"location":"how-to-guides/setup-staging-sandbox/#step-1-create-activity-group-chatter-groups","title":"\ud83d\udd27 Step 1: Create Activity Group Chatter Groups","text":"<p>The EventChatterPostHelper requires Chatter groups with names matching your activity groups. Create these manually in Salesforce.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#required-activity-groups","title":"Required Activity Groups","text":"<p>Create public Chatter groups for:</p> <ul> <li>Hiking</li> <li>Climbing</li> <li>Backpacking</li> <li>Skiing</li> <li>Mountaineering</li> <li>Cycling</li> </ul> <p>Plus any additional activity groups used in your <code>Event_Registration__c</code> records.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#creating-groups-manually","title":"Creating Groups Manually","text":"<ol> <li>Navigate to Chatter \u2192 Groups</li> <li>Click New Group</li> <li>Enter the activity group name (e.g., \"Hiking\")</li> <li>Set Access Type to Public</li> <li>Click Save</li> <li>Repeat for each activity group</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#verify-groups-were-created","title":"Verify Groups Were Created","text":"<ol> <li>Navigate to Chatter in your org</li> <li>Click Groups in the left sidebar</li> <li>Verify each activity group appears as a public Chatter group</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#troubleshooting-flow-error-when-creating-groups","title":"\u26a0 Troubleshooting: Flow Error When Creating Groups","text":"<p>If you see errors like:</p> <pre><code>\"We can't save this record because the 'Add Chatter Service To New Groups' process failed\"\n\"INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY\"\n</code></pre> <p>This means the \"Add Chatter Service To New Groups\" flow is trying to automatically add the service account (<code>sm-client@prolocity.com</code>) to new groups, but it's failing because:</p> <ol> <li>The service account doesn't exist in staging, OR</li> <li>The service account exists but isn't a member of the Experience Cloud site (for site-specific groups)</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#solution-options","title":"Solution Options","text":"<p>Option 1: Ensure Service Account Exists (Recommended)</p> <ol> <li>Verify the user <code>sm-client@prolocity.com</code> exists and is active in your staging org</li> <li>Add the user to your Experience Cloud site (if groups are site-specific)</li> <li>Use <code>scripts/apex/add_sm_client_to_all_chatter_groups.apex</code> to add the user to existing groups</li> </ol> <p>Option 2: Temporarily Deactivate the Flow</p> <ol> <li>Go to Setup \u2192 Flows</li> <li>Find \"Add Chatter Service To New Groups\"</li> <li>Click Deactivate</li> <li>Create the groups manually</li> <li>After groups are created, reactivate the flow</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#step-2-create-managed-content-folder","title":"\ud83d\udcc1 Step 2: Create Managed Content Folder","text":"<p>Managed Content folders are created through the Experience Builder UI and cannot be deployed via metadata.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#manual-creation-steps","title":"Manual Creation Steps","text":"<ol> <li>Navigate to Setup \u2192 Digital Experiences \u2192 All Sites</li> <li>Click Builder next to your Experience Cloud site</li> <li>In Experience Builder, click the Settings gear icon (top right)</li> <li>Select Content from the settings menu</li> <li>Click New Folder or Manage Folders</li> <li>Create a new folder with:<ul> <li>Name: <code>Activity_Groups</code></li> <li>Type: Managed Content Folder</li> </ul> </li> <li>Save the folder</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#alternative-check-production-setup","title":"Alternative: Check Production Setup","text":"<p>If you have access to production, you can:</p> <ol> <li>Navigate to the same location in production</li> <li>Note the exact folder name and configuration</li> <li>Replicate it in staging</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#step-3-create-test-data","title":"\ud83d\udcca Step 3: Create Test Data","text":"<p>Experience Builder components need data to display. Create test events for each activity group.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#using-the-script","title":"Using the Script","text":"<ol> <li>Open Developer Console in your staging sandbox</li> <li>Go to Debug \u2192 Open Execute Anonymous Window</li> <li>Copy and paste the contents of <code>scripts/apex/create_test_events_by_activity_group.apex</code></li> <li>Check Open Log and click Execute</li> <li>Review the debug logs to confirm events were created</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#what-this-creates","title":"What This Creates","text":"<ul> <li>At least 3 approved events per activity group</li> <li>Events scheduled 7+ days in the future</li> <li>Events with <code>Chatter_Posted__c = false</code> (ready for batch processing)</li> </ul>"},{"location":"how-to-guides/setup-staging-sandbox/#verify-events-were-created","title":"Verify Events Were Created","text":"<ol> <li>Navigate to Event Registration tab (or object)</li> <li>Filter by <code>Status__c = 'Approved'</code></li> <li>Group by <code>Activity_Group__c</code> to see events per group</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#step-4-verify-experience-builder-pages","title":"\ud83e\udde9 Step 4: Verify Experience Builder Pages","text":"<p>After setting up the above, verify your Experience Builder pages load correctly.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#check-activity-group-pages","title":"Check Activity Group Pages","text":"<ol> <li>Navigate to Digital Experiences \u2192 All Sites \u2192 Builder</li> <li>Try navigating to each Activity Group page (e.g., \"Climbing\", \"Hiking\")</li> <li>Verify no errors appear</li> <li>Check that components display data correctly</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#common-issues-and-fixes","title":"Common Issues and Fixes","text":"Error Cause Solution \"Managed Content Folder Definition not valid\" Folder doesn't exist Create the folder in Step 2 \"Component not supported by any data\" No records match component filters Create test data in Step 3 \"Chatter group not found\" Chatter groups missing Run script in Step 1"},{"location":"how-to-guides/setup-staging-sandbox/#step-5-deploy-metadata-optional","title":"\ud83d\udd04 Step 5: Deploy Metadata (Optional)","text":"<p>If you need to deploy custom components, classes, or other metadata:</p> <pre><code># Deploy to staging\nsf project deploy start --target-org staging\n</code></pre> <p>Or use the Salesforce CLI to deploy specific components.</p>"},{"location":"how-to-guides/setup-staging-sandbox/#verification-checklist","title":"\u2705 Verification Checklist","text":"<ul> <li> Chatter groups created for all activity groups</li> <li> Managed Content folder \"Activity_Groups\" exists</li> <li> Test events created for each activity group</li> <li> Experience Builder pages load without errors</li> <li> Components display data correctly</li> <li> Navigation works between activity group pages</li> </ul>"},{"location":"how-to-guides/setup-staging-sandbox/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"how-to-guides/setup-staging-sandbox/#components-still-show-no-data-error","title":"Components Still Show \"No Data\" Error","text":"<ol> <li>Check component filters: Verify the component's SOQL/record filters match your test data</li> <li>Check field values: Ensure required fields are populated on test records</li> <li>Check permissions: Verify your user profile has access to the objects/fields</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#managed-content-folder-still-not-found","title":"Managed Content Folder Still Not Found","text":"<ol> <li>Verify exact name: Check for typos - it must match exactly (case-sensitive)</li> <li>Check folder type: Must be \"Managed Content Folder\", not \"Content Folder\"</li> <li>Refresh Experience Builder: Close and reopen the builder after creating the folder</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#chatter-groups-not-found-by-eventchatterposthelper","title":"Chatter Groups Not Found by EventChatterPostHelper","text":"<ol> <li>Verify group names: Group names must exactly match <code>Activity_Group__c</code> field values</li> <li>Check group type: Groups should be \"Public\" for visibility</li> <li>Check permissions: Ensure the running user has access to the groups</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#flow-preventing-group-creation","title":"Flow Preventing Group Creation","text":"<p>If groups fail to create due to the \"Add Chatter Service To New Groups\" flow:</p> <ol> <li>Check if service account exists: Query <code>SELECT Id, Username FROM User WHERE Username = 'sm-client@prolocity.com'</code></li> <li>Verify the service account is active and has proper permissions, OR</li> <li>Temporarily deactivate the flow (Setup \u2192 Flows \u2192 \"Add Chatter Service To New Groups\" \u2192 Deactivate)</li> </ol>"},{"location":"how-to-guides/setup-staging-sandbox/#related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Activity Group Event Notifications</li> <li>Event Chatter Batch Setup</li> <li>Website Editing Guide</li> </ul>"},{"location":"how-to-guides/setup-staging-sandbox/#tips","title":"\ud83d\udca1 Tips","text":"<ul> <li>Keep staging in sync: Regularly refresh test data to match production patterns</li> <li>Document customizations: Note any manual UI configurations that can't be deployed</li> <li>Test thoroughly: Verify all activity group pages work before deploying to production</li> </ul> <p>\u2728 Need help? Check the debug logs from the scripts for detailed information about what was created or any errors encountered.</p>"},{"location":"how-to-guides/update-experience-cloud-favicon/","title":"Updating the Favicon for an Experience Cloud Site","text":"<p>This guide shows how to update the favicon (<code>favicon.ico</code>) for a Salesforce Experience Cloud site when the site template does not support favicon branding through the standard Branding settings.</p>"},{"location":"how-to-guides/update-experience-cloud-favicon/#step-1-upload-the-favicon-as-a-static-resource","title":"Step 1: Upload the Favicon as a Static Resource","text":"<ol> <li>Navigate to Setup \u2192 Static Resources.</li> <li>Click New.</li> <li>Fill out the form:<ul> <li>Name: <code>favicon_ico</code></li> <li>File: Upload your <code>favicon.ico</code> file</li> <li>Cache Control: <code>Public</code></li> </ul> </li> <li>Save the static resource.</li> </ol> <p>\ud83d\udca1 Best format is a <code>.ico</code> file at 16x16 or 32x32 pixels.</p>"},{"location":"how-to-guides/update-experience-cloud-favicon/#step-2-add-a-reference-to-the-favicon-in-the-site-head","title":"Step 2: Add a Reference to the Favicon in the Site Head","text":"<ol> <li>Go to Setup \u2192 Digital Experiences \u2192 All Sites.</li> <li>Click Builder next to your site.</li> <li>In Experience Builder:<ul> <li>Click the gear icon (\u2699\ufe0f) in the top right.</li> <li>Go to Advanced \u2192 Edit Head Markup.</li> </ul> </li> <li> <p>Add the following HTML:</p> <pre><code>&lt;link rel=\"icon\" type=\"image/x-icon\" href=\"/resource/favicon_ico\" /&gt;\n</code></pre> <p>Replace FaviconICO with the name you gave your static resource if it differs.</p> </li> <li> <p>Click Done and Publish your site.</p> </li> </ol>"},{"location":"how-to-guides/update-experience-cloud-favicon/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>If the new favicon doesn't show up immediately:<ul> <li>Open the site in an incognito window.</li> <li>Clear your browser cache.</li> <li>Ensure the static resource is publicly accessible.</li> </ul> </li> </ul>"},{"location":"how-to-guides/update-experience-cloud-favicon/#example","title":"\u2705 Example","text":"<p>If your favicon file is named favicon.ico and uploaded as a static resource named FaviconICO, the browser will now use:</p> <pre><code>&lt;link rel=\"icon\" type=\"image/x-icon\" href=\"/resource/FaviconICO\" /&gt;\n</code></pre>"},{"location":"how-to-guides/update-experience-cloud-favicon/#why-this-is-needed","title":"\ud83d\udd01 Why This is Needed","text":"<p>Some Experience Cloud templates (e.g., Help Center, Customer Service) do not offer a \"Branding\" section in the settings UI. In those cases, the favicon must be manually added via the \\ section."},{"location":"how-to-guides/website-editing/","title":"Editing the Spokane Mountaineers Website","text":"<p>This guide walks through how to update content on the Spokane Mountaineers public website, including page editing, image management, and maintaining our Experience Cloud infrastructure.</p>"},{"location":"how-to-guides/website-editing/#admin-access","title":"\ud83d\udd10 Admin Access","text":"<p>To access administrative tools, log in at:</p> <p>\ud83d\udc49 https://spokanemountaineers.my.salesforce.com</p> <p>If you need credentials or access permissions, contact the tech team.</p>"},{"location":"how-to-guides/website-editing/#public-website","title":"\ud83c\udf10 Public Website","text":"<p>The public-facing site is hosted at:</p> <p>\ud83d\udc49 https://www.spokanemountaineers.org</p> <p>It is powered by Salesforce Experience Cloud (Aura framework) and managed using Experience Builder and Salesforce Setup.</p>"},{"location":"how-to-guides/website-editing/#helpful-salesforce-links","title":"\ud83e\udded Helpful Salesforce Links","text":"<p>Here are commonly used Salesforce admin tools:</p> Name Link Setup Home Setup Digital Experiences Experience Builder User Management Users <p>Bookmark these for easy access when managing site content or user permissions.</p>"},{"location":"how-to-guides/website-editing/#editing-pages-in-experience-builder","title":"\u270f\ufe0f Editing Pages in Experience Builder","text":"<ol> <li>Navigate to Digital Experiences.</li> <li>Click Builder next to the <code>Spokane Mountaineers</code> site.</li> <li>In Builder, you can:<ul> <li>Click on page sections to edit content</li> <li>Add or remove components from the layout</li> <li>Update navigation and metadata</li> </ul> </li> </ol>"},{"location":"how-to-guides/website-editing/#adding-or-replacing-images","title":"\ud83d\uddbc Adding or Replacing Images","text":"<ol> <li>In Builder, select the image component you want to change.</li> <li>Click Upload Image or choose from existing Site Assets.</li> <li>Use optimized images in <code>.jpg</code>, <code>.png</code>, or <code>.webp</code> format, ideally under 1MB.</li> </ol>"},{"location":"how-to-guides/website-editing/#publishing-changes","title":"\u2705 Publishing Changes","text":"<p>After making edits:</p> <ol> <li>Click Publish in the top-right corner of Experience Builder.</li> <li>Choose Publish to All to make the changes live.</li> <li>Verify by visiting spokanemountaineers.org.</li> </ol> <p>You can also use the Preview button to test changes before publishing.</p>"},{"location":"how-to-guides/website-editing/#advanced-editing-admins-only","title":"\ud83d\udee0 Advanced Editing (Admins Only)","text":"<p>For more complex changes, like updating custom Aura components:</p> <ul> <li>Use VS Code with the Salesforce CLI</li> <li>Deploy changes via <code>sf project deploy start</code></li> <li>Use Apex, Lightning components, and custom objects responsibly</li> </ul> <p>If you're not familiar with these tools, contact a dev/tech lead before making changes.</p>"},{"location":"how-to-guides/website-editing/#related-docs","title":"\ud83d\udcdd Related Docs","text":"<ul> <li>Customize Favicon</li> <li>KeepAlive Sessions</li> </ul>"},{"location":"how-to-guides/website-editing/#contributing","title":"Contributing","text":"<p>This site is maintained by volunteers. If you'd like to contribute documentation or suggest edits:</p> <ul> <li>Fork or clone the repository: github.com/jasonkradams/smi</li> <li>Make changes in Markdown</li> <li>Submit a pull request</li> </ul> <p>If you're unsure how to get started, contact the tech team or open an issue in the repository.</p>"},{"location":"implementation/","title":"Implementation Details","text":"<p>This section contains detailed technical documentation about the implementation of major features and systems in the Spokane Mountaineers Salesforce org. Unlike how-to guides which focus on configuration and usage, these documents provide comprehensive information about architecture, design decisions, testing strategies, and lessons learned.</p>"},{"location":"implementation/#available-implementation-guides","title":"Available Implementation Guides","text":"<ul> <li>Custom Login Page Implementation \u2013 Complete technical documentation for the custom Experience Cloud authentication flow, including login and forgot password pages, username normalization, custom labels, and testing strategy.</li> </ul>"},{"location":"implementation/#purpose","title":"Purpose","text":"<p>Implementation guides serve several important purposes:</p> <ol> <li>Knowledge Transfer \u2013 Provide detailed context for future developers and maintainers</li> <li>Decision Documentation \u2013 Explain why certain architectural choices were made</li> <li>Testing Reference \u2013 Document comprehensive testing approaches and coverage</li> <li>Troubleshooting \u2013 Help diagnose issues by understanding the full implementation</li> <li>Future Enhancement \u2013 Provide foundation for planned improvements and migrations</li> </ol>"},{"location":"implementation/#how-to-use-these-guides","title":"How to Use These Guides","text":"<ul> <li>For New Developers: Read implementation guides to understand the full context and reasoning behind complex features</li> <li>For Maintainers: Reference when making changes to understand potential impacts</li> <li>For Troubleshooting: Use to understand the complete system behavior and identify root causes</li> <li>For Planning: Review lessons learned and future considerations when planning enhancements</li> </ul>"},{"location":"implementation/#related-documentation","title":"Related Documentation","text":"<ul> <li>How-To Guides \u2013 Step-by-step configuration instructions</li> <li>Technical Articles \u2013 Problem-solution narratives and case studies</li> <li>Automation Guides \u2013 Documentation for automated processes and workflows</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/","title":"Chatter Publisher with Autosave Implementation","text":""},{"location":"implementation/chatter-publisher-autosave/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Architecture</li> <li>Implementation Details</li> <li>Component Details</li> <li>Testing Strategy</li> <li>Deployment Instructions</li> <li>Lessons Learned</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#overview","title":"Overview","text":"<p>This implementation provides a custom Lightning Web Component that replaces the standard Chatter publisher with autosave capabilities to prevent loss of drafted messages when composing updates to activity groups.</p>"},{"location":"implementation/chatter-publisher-autosave/#the-problem","title":"The Problem","text":"<p>Members were losing composed Chatter posts when:</p> <ul> <li>Browser windows needed updates or crashed</li> <li>Users navigated away from the page accidentally</li> <li>Sessions timed out requiring re-login</li> <li>Browsers were closed without posting</li> </ul> <p>The standard Salesforce Chatter publisher in Experience Cloud provides no draft saving functionality, resulting in frustration and wasted time, especially for longer or more thoughtful messages to activity groups.</p>"},{"location":"implementation/chatter-publisher-autosave/#the-solution","title":"The Solution","text":"<p>A custom Lightning Web Component (<code>chatterPublisherWithAutosave</code>) that provides:</p> <ol> <li>Automatic Draft Saving - Saves to browser localStorage after typing stops (configurable delay, default 3 seconds)</li> <li>Post and Poll Tabs - Post (rich text) and Poll (question + 2\u201310 choices) with separate drafts per tab</li> <li>Rich Text Support - Full formatting preservation for posts (bold, italic, lists, links, etc.)</li> <li>Draft Restoration - Prompts users to restore saved post or poll drafts when returning to pages</li> <li>Navigation Warnings - Warns users before leaving with unsaved changes</li> <li>Visual Feedback - Shows \"Draft saved\" briefly; message disappears after a short delay (configurable, default 3 seconds)</li> <li>Draft Expiration - Auto-expires drafts older than 7 days</li> <li>Per-Group Drafts - Each Chatter group maintains its own separate post and poll drafts</li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#goals","title":"Goals","text":"<ol> <li>Prevent loss of composed messages across all user scenarios</li> <li>Support rich text formatting in drafts</li> <li>Provide seamless user experience with minimal friction</li> <li>Work reliably across browser sessions and crashes</li> <li>Ensure comprehensive test coverage for Apex controllers</li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#architecture","title":"Architecture","text":""},{"location":"implementation/chatter-publisher-autosave/#component-overview","title":"Component Overview","text":"<pre><code>Chatter Autosave System\n\u2502\n\u251c\u2500\u2500 chatterPublisherWithAutosave (Lightning Web Component)\n\u2502   \u251c\u2500\u2500 chatterPublisherWithAutosave.js (Component logic)\n\u2502   \u251c\u2500\u2500 chatterPublisherWithAutosave.html (Template)\n\u2502   \u251c\u2500\u2500 chatterPublisherWithAutosave.css (Styling)\n\u2502   \u2514\u2500\u2500 chatterPublisherWithAutosave.js-meta.xml (Metadata)\n\u2502\n\u251c\u2500\u2500 ChatterPublisherController.cls (Apex Controller)\n\u2502   \u2514\u2500\u2500 ChatterPublisherControllerTest.cls (Test Class)\n\u2502\n\u2514\u2500\u2500 Configuration\n    \u2514\u2500\u2500 Experience Builder (Component Placement)\n</code></pre>"},{"location":"implementation/chatter-publisher-autosave/#key-design-decisions","title":"Key Design Decisions","text":"<p>Lightning Web Component Over Aura: We chose LWC because:</p> <ul> <li>Modern framework with better performance</li> <li>Native support for localStorage and browser APIs</li> <li>Better developer experience and tooling</li> <li><code>lightning-input-rich-text</code> component provides robust formatting</li> <li>Easier to maintain and extend</li> </ul> <p>localStorage for Draft Persistence: We chose browser localStorage over server-side storage because:</p> <ul> <li>Instant save with no network latency</li> <li>Works offline and survives browser restarts</li> <li>No additional database objects or storage limits needed</li> <li>Simpler implementation and faster user experience</li> <li>Drafts automatically scoped to device/browser (privacy benefit)</li> </ul> <p>Debounced Autosave: Draft saving uses a configurable debounce (see <code>AUTOSAVE_DELAY_MS</code> in the LWC, default 3 seconds) to:</p> <ul> <li>Avoid excessive localStorage writes</li> <li>Balance responsiveness with performance</li> <li>Match user expectations from other editing tools</li> </ul> <p>Rich Text HTML Storage: We store full HTML rather than plain text to:</p> <ul> <li>Preserve all formatting applied by users</li> <li>Support restoration of complex content</li> <li>Allow for future enhancement of formatting options</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#implementation-details","title":"Implementation Details","text":""},{"location":"implementation/chatter-publisher-autosave/#localstorage-key-structure","title":"localStorage Key Structure","text":"<p>Drafts are stored with keys in the format:</p> <ul> <li>Post drafts: <code>chatterDraft_&lt;groupId&gt;</code></li> <li>Poll drafts: <code>chatterPollDraft_&lt;groupId&gt;</code></li> </ul> <p>Each Chatter group maintains its own separate post and poll drafts, allowing users to have in-progress posts and polls for multiple groups simultaneously.</p>"},{"location":"implementation/chatter-publisher-autosave/#draft-data-structure","title":"Draft Data Structure","text":"<p>Post draft:</p> <pre><code>{\n  \"content\": \"&lt;p&gt;Draft message content with HTML&lt;/p&gt;\",\n  \"timestamp\": \"2026-02-08T10:30:00.000Z\",\n  \"groupId\": \"0F9xxxxxxxxxx\"\n}\n</code></pre> <p>Poll draft:</p> <pre><code>{\n  \"type\": \"poll\",\n  \"question\": \"Poll question text\",\n  \"choices\": [\"Choice 1\", \"Choice 2\", \"Choice 3\"],\n  \"timestamp\": \"2026-02-08T10:30:00.000Z\",\n  \"groupId\": \"0F9xxxxxxxxxx\"\n}\n</code></pre>"},{"location":"implementation/chatter-publisher-autosave/#autosave-flow","title":"Autosave Flow","text":"<p>Post tab:</p> <ol> <li>User types in rich text editor (or edits in Poll tab: question or choices)</li> <li>Component detects change via <code>onchange</code> event</li> <li>Debounce timer starts (duration from <code>AUTOSAVE_DELAY_MS</code>, default 3 seconds)</li> <li>If user stops typing, timer fires and saves to localStorage</li> <li>Visual indicator shows \"Draft saved\" briefly, then disappears after <code>DRAFT_SAVED_MESSAGE_DURATION_MS</code> (default 3 seconds)</li> <li>On page load, component checks for existing draft (post or poll)</li> <li>If found and not expired, shows restoration modal</li> <li>User can restore or discard draft</li> </ol> <p>Poll tab: Same debounce and save flow; poll drafts use <code>chatterPollDraft_&lt;groupId&gt;</code> and include question and choices.</p>"},{"location":"implementation/chatter-publisher-autosave/#navigation-warning-flow","title":"Navigation Warning Flow","text":"<ol> <li>User starts typing (sets <code>hasUnsavedChanges = true</code>)</li> <li>On successful save to localStorage, flag cleared</li> <li><code>beforeunload</code> event listener checks flag</li> <li>If unsaved changes exist, browser shows native confirmation dialog</li> <li>User can choose to stay or leave page</li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#draft-expiration","title":"Draft Expiration","text":"<ul> <li>Drafts expire after 7 days</li> <li>Cleanup runs on component initialization</li> <li>Expired drafts are automatically removed from localStorage</li> <li>Prevents storage bloat from abandoned drafts</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#component-details","title":"Component Details","text":""},{"location":"implementation/chatter-publisher-autosave/#chatterpublisherwithautosave-lwc","title":"ChatterPublisherWithAutosave (LWC)","text":"<p>Purpose: Provides custom Chatter publisher with autosave functionality</p> <p>Key constants (in component JS):</p> <ul> <li><code>AUTOSAVE_DELAY_MS</code> - Debounce delay before saving draft (default 3000 ms)</li> <li><code>DRAFT_SAVED_MESSAGE_DURATION_MS</code> - How long \"Draft saved\" stays visible (default 3000 ms)</li> <li><code>DRAFT_EXPIRATION_DAYS</code> - Drafts older than this are expired (7)</li> </ul> <p>Key Properties:</p> <pre><code>@api groupId; // Can be set explicitly or auto-detected from page\n_internalGroupId; // Auto-detected from CurrentPageReference\neffectiveGroupId; // Computed property that returns groupId || _internalGroupId\nactiveTab; // \"post\" | \"poll\"\n</code></pre> <p>Key Methods:</p> <pre><code>handleTextChange(event);\n</code></pre> <p>Responds to text changes in the rich text editor (Post tab):</p> <ol> <li>Updates <code>draftContent</code> with new value</li> <li>Sets <code>hasUnsavedChanges</code> flag</li> <li>Clears existing debounce timeout</li> <li>Sets new timeout for autosave (duration from <code>AUTOSAVE_DELAY_MS</code>)</li> </ol> <pre><code>saveDraftToLocalStorage();\n</code></pre> <p>Saves current post draft to browser localStorage:</p> <ol> <li>Validates content is not empty</li> <li>Creates draft object with content, timestamp, groupId</li> <li>Stores in localStorage with prefixed key</li> <li>Shows \"Draft saved\" briefly (cleared after <code>DRAFT_SAVED_MESSAGE_DURATION_MS</code>)</li> <li>Clears <code>hasUnsavedChanges</code> flag</li> </ol> <p>Poll drafts use <code>schedulePollDraftSave()</code> and <code>savePollDraftToLocalStorage()</code> with the same debounce and temporary message behavior.</p> <pre><code>loadDraftFromLocalStorage();\n</code></pre> <p>Loads existing draft from localStorage (post and/or poll):</p> <ol> <li>Retrieves draft by groupId key (post: <code>chatterDraft_</code>, poll: <code>chatterPollDraft_</code>)</li> <li>Checks if draft is expired (&gt;7 days)</li> <li>If expired, deletes and returns</li> <li>If valid, shows restoration modal with relative timestamp (restore or discard)</li> </ol> <pre><code>handlePost();\n</code></pre> <p>Posts content to Chatter via Apex:</p> <ol> <li>Validates content is not empty</li> <li>Calls <code>ChatterPublisherController.postToChatter</code></li> <li>On success, clears draft and shows success toast</li> <li>Reloads page to show new post in feed</li> <li>On error, shows error toast and keeps draft</li> </ol> <pre><code>beforeUnloadHandler(event);\n</code></pre> <p>Warns user before leaving with unsaved changes:</p> <ol> <li>Checks <code>hasUnsavedChanges</code> flag and content not empty</li> <li>If true, prevents default navigation</li> <li>Sets <code>returnValue</code> to trigger browser confirmation dialog</li> </ol> <p>Helper Methods:</p> <ul> <li><code>cleanupExpiredDrafts()</code> - Removes expired post and poll drafts (checks both key prefixes)</li> <li><code>getDraftKey()</code> / <code>getPollDraftKey()</code> - Return localStorage keys for current group</li> <li><code>isContentNotEmpty()</code> - Strips HTML and checks for actual text</li> <li><code>isDraftExpired()</code> - Checks if draft is older than 7 days</li> <li><code>getRelativeTime()</code> - Formats timestamp as \"just now\", \"X minutes ago\", etc.</li> <li><code>showToast()</code> - Displays lightning toast messages</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#chatterpublishercontroller-apex","title":"ChatterPublisherController (Apex)","text":"<p>Purpose: Handles posting messages to Chatter groups via ConnectApi</p> <p>Key Methods:</p> <pre><code>@AuraEnabled\npublic static String postToChatter(String groupId, String content)\n</code></pre> <p>Posts a text message to a Chatter group:</p> <ol> <li>Validates groupId and content are provided</li> <li>Verifies Chatter group exists and user has access</li> <li>Converts rich text HTML to plain text</li> <li>Builds ConnectApi.FeedItemInput</li> <li>Posts via <code>ConnectApi.ChatterFeeds.postFeedElement</code></li> <li>Returns feed item ID on success</li> </ol> <pre><code>@AuraEnabled\npublic static String postPollToChatter(String groupId, String question, List&lt;String&gt; choices)\n</code></pre> <p>Posts a poll to a Chatter group:</p> <ol> <li>Validates groupId, question, and at least 2 non-empty choices (max 10)</li> <li>Verifies Chatter group exists and user has access</li> <li>Builds ConnectApi.FeedItemInput with body (question) and PollCapabilityInput (choices)</li> <li>Posts via <code>ConnectApi.ChatterFeeds.postFeedElement</code></li> <li>Returns feed element ID on success (or mock ID in test context)</li> </ol> <pre><code>private static Id getNetworkId()\n</code></pre> <p>Gets the network ID for community context:</p> <ol> <li>Tries <code>Network.getNetworkId()</code> first</li> <li>Falls back to querying for \"Spokane Mountaineers\" network</li> <li>Returns network ID or null</li> </ol> <pre><code>private static String stripHtmlTags(String html)\n</code></pre> <p>Converts rich text HTML to plain text:</p> <ol> <li>Converts <code>&lt;br&gt;</code> and <code>&lt;/p&gt;</code> tags to newlines</li> <li>Converts list items to bullet points</li> <li>Removes all other HTML tags</li> <li>Decodes HTML entities (&amp;, &lt;, etc.)</li> <li>Cleans up multiple consecutive newlines</li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#testing-strategy","title":"Testing Strategy","text":""},{"location":"implementation/chatter-publisher-autosave/#test-coverage-goals","title":"Test Coverage Goals","text":"<p>ChatterPublisherController: Achieved 100% code coverage</p> <p>Test Scenarios Covered:</p> <ol> <li> <p>Successful post and poll posting:</p> <ul> <li>Plain text content</li> <li>Rich text with formatting</li> <li>Content with HTML entities</li> <li>Content with line breaks</li> <li>Content with lists</li> <li>Long content</li> <li>Content with special characters</li> <li>Poll: valid question and 2\u201310 choices; blank choices filtered out</li> </ul> </li> <li> <p>Error Handling:</p> <ul> <li>Null group ID</li> <li>Empty group ID</li> <li>Null content</li> <li>Empty content</li> <li>Invalid/non-existent group ID</li> <li>Poll: null/blank groupId, blank question, too few choices, too many choices</li> </ul> </li> <li> <p>Edge Cases:</p> <ul> <li>Group ID validation</li> <li>HTML to text conversion</li> <li>Entity decoding</li> <li>List formatting</li> </ul> </li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#test-data-strategy","title":"Test Data Strategy","text":"<p>Tests use:</p> <ul> <li>Dynamic Chatter group creation with unique names (timestamp suffix)</li> <li>Query for existing Public Chatter groups when possible</li> <li>Proper use of <code>Test.startTest()</code> and <code>Test.stopTest()</code></li> <li>Comprehensive assertions for positive and negative cases</li> <li>Mock HTML content representing real-world usage</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests for the controller\nsf apex run test --tests ChatterPublisherControllerTest --target-org staging --code-coverage --result-format human\n\n# Check code coverage\nsf apex get test --code-coverage --target-org staging\n</code></pre>"},{"location":"implementation/chatter-publisher-autosave/#deployment-instructions","title":"Deployment Instructions","text":""},{"location":"implementation/chatter-publisher-autosave/#prerequisites","title":"Prerequisites","text":"<ol> <li>Salesforce CLI installed</li> <li>Access to staging and production orgs</li> <li>Git repository cloned locally</li> <li>Feature branch created: <code>feature/chatter-autosave</code></li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#quick-deploy-new-components-only","title":"Quick Deploy (New Components Only)","text":"<p>To deploy only the Chatter autosave components and run only their tests (faster than a full project deploy):</p> <pre><code>sf project deploy start \\\n  --target-org staging \\\n  --source-dir force-app/main/default/classes/ChatterPublisherController.cls \\\n  --source-dir force-app/main/default/classes/ChatterPublisherControllerTest.cls \\\n  --source-dir force-app/main/default/lwc/chatterPublisherWithAutosave \\\n  --test-level RunSpecifiedTests \\\n  --tests ChatterPublisherControllerTest \\\n  --wait 10\n</code></pre> <ul> <li>--source-dir (repeated): Deploys only these three items (each Apex class includes its <code>.cls-meta.xml</code>).</li> <li>--test-level RunSpecifiedTests: Only <code>ChatterPublisherControllerTest</code> runs.</li> <li>--wait 10: Wait up to 10 minutes for the deployment to finish.</li> </ul> <p>Use the same command for production by changing <code>--target-org</code> (e.g. <code>--target-org production</code>).</p>"},{"location":"implementation/chatter-publisher-autosave/#step-1-deploy-to-staging-full-project","title":"Step 1: Deploy to Staging (Full Project)","text":"<pre><code># Deploy the component and Apex classes to staging\nsf project deploy start --target-org staging\n\n# Monitor deployment\nsf project deploy report --target-org staging\n</code></pre>"},{"location":"implementation/chatter-publisher-autosave/#step-2-run-apex-tests","title":"Step 2: Run Apex Tests","text":"<pre><code># Run tests and verify &gt;75% coverage\nsf apex run test --tests ChatterPublisherControllerTest \\\n  --target-org staging \\\n  --code-coverage \\\n  --result-format human \\\n  --wait 10\n\n# Get detailed coverage report\nsf apex get test --code-coverage --target-org staging\n</code></pre> <p>Expected output:</p> <ul> <li>All test methods passing</li> <li>Code coverage &gt;75% for ChatterPublisherController</li> <li>No test failures or errors</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#step-3-add-component-to-experience-cloud","title":"Step 3: Add Component to Experience Cloud","text":"<ol> <li> <p>Open Experience Builder:</p> <ul> <li>Navigate to Digital Experiences &gt; All Sites</li> <li>Find \"Spokane Mountaineers\" site</li> <li>Click \"Builder\"</li> </ul> </li> <li> <p>Navigate to Group Detail Page:</p> <ul> <li>In Experience Builder, go to any Chatter group page</li> <li>Or configure via Settings &gt; Theme &gt; Group Pages template</li> </ul> </li> <li> <p>Add Component:</p> <ul> <li>In left sidebar, find \"Custom Components\"</li> <li>Drag \"Chatter Publisher with Autosave\" onto the page</li> <li>Position it above the standard Chatter feed</li> <li>Leave \"Chatter Group ID\" property blank (auto-detects from page)</li> </ul> </li> <li> <p>Publish Changes:</p> <ul> <li>Click \"Publish\" button</li> <li>Confirm publication to make changes live</li> </ul> </li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#step-4-test-in-staging","title":"Step 4: Test in Staging","text":"<p>Test Scenarios:</p> <ol> <li> <p>Draft Saving:</p> <ul> <li>Navigate to a Chatter group page in staging</li> <li>Start typing a message with formatting (Post tab) or question/choices (Poll tab)</li> <li>Wait a few seconds (autosave delay, default 3 seconds)</li> <li>Verify \"Draft saved\" appears briefly, then disappears</li> <li>Check browser console: <code>localStorage.getItem('chatterDraft_&lt;groupId&gt;')</code> or <code>chatterPollDraft_&lt;groupId&gt;</code> for poll</li> </ul> </li> <li> <p>Draft Restoration:</p> <ul> <li>With a saved post or poll draft, refresh the page</li> <li>Verify restoration modal appears (post or poll wording)</li> <li>Click \"Restore Draft\"</li> <li>Confirm content is restored (post formatting or poll question/choices intact)</li> </ul> </li> <li> <p>Navigation Warning:</p> <ul> <li>Start typing without waiting for autosave</li> <li>Try to navigate away or close tab</li> <li>Verify browser shows confirmation dialog</li> </ul> </li> <li> <p>Posting:</p> <ul> <li>Compose a message (Post) or poll (Poll tab), then click \"Share\"</li> <li>Verify post or poll appears in Chatter feed</li> <li>Confirm draft is cleared from localStorage</li> <li>\"Draft saved\" message is temporary and clears on its own after the configured duration</li> </ul> </li> <li> <p>Draft Expiration:</p> <ul> <li>Manually create expired draft in console:     <pre><code>const groupId = \"0F9...\"; // Current group ID\nconst expiredDraft = {\n    content: \"&lt;p&gt;Old draft&lt;/p&gt;\",\n    timestamp: new Date(\n        Date.now() - 8 * 24 * 60 * 60 * 1000\n    ).toISOString(), // 8 days ago\n    groupId: groupId\n};\nlocalStorage.setItem(\n    `chatterDraft_${groupId}`,\n    JSON.stringify(expiredDraft)\n);\n</code></pre></li> <li>Refresh page</li> <li>Verify no restoration modal appears</li> <li>Check localStorage to confirm draft was removed</li> </ul> </li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#step-5-deploy-to-production","title":"Step 5: Deploy to Production","text":"<p>After successful staging testing:</p> <pre><code># Switch to production org\nsf config set target-org production\n\n# Deploy\nsf project deploy start --target-org production\n\n# Run tests in production\nsf apex run test --tests ChatterPublisherControllerTest \\\n  --target-org production \\\n  --code-coverage \\\n  --result-format human \\\n  --wait 10\n</code></pre>"},{"location":"implementation/chatter-publisher-autosave/#step-6-rollout-strategy","title":"Step 6: Rollout Strategy","text":"<p>Phased Approach:</p> <ol> <li>Deploy component to one test group (e.g., Ecomm) first</li> <li>Monitor for 1-2 days</li> <li>Roll out to all activity group pages</li> <li>Communicate to members about new autosave feature</li> </ol> <p>Rollback Plan:</p> <p>If issues arise:</p> <ol> <li>Remove component from Experience Builder (immediate)</li> <li>Members revert to standard Chatter publisher</li> <li>No data loss (drafts remain in localStorage)</li> <li>Fix issues and redeploy</li> </ol>"},{"location":"implementation/chatter-publisher-autosave/#lessons-learned","title":"Lessons Learned","text":""},{"location":"implementation/chatter-publisher-autosave/#what-worked-well","title":"What Worked Well","text":"<p>localStorage for Persistence: Using browser localStorage provided instant saves with no network latency and survived browser crashes perfectly. The approach proved more reliable than we initially expected, with no storage quota issues even with rich HTML content.</p> <p>Debounced Autosave: The configurable debounce (e.g. 3 seconds) strikes a balance between responsiveness and performance. Users see a brief \"Draft saved\" confirmation that disappears after a short delay, avoiding clutter.</p> <p>Rich Text Component: The <code>lightning-input-rich-text</code> component provided robust formatting out of the box. The toolbar was familiar to users from other editing tools, reducing the learning curve.</p> <p>ESLint Enforcement: Pre-commit hooks caught several issues early:</p> <ul> <li>Invalid <code>@api</code> property reassignment</li> <li>Missing return statements</li> <li>Async operation restrictions</li> <li>innerHTML security concerns</li> </ul> <p>These catches prevented bugs from reaching production.</p> <p>Comprehensive Test Coverage: Achieving 100% coverage for the Apex controller gave us confidence to deploy. Edge cases like null values, empty strings, and invalid group IDs were all covered.</p>"},{"location":"implementation/chatter-publisher-autosave/#challenges-overcome","title":"Challenges Overcome","text":"<p>LWC Platform Restrictions: Hit several ESLint rules specific to LWC:</p> <ul> <li><code>@lwc/lwc/no-api-reassignments</code> - Can't reassign <code>@api</code> properties<ul> <li>Solution: Created <code>_internalGroupId</code> private property and <code>effectiveGroupId</code> getter</li> </ul> </li> <li><code>@lwc/lwc/no-async-operation</code> - Can't use <code>setTimeout</code> without eslint-disable<ul> <li>Solution: Added inline eslint-disable comment with justification</li> </ul> </li> <li><code>@lwc/lwc/no-inner-html</code> - Can't use <code>innerHTML</code> for security<ul> <li>Solution: Added eslint-disable where needed for HTML parsing in helper method</li> </ul> </li> </ul> <p>ConnectApi HTML Limitations: The Connect API doesn't support rich HTML posting directly. Initial implementation tried to post HTML but Chatter stripped formatting.</p> <ul> <li>Solution: Built <code>stripHtmlTags</code> method to intelligently convert HTML to plain text while preserving structure (line breaks, lists)</li> </ul> <p>beforeunload Event Handling: The browser's <code>beforeunload</code> event requires returning a value, but ESLint flagged missing return in else branch.</p> <ul> <li>Solution: Added explicit <code>return undefined</code> for consistency</li> </ul> <p>Draft Restoration UX: Initial implementation restored drafts automatically, which was jarring if users didn't remember they had a draft.</p> <ul> <li>Solution: Added modal dialog with \"Restore\" vs \"Discard\" options, showing timestamp so users can decide</li> </ul> <p>Multiple Chatter Groups: Needed to handle users composing drafts for multiple groups simultaneously.</p> <ul> <li>Solution: Keyed drafts by groupId, allowing independent drafts per group</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#future-considerations","title":"Future Considerations","text":"<p>Server-Side Draft Backup: Consider adding optional server-side draft storage for:</p> <ul> <li>Cross-device access (draft on desktop, restore on mobile)</li> <li>Draft sharing/collaboration</li> <li>Audit trail of draft history</li> <li>Recovery if localStorage is cleared</li> </ul> <p>This could be implemented as an enhancement without changing the current localStorage-first approach.</p> <p>Rich Text Posting: Explore options for preserving rich text formatting in Chatter posts:</p> <ul> <li>ConnectApi rich text segments (may support some formatting)</li> <li>Markdown conversion for structured content</li> <li>Image paste support</li> </ul> <p>@Mention and #Hashtag Preservation: Current implementation doesn't preserve Chatter-specific syntax. Future enhancement could:</p> <ul> <li>Parse @mentions from HTML</li> <li>Convert to ConnectApi.MentionSegmentInput</li> <li>Parse #hashtags and convert to ConnectApi.HashtagSegmentInput</li> </ul> <p>Draft Versioning: For long-form posts, users might appreciate:</p> <ul> <li>Multiple draft versions</li> <li>Undo/redo functionality</li> <li>Draft comparison view</li> </ul> <p>Analytics Integration: Track usage metrics:</p> <ul> <li>How often drafts are saved</li> <li>How often drafts are restored vs discarded</li> <li>Average draft lifespan</li> <li>Most common draft content lengths</li> </ul> <p>Mobile Optimization: While the component works on mobile, consider:</p> <ul> <li>Touch-optimized toolbar</li> <li>Simplified formatting options for small screens</li> <li>Better modal sizing for mobile viewports</li> </ul> <p>Accessibility Improvements:</p> <ul> <li>ARIA labels for screen readers</li> <li>Keyboard shortcuts for common actions</li> <li>Focus management in restoration modal</li> <li>High contrast mode support</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#related-documentation","title":"Related Documentation","text":"<ul> <li>Activity Group Event Notifications - Related Chatter automation</li> <li>Setup Staging Sandbox - Staging environment setup</li> <li>Salesforce Development Console Cheatsheet - Debugging tools</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#code-references","title":"Code References","text":"<p>Lightning Web Component:</p> <ul> <li><code>force-app/main/default/lwc/chatterPublisherWithAutosave/chatterPublisherWithAutosave.js</code></li> <li><code>force-app/main/default/lwc/chatterPublisherWithAutosave/chatterPublisherWithAutosave.html</code></li> <li><code>force-app/main/default/lwc/chatterPublisherWithAutosave/chatterPublisherWithAutosave.css</code></li> <li><code>force-app/main/default/lwc/chatterPublisherWithAutosave/chatterPublisherWithAutosave.js-meta.xml</code></li> </ul> <p>Apex Classes:</p> <ul> <li><code>force-app/main/default/classes/ChatterPublisherController.cls</code></li> <li><code>force-app/main/default/classes/ChatterPublisherController.cls-meta.xml</code></li> <li><code>force-app/main/default/classes/ChatterPublisherControllerTest.cls</code></li> <li><code>force-app/main/default/classes/ChatterPublisherControllerTest.cls-meta.xml</code></li> </ul> <p>Configuration:</p> <ul> <li><code>force-app/main/default/lwc/.eslintrc.json</code> - ESLint configuration for LWC</li> </ul>"},{"location":"implementation/chatter-publisher-autosave/#issue-reference","title":"Issue Reference","text":"<p>Addresses Issue #10: No Autosave When Composing Messages</p>"},{"location":"implementation/custom-login-page-implementation/","title":"Custom Login Page Implementation Details","text":""},{"location":"implementation/custom-login-page-implementation/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Architecture</li> <li>Implementation Timeline</li> <li>Component Details</li> <li>Testing Strategy</li> <li>Configuration Management</li> <li>Lessons Learned</li> </ul>"},{"location":"implementation/custom-login-page-implementation/#overview","title":"Overview","text":"<p>This document provides detailed technical information about the custom login page implementation for the Spokane Mountaineers Experience Cloud site. The primary goal of this implementation is to make the <code>.smi</code> username suffix transparent to members while maintaining Salesforce's global username uniqueness requirement.</p>"},{"location":"implementation/custom-login-page-implementation/#background-the-smi-username-requirement","title":"Background: The <code>.smi</code> Username Requirement","text":"<p>Salesforce requires usernames to be globally unique across all Salesforce organizations worldwide. This is a current platform constraint, not a historical one. To ensure our members had unique usernames in this global namespace, we append <code>.smi</code> to every member's email address (e.g., <code>jane.smith@gmail.com</code> becomes <code>jane.smith@gmail.com.smi</code>).</p> <p>This approach solves the uniqueness problem but creates member confusion\u2014members don't understand why they need to add <code>.smi</code> when logging in.</p>"},{"location":"implementation/custom-login-page-implementation/#the-challenge","title":"The Challenge","text":"<p>We cannot migrate away from <code>.smi</code> usernames because:</p> <ol> <li>Global Uniqueness Constraint: Salesforce still requires globally unique usernames</li> <li>Member Email Conflicts: Many members likely have their email addresses registered as usernames in other Salesforce organizations (work orgs, other communities, etc.)</li> <li>Migration Would Fail: Attempting to change <code>jane@gmail.com.smi</code> to <code>jane@gmail.com</code> would fail if that username exists anywhere in Salesforce</li> </ol>"},{"location":"implementation/custom-login-page-implementation/#the-solution-make-smi-transparent","title":"The Solution: Make <code>.smi</code> Transparent","text":"<p>Rather than trying to eliminate <code>.smi</code> (which isn't viable), we make it transparent to members. The standard Salesforce Experience Cloud login page doesn't allow custom scripting to transform input values, so we built custom authentication pages that automatically append <code>.smi</code> if members don't include it.</p>"},{"location":"implementation/custom-login-page-implementation/#goals","title":"Goals","text":"<ol> <li>Allow members to enter just their email address (without <code>.smi</code>)</li> <li>Automatically append <code>.smi</code> before authentication if not present</li> <li>Support members who still type <code>.smi</code> out of habit (backward compatible)</li> <li>Work for both login and password reset flows</li> <li>Provide a modern, branded experience</li> <li>Ensure comprehensive test coverage</li> </ol>"},{"location":"implementation/custom-login-page-implementation/#architecture","title":"Architecture","text":""},{"location":"implementation/custom-login-page-implementation/#component-overview","title":"Component Overview","text":"<pre><code>Experience Cloud Authentication Flow\n\u2502\n\u251c\u2500\u2500 CommunitiesLogin (Visualforce Page)\n\u2502   \u251c\u2500\u2500 CommunitiesLoginController.cls\n\u2502   \u2514\u2500\u2500 CommunitiesLoginControllerTest.cls\n\u2502\n\u251c\u2500\u2500 CommunitiesForgotPassword (Visualforce Page)\n\u2502   \u251c\u2500\u2500 CommunitiesForgotPasswordController.cls\n\u2502   \u2514\u2500\u2500 CommunitiesForgotPasswordControllerTest.cls\n\u2502\n\u2514\u2500\u2500 Configuration\n    \u251c\u2500\u2500 Custom Labels (Community_Join_URL, etc.)\n    \u2514\u2500\u2500 Guest User Profile (Page Access)\n</code></pre>"},{"location":"implementation/custom-login-page-implementation/#key-design-decisions","title":"Key Design Decisions","text":"<p>Visualforce Over Lightning Web Components: We chose Visualforce for the authentication pages because:</p> <ul> <li>Experience Cloud's authentication servlet routes work more reliably with Visualforce</li> <li>Simpler integration with <code>Site.login()</code> and <code>Site.forgotPassword()</code> methods</li> <li>Mature platform with well-documented authentication patterns</li> <li>Custom scripting not possible with standard Experience Cloud login pages</li> </ul> <p>Username Normalization: Both login and forgot password flows automatically append the <code>.smi</code> suffix if members don't include it. This is the core functionality enabling email-based login:</p> <pre><code>// In CommunitiesLoginController and CommunitiesForgotPasswordController\nif (!username.endsWithIgnoreCase('.smi')) {\n  username = username + '.smi';\n}\n</code></pre> <p>This approach means members can enter just their email address, and the system will authenticate them correctly. Members who still type <code>.smi</code> out of habit aren't affected\u2014the check ensures we don't double-append the suffix.</p> <p>Custom Labels for URLs: Rather than hardcoding URLs in Visualforce pages, we use custom labels. This allows non-technical administrators to update URLs through the Salesforce UI without code changes.</p>"},{"location":"implementation/custom-login-page-implementation/#implementation-timeline","title":"Implementation Timeline","text":"<p>This implementation was completed in six atomic commits, each building on the previous work to create a complete email-based login solution.</p>"},{"location":"implementation/custom-login-page-implementation/#phase-1-initial-login-page-commits-4e86d22-80e16a6","title":"Phase 1: Initial Login Page (Commits 4e86d22, 80e16a6)","text":"<p>Created: Custom login page with username normalization</p> <p>Primary Goal: Enable automatic <code>.smi</code> appending to support email-based login</p> <p>Features: - Username normalization (automatically appends <code>.smi</code> suffix if not present) - Modern, responsive design - Alpine.js for interactivity - Password visibility toggle - Google OAuth integration - Loading states during authentication</p> <p>Why This Matters: The standard Experience Cloud login page cannot transform input values. This custom page gives us the ability to append <code>.smi</code> before authentication, allowing members to enter just their email address.</p> <p>Components: - <code>CommunitiesLogin.page</code> - Visualforce page with custom styling - <code>CommunitiesLoginController.cls</code> - Controller with username normalization logic - <code>CommunitiesLoginControllerTest.cls</code> - Test class with comprehensive coverage</p>"},{"location":"implementation/custom-login-page-implementation/#phase-2-custom-labels-commit-5008e86","title":"Phase 2: Custom Labels (Commit 5008e86)","text":"<p>Created: Custom labels for frequently-changed values</p> <p>Labels Added: - <code>Community_Join_URL</code> - New member signup form URL - <code>Community_Renew_URL</code> - Membership renewal form URL - <code>Community_Support_Email</code> - Support contact email</p> <p>Rationale: While not directly related to username migration, custom labels allow administrators to update URLs and contact information through Setup \u2192 Custom Labels without requiring code changes or deployments. This reduces maintenance burden as we evolve the authentication experience.</p>"},{"location":"implementation/custom-login-page-implementation/#phase-3-feature-simplification-commit-8f6aa25","title":"Phase 3: Feature Simplification (Commit 8f6aa25)","text":"<p>Removed: Unused features to focus on core username normalization functionality</p> <p>Features Removed: - Remember me checkbox (redundant with Salesforce session settings) - Self-registration URL method (not used in current flow) - Unnecessary debug logging</p> <p>Benefits: - Simpler codebase focused on username normalization - Reduced maintenance burden - Clearer code intention - Fewer test cases to maintain</p> <p>Why This Matters: Removing features that weren't contributing to the email-based login goal simplified the codebase and made the core functionality more obvious. This refactoring made the code easier to understand and maintain.</p>"},{"location":"implementation/custom-login-page-implementation/#phase-4-forgot-password-page-commit-5b9a504","title":"Phase 4: Forgot Password Page (Commit 5b9a504)","text":"<p>Created: Custom forgot password page with username normalization</p> <p>Primary Goal: Complete the authentication flow by supporting automatic <code>.smi</code> appending in password resets</p> <p>Features: - Matching visual design with login page - Username normalization (appends <code>.smi</code> suffix if not present) - Same background image and styling - Responsive layout - Loading states and error handling</p> <p>Why This Matters: Members who forget their password need the same username normalization support. Without this custom page, a member entering just their email address on the forgot password form would fail to receive a reset email.</p> <p>Components: - <code>CommunitiesForgotPassword.page</code> - Visualforce page - <code>CommunitiesForgotPasswordController.cls</code> - Controller with password reset and normalization logic - <code>CommunitiesForgotPasswordControllerTest.cls</code> - Test class (100% coverage)</p>"},{"location":"implementation/custom-login-page-implementation/#phase-5-guest-profile-configuration-commit-fbc0ead","title":"Phase 5: Guest Profile Configuration (Commit fbc0ead)","text":"<p>Created: Guest user profile with page access permissions</p> <p>Configuration: Added Visualforce page access to guest user profile for: - <code>CommunitiesLogin</code> - <code>CommunitiesForgotPassword</code></p> <p>Why This Matters: Unauthenticated users (those not logged in) need explicit permission to view Visualforce pages in Experience Cloud. Without this configuration, members attempting to access the custom login and forgot password pages would see an error.</p>"},{"location":"implementation/custom-login-page-implementation/#phase-6-documentation-updates-commit-896773a","title":"Phase 6: Documentation Updates (Commit 896773a)","text":"<p>Updated: Configuration guide to reflect current implementation</p> <p>Changes: - Removed documentation for removed features (remember me, self-registration) - Added custom labels documentation - Updated test scenarios to match actual functionality - Simplified troubleshooting sections - Clarified the email-based login approach (appending <code>.smi</code>, not removing it)</p> <p>Why This Matters: Documentation that doesn't match implementation creates confusion and wastes time. This update ensures the configuration guide accurately reflects the system's current state and the email-based login goal.</p>"},{"location":"implementation/custom-login-page-implementation/#component-details","title":"Component Details","text":""},{"location":"implementation/custom-login-page-implementation/#communitieslogincontroller","title":"CommunitiesLoginController","text":"<p>Purpose: Handles login authentication and URL generation for the community</p> <p>Key Methods:</p> <p><pre><code>public PageReference login()\n</code></pre> Main login method that: 1. Normalizes username by appending <code>.smi</code> suffix if not present 2. Calls <code>Site.login()</code> with credentials and startURL 3. Handles errors with user-friendly messages 4. Returns null on error to stay on page, or PageReference on success</p> <p><pre><code>public String getForgotPasswordUrl()\n</code></pre> Returns the URL to the custom forgot password page based on the current site's base URL.</p> <p><pre><code>public String getGoogleLoginUrl()\n</code></pre> Generates the Google OAuth login URL with proper redirect handling and startURL preservation.</p> <p>Properties: - <code>username</code> - User-entered username - <code>password</code> - User-entered password - <code>startUrl</code> - URL to redirect to after successful login - <code>hasError</code> - Boolean flag for error state</p>"},{"location":"implementation/custom-login-page-implementation/#communitiesforgotpasswordcontroller","title":"CommunitiesForgotPasswordController","text":"<p>Purpose: Handles password reset requests with username normalization</p> <p>Key Methods:</p> <p><pre><code>public PageReference forgotPassword()\n</code></pre> Main password reset method that: 1. Validates username is provided 2. Normalizes username by appending <code>.smi</code> suffix if not present 3. Calls <code>Site.forgotPassword()</code> to send reset email 4. Returns user to login page with confirmation message 5. Handles errors gracefully</p> <p><pre><code>public String getLoginUrl()\n</code></pre> Returns the URL to the custom login page for easy navigation back.</p> <p>Properties: - <code>username</code> - User-entered username - <code>hasError</code> - Boolean flag for error state</p>"},{"location":"implementation/custom-login-page-implementation/#visualforce-page-structure","title":"Visualforce Page Structure","text":"<p>Both pages share a common structure:</p> <p>Head Section: - Alpine.js CDN for interactivity - Tailwind CSS CDN for styling - Custom inline styles for branding - Favicon reference</p> <p>Body Structure: <pre><code>&lt;body class=\"min-h-screen bg-cover bg-center\"&gt;\n  &lt;div class=\"background-overlay\"&gt;\n    &lt;div class=\"container mx-auto\"&gt;\n      &lt;div class=\"form-container\"&gt;\n        &lt;apex:form&gt;\n          &lt;!-- Logo, heading, form fields --&gt;\n          &lt;!-- Error messages --&gt;\n          &lt;!-- Submit button with loading state --&gt;\n          &lt;!-- Helper links --&gt;\n        &lt;/apex:form&gt;\n      &lt;/div&gt;\n      &lt;div class=\"info-container\"&gt;\n        &lt;!-- Helpful information panel --&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/body&gt;\n</code></pre></p> <p>Alpine.js Data: - <code>loading</code> - Boolean for button/spinner state - <code>showPassword</code> - Boolean for password visibility toggle (login only)</p>"},{"location":"implementation/custom-login-page-implementation/#testing-strategy","title":"Testing Strategy","text":""},{"location":"implementation/custom-login-page-implementation/#test-coverage-goals","title":"Test Coverage Goals","text":"<p>All controllers achieve 100% code coverage with comprehensive test scenarios:</p> <p>CommunitiesLoginControllerTest: - Constructor initialization - Successful login - Login with empty username - Login with empty password - Login with invalid credentials - Forgot password URL generation - Google login URL generation - Google login URL with startURL parameter</p> <p>CommunitiesForgotPasswordControllerTest: - Constructor initialization - Successful password reset - Password reset with empty username - Password reset with invalid username - Username normalization (appends <code>.smi</code> suffix when not present) - Login URL generation</p>"},{"location":"implementation/custom-login-page-implementation/#test-data-strategy","title":"Test Data Strategy","text":"<p>Tests use: - Standard test users where possible - Mock page parameters for startURL testing - <code>Test.startTest()</code> and <code>Test.stopTest()</code> for governor limit isolation - Proper assertions for both positive and negative test cases</p>"},{"location":"implementation/custom-login-page-implementation/#running-tests","title":"Running Tests","text":"<pre><code># Run all login-related tests\nsf apex run test --tests CommunitiesLoginControllerTest --tests CommunitiesForgotPasswordControllerTest --target-org production --code-coverage --result-format human\n\n# Run individual test class\nsf apex run test --tests CommunitiesLoginControllerTest --target-org production --code-coverage --result-format human\n</code></pre>"},{"location":"implementation/custom-login-page-implementation/#configuration-management","title":"Configuration Management","text":""},{"location":"implementation/custom-login-page-implementation/#custom-labels","title":"Custom Labels","text":"<p>Custom labels enable easy configuration updates without code deployment.</p> <p>Creating a Custom Label:</p> <ol> <li>Setup \u2192 Custom Labels \u2192 New Custom Label</li> <li>Fill in required fields:</li> <li>Name: <code>Community_Join_URL</code></li> <li>Value: <code>https://donorbox.org/spokane-mountaineers-membership-2</code></li> <li>Description: URL for new member signup</li> <li>Category: Community</li> <li>Protected: No (unchecked)</li> <li>Save</li> </ol> <p>Using in Visualforce:</p> <pre><code>&lt;a href=\"{!$Label.Community_Join_URL}\" class=\"link\"&gt;\n  Sign up for membership\n&lt;/a&gt;\n</code></pre> <p>Current Custom Labels:</p> Label Name Value Purpose <code>Community_Join_URL</code> <code>https://donorbox.org/spokane-mountaineers-membership-2</code> New member signup form <code>Community_Renew_URL</code> <code>https://donorbox.org/spokane-mountaineers-membership</code> Membership renewal form <code>Community_Support_Email</code> <code>membership@spokanemountaineers.org</code> Support contact email"},{"location":"implementation/custom-login-page-implementation/#guest-user-profile","title":"Guest User Profile","text":"<p>The guest user profile must have access to both Visualforce pages for unauthenticated access.</p> <p>Verifying Profile Access:</p> <ol> <li>Setup \u2192 Profiles \u2192 [Guest User Profile]</li> <li>Scroll to \"Enabled Apex Page Access\"</li> <li>Verify both pages are listed:</li> <li><code>CommunitiesLogin</code></li> <li><code>CommunitiesForgotPassword</code></li> <li>If missing, click \"Edit\" and add them</li> </ol>"},{"location":"implementation/custom-login-page-implementation/#experience-cloud-configuration","title":"Experience Cloud Configuration","text":"<p>Setting Custom Login Page:</p> <ol> <li>Experience Builder \u2192 Settings \u2192 Login &amp; Registration</li> <li>Login Page: Select \"CommunitiesLogin\"</li> <li>Forgot Password Page: Select \"CommunitiesForgotPassword\"</li> <li>Save and publish</li> </ol>"},{"location":"implementation/custom-login-page-implementation/#lessons-learned","title":"Lessons Learned","text":""},{"location":"implementation/custom-login-page-implementation/#what-worked-well","title":"What Worked Well","text":"<p>Username Normalization Strategy: Automatically appending the <code>.smi</code> suffix has been completely transparent to members. Members can now enter just their email address without thinking about <code>.smi</code>, while those who still type the full username out of habit aren't affected. This approach eliminates member confusion without requiring database changes.</p> <p>Verifying Platform Constraints Early: Initial research suggested Salesforce had removed the global username uniqueness requirement. Deeper investigation revealed this constraint still exists, which fundamentally changed our approach. Lesson: Always verify platform constraints before planning data migrations. We pivoted from \"migrate away from <code>.smi</code>\" to \"make <code>.smi</code> transparent,\" which proved to be a better solution anyway.</p> <p>Atomic, Test-Driven Implementation: Building the solution in small, well-tested commits gave us confidence that each piece worked correctly. The comprehensive test coverage (100% for all controllers) meant we could refactor and remove features without fear of breaking authentication.</p> <p>Custom Labels: Having URLs managed through custom labels has proven valuable for ongoing maintenance. When membership URLs change, administrators can update them immediately without waiting for a code deployment.</p> <p>Consistent Design: Using the same background image, color scheme, and layout across both login and forgot password pages creates a cohesive user experience. Members don't experience visual discontinuity when navigating between authentication flows.</p>"},{"location":"implementation/custom-login-page-implementation/#challenges-overcome","title":"Challenges Overcome","text":"<p>Platform Constraints: The standard Experience Cloud login page doesn't support custom scripting or input transformation. This forced us to build custom Visualforce pages, which initially seemed like extra work but ultimately gave us complete control over the authentication experience.</p> <p>Pivot from Migration to Transparency: Discovering that Salesforce still requires globally unique usernames meant we couldn't migrate away from <code>.smi</code>. Rather than abandoning the project, we pivoted to making <code>.smi</code> transparent. This actually resulted in a simpler solution\u2014no database migration needed, just improved UX.</p> <p>Visualforce vs Lightning Decision: We initially considered Lightning Web Components for a more modern approach, but discovered that Visualforce integrates more smoothly with Experience Cloud authentication routes. The platform's authentication servlets (<code>/login</code>, <code>/ForgotPassword</code>) work more reliably with Visualforce pages.</p> <p>Feature Creep: Early implementations included features like \"remember me\" that seemed useful but weren't actually contributing to the email-based login goal. Recognizing and removing these features simplified the codebase and made the core functionality more obvious.</p> <p>Guest Profile Permissions: Discovering that guest users need explicit Visualforce page access wasn't immediately obvious. This caused initial access issues that were resolved by properly configuring the guest user profile with page access permissions.</p>"},{"location":"implementation/custom-login-page-implementation/#future-considerations","title":"Future Considerations","text":"<p>Member Communication: Consider whether to proactively communicate to members that they can now use just their email address to log in. Some members may still be typing <code>.smi</code> unnecessarily, even though it works fine. A help article or tooltip could improve awareness.</p> <p>Analytics Integration: Adding analytics tracking to understand: - How many members use just email vs. full username with <code>.smi</code> - Common login errors - Whether members are discovering the simplified login naturally</p> <p>New Member Onboarding: Update the member creation process documentation to clarify that usernames include <code>.smi</code> but members don't need to enter it when logging in. This ensures support staff and documentation are aligned.</p> <p>Migration to Lightning Web Components: As Salesforce continues to evolve, we may eventually migrate to LWC-based authentication flows if platform support improves. The current Visualforce implementation provides a stable foundation that can be incrementally enhanced.</p> <p>Consider Other TLDs: If <code>.smi</code> continues to cause confusion, we could potentially use a different suffix (like <code>.smorg</code> for \"Spokane Mountaineers Organization\"). However, this would require a true username migration, which has the same global uniqueness challenges.</p>"},{"location":"implementation/custom-login-page-implementation/#related-documentation","title":"Related Documentation","text":"<ul> <li>Configure Custom Login Page - User guide for setup</li> <li>Simplifying Custom Login Experience - Blog-style overview</li> <li>Enable Google Login - Google OAuth setup</li> </ul>"},{"location":"implementation/custom-login-page-implementation/#code-references","title":"Code References","text":"<p>Main Components: - <code>force-app/main/default/pages/CommunitiesLogin.page</code> - <code>force-app/main/default/classes/CommunitiesLoginController.cls</code> - <code>force-app/main/default/classes/CommunitiesLoginControllerTest.cls</code> - <code>force-app/main/default/pages/CommunitiesForgotPassword.page</code> - <code>force-app/main/default/classes/CommunitiesForgotPasswordController.cls</code> - <code>force-app/main/default/classes/CommunitiesForgotPasswordControllerTest.cls</code></p> <p>Configuration: - <code>force-app/main/default/labels/CustomLabels.labels-meta.xml</code> - <code>force-app/main/default/profiles/Spokane Mountaineers Profile.profile-meta.xml</code></p>"},{"location":"proposals/","title":"Proposals","text":"<p>This section contains proposals for new features, automations, and improvements to the Spokane Mountaineers Salesforce system.</p>"},{"location":"proposals/#active-proposals","title":"Active Proposals","text":"<ul> <li>Automating Member License Sorting - Automated system that optimizes Salesforce Community license usage by assigning Premium licenses (up to 475) to users with &gt;5 logins per fiscal year, while protecting Chairs and new members. Includes full fiscal year login tracking and daily automated optimization.</li> </ul>"},{"location":"proposals/#proposal-process","title":"Proposal Process","text":"<p>Proposals document:</p> <ul> <li>The problem or opportunity being addressed</li> <li>Proposed solution architecture</li> <li>Implementation details</li> <li>Expected outcomes and benefits</li> <li>Risks and considerations</li> </ul> <p>Proposals are reviewed by the tech team before implementation begins.</p>"},{"location":"proposals/automate-member-license-sorting/","title":"Automating Member License Sorting","text":"<p>Status: Ready for Deployment Created: 2025-12-08 Author: Jason Adams Related Issue: #42</p>"},{"location":"proposals/automate-member-license-sorting/#problem-statement","title":"Problem Statement","text":"<p>The Spokane Mountaineers manage two types of Salesforce Community licenses:</p> <ul> <li>Customer Community Plus (Premium): ~$9\u2013$10 per member per year, unlimited logins</li> <li>Customer Community Plus Login (Login-Based): ~$1.50 per member per year, pooled 5,000 total logins per year</li> </ul> <p>The system automatically optimizes license assignments to address:</p> <ul> <li>Inefficient license usage (Premium licenses assigned to low-usage members)</li> <li>Cost optimization opportunities</li> <li>Manual administrative overhead</li> <li>Risk of exceeding license limits</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#system-constraints","title":"System Constraints","text":"<ul> <li>505 Premium licenses available (maximum: 475 assigned)</li> <li>Chairs must remain Premium (Profile: <code>SM Community Plus Chair</code>)</li> <li>New users (&lt;90 days old) must remain Premium (to allow for initial usage patterns)</li> <li>200 Plus Login licenses included in contract</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#usage-indicators","title":"Usage Indicators","text":"<ul> <li>Plus Login \u2192 Plus: More than 5 logins per year</li> <li>Plus \u2192 Plus Login: 5 or fewer logins per year</li> <li>Maximum Premium licenses: 475 (if more than 475 users qualify, top 475 by login count get Premium)</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#solution","title":"Solution","text":"<p>Automate license optimization through a scheduled batch process that:</p> <ol> <li>Runs daily to optimize license assignments</li> <li>Assigns Premium licenses to users with &gt;5 logins, up to a maximum of 475 Premium licenses</li> <li>Protects critical users (Chairs and new users &lt;90 days) - they always get Premium</li> <li>Prioritizes by login count - if more than 475 users qualify, top 475 by login count get Premium</li> <li>Tracks full fiscal year login history via custom object (LoginHistory API only provides 6 months)</li> <li>Logs all changes for auditing and compliance</li> </ol>"},{"location":"proposals/automate-member-license-sorting/#architecture","title":"Architecture","text":""},{"location":"proposals/automate-member-license-sorting/#components","title":"Components","text":"<ol> <li> <p>Fiscal_Year_Login_History__c (Custom Object)</p> <ul> <li>Mirrors LoginHistory records to track full fiscal year (Feb 1 - Jan 31) login activity</li> <li>Required because LoginHistory API only provides 6 months of data</li> <li>Fields mirror LoginHistory structure with external ID on <code>Login_History_Id__c</code> to prevent duplicates</li> <li>Located in: <code>force-app/main/default/objects/Fiscal_Year_Login_History__c/</code></li> </ul> </li> <li> <p>LoginHistorySyncBatch (<code>Database.Batchable</code>, <code>Database.Stateful</code>)</p> <ul> <li>Runs daily to sync LoginHistory records to Fiscal_Year_Login_History__c</li> <li>Queries LoginHistory from last 2 days and upserts to custom object</li> <li>Triggers LicenseShuffleBatch in finish() method to ensure sync completes before shuffling</li> <li>Located in: <code>force-app/main/default/classes/LoginHistorySyncBatch.cls</code></li> </ul> </li> <li> <p>LoginHistorySyncScheduler (<code>Schedulable</code>)</p> <ul> <li>Schedules LoginHistorySyncBatch to run daily (e.g., 2:00 AM)</li> <li>Located in: <code>force-app/main/default/classes/LoginHistorySyncScheduler.cls</code></li> </ul> </li> <li> <p>LoginHistoryCleanupBatch (<code>Database.Batchable</code>)</p> <ul> <li>Runs annually on May 1st to delete records before February 1st of previous fiscal year</li> <li>Keeps exactly one full fiscal year of data (Feb 1 - Jan 31)</li> <li>Located in: <code>force-app/main/default/classes/LoginHistoryCleanupBatch.cls</code></li> </ul> </li> <li> <p>LoginHistoryCleanupScheduler (<code>Schedulable</code>)</p> <ul> <li>Schedules LoginHistoryCleanupBatch to run annually on May 1st</li> <li>Located in: <code>force-app/main/default/classes/LoginHistoryCleanupScheduler.cls</code></li> </ul> </li> <li> <p>LicenseShuffleBatch (<code>Database.Batchable</code>, <code>Database.Stateful</code>)</p> <ul> <li>Queries all active Community users</li> <li>Counts logins from <code>Fiscal_Year_Login_History__c</code> (fiscal year: Feb 1 - Jan 31)</li> <li>Assigns Premium licenses to users with &gt;5 logins, up to maximum of 475</li> <li>Updates licenses and profiles</li> <li>Accumulates audit logs for later insertion</li> <li>Located in: <code>force-app/main/default/classes/LicenseShuffleBatch.cls</code></li> </ul> </li> <li> <p>LicenseChangeLogQueueable (<code>Queueable</code>)</p> <ul> <li>Handles insertion of <code>License_Change_Log__c</code> records in a separate transaction</li> <li>Resolves <code>MIXED_DML_OPERATION</code> error (cannot mix User updates with custom object inserts)</li> <li>Enqueued from <code>LicenseShuffleBatch.finish()</code> method</li> <li>Located in: <code>force-app/main/default/classes/LicenseChangeLogQueueable.cls</code></li> </ul> </li> <li> <p>License_Change_Log__c (Custom Object)</p> <ul> <li>Tracks all license changes</li> <li>Stores: User, old/new license, old/new profile, login count, reason, timestamp, batch job ID</li> <li>Located in: <code>force-app/main/default/objects/License_Change_Log__c/</code></li> </ul> </li> <li> <p>LoginHistoryMigrationBatch (<code>Database.Batchable</code>, <code>Database.Stateful</code>)</p> <ul> <li>One-time batch class for initial data migration</li> <li>Backfills <code>Fiscal_Year_Login_History__c</code> with existing LoginHistory records (last 6 months)</li> <li>Used for initial setup before daily sync process begins</li> <li>Located in: <code>force-app/main/default/classes/LoginHistoryMigrationBatch.cls</code></li> </ul> </li> <li> <p>Field-Level Security Script (<code>grant_fls_fiscal_year_login_history.apex</code>)</p> <ul> <li>Anonymous Apex script to grant FLS access to System Administrator profile</li> <li>Programmatically sets read/edit permissions for all Fiscal_Year_Login_History__c fields</li> <li>Must be run after deploying the custom object (foundation step)</li> <li>Located in: <code>scripts/apex/license-sorting/grant_fls_fiscal_year_login_history.apex</code></li> </ul> </li> </ol>"},{"location":"proposals/automate-member-license-sorting/#flow-diagram","title":"Flow Diagram","text":""},{"location":"proposals/automate-member-license-sorting/#implementation-details","title":"Implementation Details","text":""},{"location":"proposals/automate-member-license-sorting/#license-shuffling-algorithm","title":"License Shuffling Algorithm","text":"<ol> <li> <p>Identify Protected Users:</p> <ul> <li>Profile = <code>SM Community Plus Chair</code></li> <li>CreatedDate &gt;= LAST_N_DAYS:90</li> </ul> </li> <li> <p>Calculate Login Counts:</p> <ul> <li>Query <code>Fiscal_Year_Login_History__c</code> for each user (not LoginHistory - API only provides 6 months)</li> <li>Fiscal Year Logic (Fiscal Year: Feb 1 - Jan 31):<ul> <li>If current month in {2,3,4} (Feb-Apr): Use <code>LAST_N_DAYS:365</code> (last 365 days - first 3 months of FY)</li> <li>If current month &gt;= 5 (May-Dec): Use current fiscal year (Feb 1 of current year to now)</li> <li>If current month == 1 (Jan): Use fiscal year (Feb 1 of previous year to now)</li> </ul> </li> <li>Count total logins per user in the relevant period</li> </ul> </li> <li> <p>Identify Qualifying Users:</p> <ul> <li>Protected users: Always get Premium (Chairs and new users &lt;90 days)</li> <li>Qualifying users: Users with &gt;5 logins qualify for Premium</li> </ul> </li> <li> <p>Calculate Premium License Assignments:</p> <ul> <li>Always include all protected users (they must be Premium)</li> <li>Include all users with &gt;5 logins</li> <li>If total exceeds 475, sort all qualifying users by login count (descending) and take top 475</li> <li>Maximum: 475 Premium licenses total</li> </ul> </li> <li> <p>Execute Changes:</p> <ul> <li>Assign Premium to users in the keep list (protected + top qualifying users up to 475)</li> <li>Assign Login to users not in the keep list (users with \u22645 logins, or qualifying users beyond the 475 limit)</li> </ul> </li> </ol>"},{"location":"proposals/automate-member-license-sorting/#profile-mapping","title":"Profile Mapping","text":"<ul> <li>Customer Community Plus \u2192 Profile: <code>SM Community Plus Member</code></li> <li>Customer Community Plus Login \u2192 Profile: <code>SM Community Plus Login</code></li> <li>Chairs \u2192 Profile: <code>SM Community Plus Chair</code> (always Premium, never changed)</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#logging","title":"Logging","text":"<p>All license changes are logged to <code>License_Change_Log__c</code> with:</p> <ul> <li>User reference</li> <li>Old and new license types</li> <li>Old and new profile names</li> <li>Login count at time of change</li> <li>Reason for change (\"Low usage\" or \"High usage\")</li> <li>Timestamp (<code>Changed_At__c</code>)</li> <li>Batch job ID</li> </ul> <p>Important: Due to Salesforce's <code>MIXED_DML_OPERATION</code> restriction, log records are inserted via a <code>Queueable</code> job that runs after the batch completes. This means:</p> <ul> <li>User license changes happen immediately</li> <li>Log records are created shortly after (typically within seconds)</li> <li>If the Queueable job fails, check debug logs for error details</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#expected-outcomes","title":"Expected Outcomes","text":""},{"location":"proposals/automate-member-license-sorting/#benefits","title":"Benefits","text":"<ul> <li>Automated Management: Eliminates manual license assignment overhead</li> <li>Proactive Optimization: Automatically rebalances when usage patterns change</li> <li>Audit Trail: Provides complete logging of all license changes for compliance</li> <li>Full Fiscal Year Tracking: Maintains complete fiscal year login history (not limited to 6 months like LoginHistory API)</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#metrics","title":"Metrics","text":"<ul> <li>Premium licenses assigned: Up to 475 (based on users with &gt;5 logins)</li> <li>Manual license management time: Near zero (automated daily)</li> <li>License changes logged: 100% of all changes</li> <li>Login history tracking: Full fiscal year (Feb 1 - Jan 31)</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#risks-and-considerations","title":"Risks and Considerations","text":""},{"location":"proposals/automate-member-license-sorting/#technical-risks","title":"Technical Risks","text":"<ul> <li>Governor Limits: LoginHistory queries are expensive; batch size is set to 50 users per batch to stay within limits</li> <li>Query Performance: Large <code>Fiscal_Year_Login_History__c</code> tables may impact batch execution time</li> <li>LoginHistory API Limitation: LoginHistory API only provides 6 months of data<ul> <li>Mitigation: Custom object <code>Fiscal_Year_Login_History__c</code> tracks full fiscal year via daily sync</li> </ul> </li> <li>Error Handling: Users with validation rules or required fields may fail to update (errors are logged but don't stop the batch)</li> <li>MIXED_DML_OPERATION: Cannot update User (setup object) and insert <code>License_Change_Log__c</code> (non-setup object) in the same transaction<ul> <li>Mitigation: Log records are inserted via <code>LicenseChangeLogQueueable</code> in a separate transaction</li> </ul> </li> <li>Data Sync Timing: <code>LoginHistorySyncBatch</code> must complete before <code>LicenseShuffleBatch</code> runs<ul> <li>Mitigation: <code>LicenseShuffleBatch</code> is triggered from <code>LoginHistorySyncBatch.finish()</code> method</li> </ul> </li> <li>Field-Level Security: System Administrators require FLS permissions for <code>Fiscal_Year_Login_History__c</code> fields<ul> <li>Mitigation: FLS grant script (<code>scripts/apex/license-sorting/grant_fls_fiscal_year_login_history.apex</code>) programmatically sets permissions</li> </ul> </li> </ul>"},{"location":"proposals/automate-member-license-sorting/#business-risks","title":"Business Risks","text":"<ul> <li>User Experience: License changes may affect user access (mitigated by protecting Chairs and new users &lt;90 days)</li> <li>Timing: Batch runs daily; changes may lag behind actual usage patterns by up to 24 hours</li> <li>Edge Cases: Users with exactly 5 logins may oscillate between licenses depending on other qualifying users and the 475 Premium license limit</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#mitigation-strategies","title":"Mitigation Strategies","text":"<ul> <li>Comprehensive test coverage (&gt;75% for all classes)</li> <li>Idempotent batch design (safe to run multiple times)</li> <li>Detailed error logging to <code>License_Change_Log__c</code> and debug logs</li> <li>Protected users (Chairs and new members) always retain Premium licenses</li> <li>Manual batch execution available for immediate optimization when needed</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#implementation-plan","title":"Implementation Plan","text":""},{"location":"proposals/automate-member-license-sorting/#phase-1-foundation","title":"Phase 1: Foundation \u2705","text":"<ul> <li>Create <code>License_Change_Log__c</code> custom object and fields</li> <li>Create <code>Fiscal_Year_Login_History__c</code> custom object and fields</li> <li>Create <code>LicenseShuffleBatch</code> class skeleton</li> <li>Create FLS grant script for field-level security setup</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#phase-2-core-logic","title":"Phase 2: Core Logic \u2705","text":"<ul> <li>Implement fiscal year login counting logic using <code>Fiscal_Year_Login_History__c</code></li> <li>Implement license shuffling algorithm (&gt;5 logins, max 475 Premium)</li> <li>Implement logging functionality via Queueable class</li> <li>Create <code>LoginHistorySyncBatch</code> for daily data sync</li> <li>Create <code>LoginHistoryCleanupBatch</code> for annual data cleanup</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#phase-3-testing","title":"Phase 3: Testing \u2705","text":"<ul> <li>Create comprehensive test classes for all components</li> <li>Test all scenarios (upgrade, downgrade, protected users, edge cases)</li> <li>Verify governor limit handling and batch processing</li> <li>Test job chaining (sync batch triggers shuffle batch)</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#phase-4-deployment-setup","title":"Phase 4: Deployment &amp; Setup","text":"<ul> <li> Deploy all components to staging environment</li> <li> Create Fiscal_Year_Login_History__c custom object and fields</li> <li> Create LoginHistorySyncBatch and scheduler</li> <li> Create LoginHistoryCleanupBatch and scheduler</li> <li> Update LicenseShuffleBatch to use custom object and new logic</li> <li> Create LoginHistoryMigrationBatch for initial data backfill</li> <li> Create FLS grant script for field-level security setup</li> <li> Run FLS grant script to set permissions</li> <li> Run initial data migration (LoginHistoryMigrationBatch) to backfill last 6 months</li> <li> Schedule <code>LoginHistorySyncScheduler</code> to run daily</li> <li> Schedule <code>LoginHistoryCleanupScheduler</code> to run annually on May 1st</li> <li> Monitor initial runs and verify functionality</li> <li> Deploy to production after testing complete</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#phase-5-documentation","title":"Phase 5: Documentation","text":"<ul> <li> Document system architecture and components</li> <li> Document Queueable class and MIXED_DML workaround</li> <li> Document setup scripts and deployment steps</li> <li> Create admin guide for monitoring</li> <li> Document troubleshooting procedures</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#implementation-notes","title":"Implementation Notes","text":""},{"location":"proposals/automate-member-license-sorting/#testing-configuration","title":"Testing Configuration","text":"<ul> <li>Max Premium Licenses: 475</li> <li>Login Threshold: &gt;5 logins qualify for Premium</li> <li>Fiscal Year: Feb 1 - Jan 31</li> <li>Manual Execution: Can trigger LoginHistorySyncBatch or LicenseShuffleBatch directly</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#key-implementation-details","title":"Key Implementation Details","text":"<ul> <li>Batch Size: 50 users per chunk for LicenseShuffleBatch, 200 for LoginHistorySyncBatch and LoginHistoryMigrationBatch</li> <li>Stateful Processing: Uses <code>Database.Stateful</code> to track Premium users across chunks</li> <li>Log Insertion: Logs are accumulated during batch execution and inserted via Queueable after completion</li> <li>Protected Users: Chairs and users &lt;90 days old always get Premium licenses</li> <li>Daily Sync: LoginHistorySyncBatch runs daily to sync LoginHistory to custom object</li> <li>Annual Cleanup: LoginHistoryCleanupBatch runs May 1st to delete records before previous fiscal year</li> <li>Job Chaining: LoginHistorySyncBatch triggers LicenseShuffleBatch in finish() method</li> <li>Field-Level Security: System Administrator profile requires FLS permissions for Fiscal_Year_Login_History__c fields (granted via script)</li> <li>Initial Migration: LoginHistoryMigrationBatch provides one-time backfill of last 6 months of LoginHistory data</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#test-classes","title":"Test Classes","text":"<ul> <li><code>LicenseShuffleBatchTest.cls</code>: Comprehensive test coverage for batch logic</li> <li><code>LicenseChangeLogQueueableTest.cls</code>: Tests Queueable log insertion</li> <li><code>LoginHistorySyncBatchTest.cls</code>: Tests sync batch logic</li> <li><code>LoginHistorySyncSchedulerTest.cls</code>: Tests sync scheduler</li> <li><code>LoginHistoryCleanupBatchTest.cls</code>: Tests cleanup batch logic</li> <li><code>LoginHistoryCleanupSchedulerTest.cls</code>: Tests cleanup scheduler</li> <li><code>LoginHistoryMigrationBatch</code>: Includes test methods for initial migration logic</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#setup-scripts","title":"Setup Scripts","text":"<ul> <li><code>scripts/apex/license-sorting/grant_fls_fiscal_year_login_history.apex</code>: Grants FLS permissions to System Administrator profile</li> <li><code>scripts/apex/license-sorting/migrate_login_history_initial.apex</code>: Executes LoginHistoryMigrationBatch for initial data backfill</li> <li><code>scripts/apex/license-sorting/README.md</code>: Documentation for all license sorting scripts</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#deployment-steps","title":"Deployment Steps","text":""},{"location":"proposals/automate-member-license-sorting/#initial-setup-one-time","title":"Initial Setup (One-Time)","text":"<ol> <li>Deploy Components: Deploy all Apex classes, custom objects, and fields to target org</li> <li>Grant Field-Level Security: Run <code>scripts/apex/license-sorting/grant_fls_fiscal_year_login_history.apex</code> in Anonymous Apex to grant FLS permissions</li> <li>Initial Data Migration: Run <code>scripts/apex/license-sorting/migrate_login_history_initial.apex</code> to backfill last 6 months of LoginHistory data</li> <li>Schedule Daily Sync: Schedule <code>LoginHistorySyncScheduler</code> to run daily (recommended: 2:00 AM)</li> <li>Schedule Annual Cleanup: Schedule <code>LoginHistoryCleanupScheduler</code> to run annually on May 1st</li> </ol>"},{"location":"proposals/automate-member-license-sorting/#ongoing-operations","title":"Ongoing Operations","text":"<ul> <li>Daily sync automatically maintains <code>Fiscal_Year_Login_History__c</code> records</li> <li>License shuffling runs automatically after each daily sync completes</li> <li>Annual cleanup removes records older than one full fiscal year</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#future-enhancements","title":"Future Enhancements","text":"<ul> <li>Custom Metadata: Configurable thresholds (475 max Premium, 5 login threshold)</li> <li>Dashboard/Reports: Visualize license usage trends and fiscal year login activity</li> <li>Manual Trigger: Option to run optimization immediately (available via direct batch execution)</li> <li>Predictive Analytics: Forecast license needs based on usage trends</li> <li>Data Retention Policy: Configurable retention period for Fiscal_Year_Login_History__c records</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#references","title":"References","text":"<ul> <li>Salesforce LoginHistory Object Documentation</li> <li>Salesforce LoginHistory API Limitations - Only 6 months of data available via API</li> <li>Salesforce Batch Apex Best Practices</li> <li>Internal notes from conversation with Matt Jeffries</li> </ul>"},{"location":"proposals/automate-member-license-sorting/#status","title":"Status","text":"<p>System is implemented and ready for production deployment. All components have been deployed to staging and tested. Initial data migration has been completed. System awaits scheduling of daily sync and annual cleanup jobs, followed by production deployment after final testing verification.</p>"}]}